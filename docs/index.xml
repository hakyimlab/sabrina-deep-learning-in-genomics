<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>deep-learning-in-genomics</title>
<link>https://sabrinami.quarto.pub/deep-learning-in-genomics/index.html</link>
<atom:link href="https://sabrinami.quarto.pub/deep-learning-in-genomics/index.xml" rel="self" type="application/rss+xml"/>
<description>Sabrina&#39;s blog for Deep Learning in Genomics course</description>
<generator>quarto-1.3.361</generator>
<lastBuildDate>Wed, 06 Sep 2023 07:00:00 GMT</lastBuildDate>
<item>
  <title>Validating reference gene expression prediction</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-09-06-validating-Huang-et-al/index.html</link>
  <description><![CDATA[ 




<p>We are trying to replicate the Enformer result’s in <a href="https://www.biorxiv.org/content/10.1101/2023.06.30.547100v1">Personal transcriptome variation is poorly explained by current genomic deep learning models, Huang et al</a>. They reported a 0.57 correlation in reference prediction across all genes. They used median GEUVADIS LCL gene expression data for their comparison and quantified predicted gene expression using the average of 10 bin window around each gene’s TSS on the CAGE:B lymphoblastoid cell line track. I performed a similar analysis of Enformer performance along the reference genome, but instead I used a 3 bin window around the TSS and the CAGE:Brain, adult track to compare to observed GTEx brain cortex gene expression. I found 0.54 between predicted and observed reference gene expression.</p>
<section id="libraries-and-definitions" class="level3">
<h3 class="anchored" data-anchor-id="libraries-and-definitions">Libraries and Definitions</h3>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-5"></span>
<span id="cb1-6">enfref_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/grand/TFXcan/imlab/users/lvairus/reftile_project/enformer-reference-epigenome"</span></span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query_epigenome(chr_num, center_bp, n_bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, tracks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb1-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Parameters:</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        path_to_enfref (str): path to the directory containing the concatenated reference enformer files</span></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        chr_num (int/string): chromosome number</span></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        center_bp (int): center base pair position (1-indexed)</span></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        n_bins (int): number of bins to extract centered around center_bp (default: 896) </span></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            note: if the number of bins is even, the center bin will be in the second half of the array</span></span>
<span id="cb1-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        tracks (int list): list of tracks to extract (default: all 5313 tracks)</span></span>
<span id="cb1-17"></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns:</span></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        epigen (np.array): enformer predictions centered at center_bp of shape (n_bins, len(tracks))</span></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb1-21"></span>
<span id="cb1-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># from position choose center bin</span></span>
<span id="cb1-23">    center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb1-24">    </span>
<span id="cb1-25">    half_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-26">    start_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> half_bins</span>
<span id="cb1-27">    end_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> half_bins</span>
<span id="cb1-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> n_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if n_bins is odd</span></span>
<span id="cb1-29">        end_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-30"></span>
<span id="cb1-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>enfref_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_cat.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb1-32">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get tracks if list provided</span></span>
<span id="cb1-33">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> tracks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb1-34">            epigen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>][start_bin:end_bin, :] </span>
<span id="cb1-35">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb1-36">            epigen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>][start_bin:end_bin, tracks] </span>
<span id="cb1-37"></span>
<span id="cb1-38">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> epigen</span></code></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## create lists of genes on each chromomsome</span></span>
<span id="cb2-2">hg38_annot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/annotation/hg38.protein_coding_TSS.txt"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb2-3">gene_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hg38_annot.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chromosome_name'</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ensembl_gene_id'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>).to_dict()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Initialize lists of CAGE predictions for each gene</span></span>
<span id="cb3-2">hg38_annot.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ensembl_gene_id"</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb3-3">chr_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"9"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"12"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"13"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"14"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"15"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"16"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"17"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"18"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"19"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"21"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"22"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>]</span>
<span id="cb3-4">CAGE_predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {key: [] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> key <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list}</span></code></pre></div>
</div>
</section>
<section id="query-enformer-predicted-gene-expression" class="level3">
<h3 class="anchored" data-anchor-id="query-enformer-predicted-gene-expression">Query Enformer predicted gene expression</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Function to put CAGE predictions in list (in the same order as gene list by chromosome)</span></span>
<span id="cb4-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb4-3">    gene_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gene_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>]</span>
<span id="cb4-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> gene_list:</span>
<span id="cb4-5">        bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query_epigenome(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, hg38_annot.loc[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'transcription_start_site'</span>], num_bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, tracks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5110</span>])</span>
<span id="cb4-6">        CAGE_predictions[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>].append(np.average(bins))</span></code></pre></div>
</div>
</section>
<section id="calculate-geuvadis-reference-gene-expression" class="level3">
<h3 class="anchored" data-anchor-id="calculate-geuvadis-reference-gene-expression">Calculate GEUVADIS reference gene expression</h3>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">geuvadis_gex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/lus/grand/projects/TFXcan/imlab/data/1000G/expression/GD462.GeneQuantRPKM.50FN.samplename.resk10.txt.gz"</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-2">geuvadis_gex.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TargetID</th>
<th data-quarto-table-cell-role="th">Gene_Symbol</th>
<th data-quarto-table-cell-role="th">Chr</th>
<th data-quarto-table-cell-role="th">Coord</th>
<th data-quarto-table-cell-role="th">HG00096</th>
<th data-quarto-table-cell-role="th">HG00097</th>
<th data-quarto-table-cell-role="th">HG00099</th>
<th data-quarto-table-cell-role="th">HG00100</th>
<th data-quarto-table-cell-role="th">HG00101</th>
<th data-quarto-table-cell-role="th">HG00102</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">NA20810</th>
<th data-quarto-table-cell-role="th">NA20811</th>
<th data-quarto-table-cell-role="th">NA20812</th>
<th data-quarto-table-cell-role="th">NA20813</th>
<th data-quarto-table-cell-role="th">NA20814</th>
<th data-quarto-table-cell-role="th">NA20815</th>
<th data-quarto-table-cell-role="th">NA20816</th>
<th data-quarto-table-cell-role="th">NA20819</th>
<th data-quarto-table-cell-role="th">NA20826</th>
<th data-quarto-table-cell-role="th">NA20828</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ENSG00000152931.6</td>
<td>ENSG00000152931.6</td>
<td>5</td>
<td>59783540</td>
<td>0.101858</td>
<td>0.078110</td>
<td>0.048981</td>
<td>0.118597</td>
<td>0.004035</td>
<td>0.010925</td>
<td>...</td>
<td>0.088601</td>
<td>0.240010</td>
<td>0.137175</td>
<td>0.148494</td>
<td>0.038643</td>
<td>0.088509</td>
<td>0.029204</td>
<td>0.024423</td>
<td>0.044816</td>
<td>0.139186</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ENSG00000183696.9</td>
<td>ENSG00000183696.9</td>
<td>7</td>
<td>48128225</td>
<td>8.183805</td>
<td>5.686911</td>
<td>2.434653</td>
<td>3.830894</td>
<td>6.612288</td>
<td>4.709646</td>
<td>...</td>
<td>13.428205</td>
<td>6.094500</td>
<td>12.536000</td>
<td>2.217262</td>
<td>3.573394</td>
<td>7.583364</td>
<td>4.052882</td>
<td>1.570378</td>
<td>4.900372</td>
<td>6.737308</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ENSG00000139269.2</td>
<td>ENSG00000139269.2</td>
<td>12</td>
<td>57846106</td>
<td>1.199910</td>
<td>1.573572</td>
<td>0.521616</td>
<td>1.447225</td>
<td>3.565791</td>
<td>1.982681</td>
<td>...</td>
<td>3.225880</td>
<td>1.996067</td>
<td>2.854923</td>
<td>2.267343</td>
<td>1.331201</td>
<td>2.187895</td>
<td>1.004250</td>
<td>3.003316</td>
<td>1.984362</td>
<td>1.684954</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ENSG00000169129.8</td>
<td>ENSG00000169129.8</td>
<td>10</td>
<td>116164515</td>
<td>0.831940</td>
<td>0.069778</td>
<td>0.931086</td>
<td>0.620941</td>
<td>1.660668</td>
<td>0.570481</td>
<td>...</td>
<td>1.023381</td>
<td>1.127852</td>
<td>0.774409</td>
<td>1.495854</td>
<td>0.895342</td>
<td>1.513521</td>
<td>0.826377</td>
<td>1.021201</td>
<td>0.952502</td>
<td>0.740565</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>ENSG00000134602.11</td>
<td>ENSG00000134602.11</td>
<td>X</td>
<td>131157293</td>
<td>27.646422</td>
<td>24.395572</td>
<td>16.445374</td>
<td>24.806650</td>
<td>25.113349</td>
<td>19.233988</td>
<td>...</td>
<td>25.079490</td>
<td>28.725528</td>
<td>24.450520</td>
<td>27.264069</td>
<td>26.912814</td>
<td>29.509210</td>
<td>26.462331</td>
<td>25.624009</td>
<td>25.707741</td>
<td>22.824957</td>
</tr>
</tbody>
</table>

<p>5 rows × 466 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">geuvadis_gex[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'TargetID'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> geuvadis_gex[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'TargetID'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> gene: gene.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb6-2">geuvadis_gex.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'TargetID'</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate average gene expression</span></span>
<span id="cb6-4">geuvadis_mean_gex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> geuvadis_gex.drop(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gene_Symbol'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Chr'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Coord'</span>]).mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-5">geuvadis_mean_gex.name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'geuvadis'</span></span></code></pre></div>
</div>
</section>
<section id="plot-correlation-across-genes" class="level3">
<h3 class="anchored" data-anchor-id="plot-correlation-across-genes">Plot correlation across genes</h3>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">merged_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>: pd.DataFrame(index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gene_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>]) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list}</span>
<span id="cb7-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb7-3">    merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'enformer'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CAGE_predictions[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb8-2">    gene_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>].index.intersection(geuvadis_gex.index)</span>
<span id="cb8-3">    merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>].merge(geuvadis_mean_gex, left_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, right_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, how<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'inner'</span>).dropna()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">all_genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat(merged_dict.values())</span>
<span id="cb9-2">all_genes.to_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/output/hg38_predicted_vs_observed_expression_GEUVADIS.csv"</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(all_genes)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  enformer   geuvadis
ENSG00000157911  26.583872   7.754189
ENSG00000142655  45.931610  11.007757
ENSG00000149527   0.106181   0.541469
ENSG00000171621   8.679342   1.851198
ENSG00000142583  44.758301  15.652001
...                    ...        ...
ENSG00000169239  16.344961   2.933672
ENSG00000102181  24.281412  11.087266
ENSG00000169083   0.381008   0.021671
ENSG00000147050  58.424080  10.937074
ENSG00000101972  36.190773  29.675127

[14585 rows x 2 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> all_genes.corr().iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb12-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation across all hg38 genes:"</span>, corr)</span>
<span id="cb12-3">plt.scatter(all_genes[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'enformer'</span>], all_genes[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'geuvadis'</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Correlation: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>corr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb12-4">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'observed'</span>)</span>
<span id="cb12-5">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'predicted'</span>)</span>
<span id="cb12-6">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hg38 prediction across genes"</span>)</span>
<span id="cb12-7">plt.legend()</span>
<span id="cb12-8">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb12-9">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Correlation across all hg38 genes: 0.19324818461902257</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-09-06-validating-Huang-et-al/index_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="compare-to-3-bin-window-predictions" class="level3">
<h3 class="anchored" data-anchor-id="compare-to-3-bin-window-predictions">Compare to 3 bin window predictions</h3>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb14-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb14-3">    tic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.perf_counter()</span>
<span id="cb14-4">    gene_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>].index</span>
<span id="cb14-5">    predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb14-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> gene_list:</span>
<span id="cb14-7">        bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query_epigenome(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, hg38_annot.loc[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'transcription_start_site'</span>], num_bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, tracks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5110</span>])</span>
<span id="cb14-8">        predictions.append(np.average(bins))</span>
<span id="cb14-9">    merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"enformer, 3 bin"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> predictions</span>
<span id="cb14-10">    toc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.perf_counter()</span>
<span id="cb14-11">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Querying chromosome"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes...,"</span>, toc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tic, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seconds"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Querying chromosome 1 genes..., 44.38094838405959 seconds
Querying chromosome 2 genes..., 35.90561124891974 seconds
Querying chromosome 3 genes..., 31.244477248983458 seconds
Querying chromosome 4 genes..., 24.72689785005059 seconds
Querying chromosome 5 genes..., 25.695796379004605 seconds
Querying chromosome 6 genes..., 27.095260299975052 seconds
Querying chromosome 7 genes..., 29.503782182000577 seconds
Querying chromosome 8 genes..., 16.569634438026696 seconds
Querying chromosome 9 genes..., 17.30759223003406 seconds
Querying chromosome 10 genes..., 21.247902504052036 seconds
Querying chromosome 11 genes..., 31.04979562200606 seconds
Querying chromosome 12 genes..., 23.60031519201584 seconds
Querying chromosome 13 genes..., 10.305076834047213 seconds
Querying chromosome 14 genes..., 15.184288493008353 seconds
Querying chromosome 15 genes..., 16.564520464045927 seconds
Querying chromosome 16 genes..., 16.226559089962393 seconds
Querying chromosome 17 genes..., 20.44110699906014 seconds
Querying chromosome 18 genes..., 8.865124020026997 seconds
Querying chromosome 19 genes..., 20.500569563009776 seconds
Querying chromosome 20 genes..., 11.948940997943282 seconds
Querying chromosome 21 genes..., 5.145313170971349 seconds
Querying chromosome 22 genes..., 8.008219097973779 seconds
Querying chromosome X genes..., 17.180793673032895 seconds</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">all_genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat(merged_dict.values())</span>
<span id="cb16-2">all_genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> all_genes[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"geuvadis"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"enformer"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"enformer, 3 bin"</span>]]</span>
<span id="cb16-3">all_genes.rename(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'enformer'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'enformer, 10 bin'</span>}, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb16-4">all_genes.to_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/output/hg38_predicted_vs_observed_expression_GEUVADIS.csv"</span>)</span></code></pre></div>
</div>
<p>I’m really not sure why I can’t get near the 0.57 expected correlation, so I will run the original code used by Huang et al.</p>
</section>
<section id="original-code" class="level3">
<h3 class="anchored" data-anchor-id="original-code">Original Code</h3>
<p>I cloned <a href="https://github.com/ni-lab/personalized-expression-benchmark.git">personalized-expression-benchmark</a>.</p>
<p>The first difference I noticed in their analysis is that they subset to 3259 genes in the GEUVADIS EUR dataset found to have at least one significant cis-eQTL.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb17-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb17-3">all_genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/output/hg38_predicted_vs_observed_expression_GEUVADIS.csv"</span>, index_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">eqtl_genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/Github/personalized-expression-benchmark/data/gene_list.csv"</span>, usecols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(eqtl_genes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].to_list())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['ENSG00000000457', 'ENSG00000001630', 'ENSG00000002549', 'ENSG00000002745', 'ENSG00000003056', 'ENSG00000003249', 'ENSG00000003402', 'ENSG00000004660', 'ENSG00000005075', 'ENSG00000005156', 'ENSG00000005700', 'ENSG00000005882', 'ENSG00000006075', 'ENSG00000006114', 'ENSG00000006194', 'ENSG00000006282', 'ENSG00000006607', 'ENSG00000006695', 'ENSG00000007255', 'ENSG00000007341', 'ENSG00000008382', 'ENSG00000008517', 'ENSG00000008988', 'ENSG00000010270', 'ENSG00000010278', 'ENSG00000010310', 'ENSG00000010361', 'ENSG00000010626', 'ENSG00000011052', 'ENSG00000011105', 'ENSG00000011295', 'ENSG00000011376', 'ENSG00000011422', 'ENSG00000011478', 'ENSG00000011566', 'ENSG00000011638', 'ENSG00000012124', 'ENSG00000012779', 'ENSG00000013016', 'ENSG00000013288', 'ENSG00000013374', 'ENSG00000013503', 'ENSG00000013561', 'ENSG00000013583', 'ENSG00000014138', 'ENSG00000014164', 'ENSG00000014257', 'ENSG00000015479', 'ENSG00000018699', 'ENSG00000018869', 'ENSG00000020922', 'ENSG00000021300', 'ENSG00000021355', 'ENSG00000022556', 'ENSG00000023892', 'ENSG00000025156', 'ENSG00000025434', 'ENSG00000025708', 'ENSG00000025772', 'ENSG00000026297', 'ENSG00000026751', 'ENSG00000026950', 'ENSG00000027001', 'ENSG00000027847', 'ENSG00000028528', 'ENSG00000029534', 'ENSG00000029639', 'ENSG00000030110', 'ENSG00000031691', 'ENSG00000031698', 'ENSG00000032219', 'ENSG00000032742', 'ENSG00000034677', 'ENSG00000035141', 'ENSG00000035687', 'ENSG00000035862', 'ENSG00000036448', 'ENSG00000037757', 'ENSG00000038002', 'ENSG00000039319', 'ENSG00000039650', 'ENSG00000040199', 'ENSG00000041802', 'ENSG00000041982', 'ENSG00000042445', 'ENSG00000042493', 'ENSG00000043143', 'ENSG00000043514', 'ENSG00000043591', 'ENSG00000044090', 'ENSG00000046604', 'ENSG00000047579', 'ENSG00000048544', 'ENSG00000049167', 'ENSG00000049192', 'ENSG00000049239', 'ENSG00000049246', 'ENSG00000049247', 'ENSG00000049449', 'ENSG00000050393', 'ENSG00000051108', 'ENSG00000051596', 'ENSG00000051620', 'ENSG00000052126', 'ENSG00000053371', 'ENSG00000053501', 'ENSG00000053918', 'ENSG00000054179', 'ENSG00000054277', 'ENSG00000054282', 'ENSG00000054523', 'ENSG00000054983', 'ENSG00000055163', 'ENSG00000055211', 'ENSG00000055483', 'ENSG00000055732', 'ENSG00000055950', 'ENSG00000056050', 'ENSG00000056661', 'ENSG00000057935', 'ENSG00000058085', 'ENSG00000059122', 'ENSG00000059588', 'ENSG00000059691', 'ENSG00000060709', 'ENSG00000062194', 'ENSG00000063046', 'ENSG00000063761', 'ENSG00000063854', 'ENSG00000064199', 'ENSG00000064270', 'ENSG00000064300', 'ENSG00000064652', 'ENSG00000064666', 'ENSG00000064787', 'ENSG00000064886', 'ENSG00000065000', 'ENSG00000065060', 'ENSG00000065135', 'ENSG00000065154', 'ENSG00000065268', 'ENSG00000065308', 'ENSG00000065413', 'ENSG00000065559', 'ENSG00000065600', 'ENSG00000065613', 'ENSG00000065621', 'ENSG00000065665', 'ENSG00000065809', 'ENSG00000065989', 'ENSG00000066027', 'ENSG00000066084', 'ENSG00000066185', 'ENSG00000066230', 'ENSG00000066654', 'ENSG00000066855', 'ENSG00000066926', 'ENSG00000067057', 'ENSG00000067113', 'ENSG00000067141', 'ENSG00000067533', 'ENSG00000067606', 'ENSG00000068097', 'ENSG00000068137', 'ENSG00000068305', 'ENSG00000068724', 'ENSG00000068784', 'ENSG00000069998', 'ENSG00000070061', 'ENSG00000070371', 'ENSG00000070444', 'ENSG00000070476', 'ENSG00000070540', 'ENSG00000070718', 'ENSG00000070731', 'ENSG00000070759', 'ENSG00000070770', 'ENSG00000070831', 'ENSG00000070915', 'ENSG00000071894', 'ENSG00000071909', 'ENSG00000071967', 'ENSG00000072042', 'ENSG00000072071', 'ENSG00000072110', 'ENSG00000072682', 'ENSG00000072756', 'ENSG00000072778', 'ENSG00000072818', 'ENSG00000072954', 'ENSG00000073150', 'ENSG00000073169', 'ENSG00000073350', 'ENSG00000073578', 'ENSG00000073584', 'ENSG00000073605', 'ENSG00000073670', 'ENSG00000073712', 'ENSG00000073803', 'ENSG00000073849', 'ENSG00000073969', 'ENSG00000074054', 'ENSG00000074071', 'ENSG00000074219', 'ENSG00000074266', 'ENSG00000074319', 'ENSG00000074416', 'ENSG00000074696', 'ENSG00000074966', 'ENSG00000075043', 'ENSG00000075234', 'ENSG00000075239', 'ENSG00000075413', 'ENSG00000075643', 'ENSG00000075975', 'ENSG00000076067', 'ENSG00000076248', 'ENSG00000076356', 'ENSG00000076555', 'ENSG00000076650', 'ENSG00000076826', 'ENSG00000076924', 'ENSG00000076944', 'ENSG00000077044', 'ENSG00000077097', 'ENSG00000077238', 'ENSG00000077348', 'ENSG00000077420', 'ENSG00000077935', 'ENSG00000078142', 'ENSG00000078177', 'ENSG00000078246', 'ENSG00000078795', 'ENSG00000078804', 'ENSG00000079134', 'ENSG00000079215', 'ENSG00000079257', 'ENSG00000079263', 'ENSG00000079335', 'ENSG00000079337', 'ENSG00000079459', 'ENSG00000079691', 'ENSG00000079739', 'ENSG00000079785', 'ENSG00000079819', 'ENSG00000079931', 'ENSG00000079999', 'ENSG00000080200', 'ENSG00000081052', 'ENSG00000081059', 'ENSG00000081377', 'ENSG00000081665', 'ENSG00000081721', 'ENSG00000081791', 'ENSG00000082014', 'ENSG00000082074', 'ENSG00000082212', 'ENSG00000082781', 'ENSG00000083454', 'ENSG00000083457', 'ENSG00000083807', 'ENSG00000083828', 'ENSG00000083842', 'ENSG00000083845', 'ENSG00000084070', 'ENSG00000084112', 'ENSG00000084444', 'ENSG00000084623', 'ENSG00000084636', 'ENSG00000084754', 'ENSG00000085382', 'ENSG00000085415', 'ENSG00000085465', 'ENSG00000085491', 'ENSG00000085644', 'ENSG00000085721', 'ENSG00000085871', 'ENSG00000085982', 'ENSG00000086062', 'ENSG00000086232', 'ENSG00000086289', 'ENSG00000086300', 'ENSG00000086504', 'ENSG00000086544', 'ENSG00000086619', 'ENSG00000086967', 'ENSG00000087008', 'ENSG00000087076', 'ENSG00000087157', 'ENSG00000087191', 'ENSG00000087237', 'ENSG00000087299', 'ENSG00000088205', 'ENSG00000088808', 'ENSG00000088826', 'ENSG00000088832', 'ENSG00000088854', 'ENSG00000088882', 'ENSG00000088992', 'ENSG00000089057', 'ENSG00000089063', 'ENSG00000089127', 'ENSG00000089163', 'ENSG00000089177', 'ENSG00000089250', 'ENSG00000089327', 'ENSG00000089335', 'ENSG00000089486', 'ENSG00000089639', 'ENSG00000089685', 'ENSG00000089693', 'ENSG00000089737', 'ENSG00000089876', 'ENSG00000089916', 'ENSG00000090054', 'ENSG00000090266', 'ENSG00000090372', 'ENSG00000090376', 'ENSG00000090432', 'ENSG00000090621', 'ENSG00000090686', 'ENSG00000090857', 'ENSG00000090920', 'ENSG00000090971', 'ENSG00000091106', 'ENSG00000091127', 'ENSG00000091436', 'ENSG00000091490', 'ENSG00000091527', 'ENSG00000091542', 'ENSG00000091622', 'ENSG00000091640', 'ENSG00000091844', 'ENSG00000091947', 'ENSG00000092009', 'ENSG00000092010', 'ENSG00000092036', 'ENSG00000092094', 'ENSG00000092295', 'ENSG00000092607', 'ENSG00000092758', 'ENSG00000093010', 'ENSG00000093100', 'ENSG00000093134', 'ENSG00000095209', 'ENSG00000095321', 'ENSG00000095739', 'ENSG00000095794', 'ENSG00000095932', 'ENSG00000096060', 'ENSG00000096092', 'ENSG00000096264', 'ENSG00000096717', 'ENSG00000096872', 'ENSG00000096996', 'ENSG00000099203', 'ENSG00000099282', 'ENSG00000099326', 'ENSG00000099330', 'ENSG00000099365', 'ENSG00000099785', 'ENSG00000099804', 'ENSG00000099817', 'ENSG00000099821', 'ENSG00000099940', 'ENSG00000099956', 'ENSG00000099974', 'ENSG00000100031', 'ENSG00000100075', 'ENSG00000100099', 'ENSG00000100116', 'ENSG00000100124', 'ENSG00000100147', 'ENSG00000100154', 'ENSG00000100162', 'ENSG00000100197', 'ENSG00000100243', 'ENSG00000100266', 'ENSG00000100290', 'ENSG00000100297', 'ENSG00000100299', 'ENSG00000100300', 'ENSG00000100304', 'ENSG00000100311', 'ENSG00000100321', 'ENSG00000100336', 'ENSG00000100360', 'ENSG00000100364', 'ENSG00000100365', 'ENSG00000100368', 'ENSG00000100376', 'ENSG00000100385', 'ENSG00000100413', 'ENSG00000100417', 'ENSG00000100422', 'ENSG00000100427', 'ENSG00000100473', 'ENSG00000100504', 'ENSG00000100505', 'ENSG00000100564', 'ENSG00000100577', 'ENSG00000100580', 'ENSG00000100592', 'ENSG00000100596', 'ENSG00000100625', 'ENSG00000100721', 'ENSG00000100722', 'ENSG00000100744', 'ENSG00000100908', 'ENSG00000100968', 'ENSG00000100979', 'ENSG00000100983', 'ENSG00000100994', 'ENSG00000100997', 'ENSG00000101000', 'ENSG00000101052', 'ENSG00000101057', 'ENSG00000101104', 'ENSG00000101158', 'ENSG00000101161', 'ENSG00000101162', 'ENSG00000101181', 'ENSG00000101190', 'ENSG00000101191', 'ENSG00000101197', 'ENSG00000101216', 'ENSG00000101220', 'ENSG00000101353', 'ENSG00000101361', 'ENSG00000101363', 'ENSG00000101439', 'ENSG00000101442', 'ENSG00000101443', 'ENSG00000101444', 'ENSG00000101473', 'ENSG00000101546', 'ENSG00000101574', 'ENSG00000101577', 'ENSG00000101596', 'ENSG00000101605', 'ENSG00000101624', 'ENSG00000101638', 'ENSG00000101751', 'ENSG00000101752', 'ENSG00000102445', 'ENSG00000102554', 'ENSG00000102595', 'ENSG00000102606', 'ENSG00000102699', 'ENSG00000102743', 'ENSG00000102755', 'ENSG00000102781', 'ENSG00000102886', 'ENSG00000103021', 'ENSG00000103034', 'ENSG00000103056', 'ENSG00000103121', 'ENSG00000103148', 'ENSG00000103174', 'ENSG00000103187', 'ENSG00000103199', 'ENSG00000103202', 'ENSG00000103227', 'ENSG00000103245', 'ENSG00000103479', 'ENSG00000103510', 'ENSG00000103540', 'ENSG00000103550', 'ENSG00000103569', 'ENSG00000103657', 'ENSG00000103811', 'ENSG00000104043', 'ENSG00000104055', 'ENSG00000104059', 'ENSG00000104093', 'ENSG00000104213', 'ENSG00000104219', 'ENSG00000104321', 'ENSG00000104341', 'ENSG00000104361', 'ENSG00000104419', 'ENSG00000104427', 'ENSG00000104442', 'ENSG00000104472', 'ENSG00000104490', 'ENSG00000104497', 'ENSG00000104518', 'ENSG00000104611', 'ENSG00000104689', 'ENSG00000104738', 'ENSG00000104804', 'ENSG00000104805', 'ENSG00000104823', 'ENSG00000104835', 'ENSG00000104863', 'ENSG00000104870', 'ENSG00000104872', 'ENSG00000104883', 'ENSG00000104894', 'ENSG00000104951', 'ENSG00000104953', 'ENSG00000104964', 'ENSG00000104972', 'ENSG00000104979', 'ENSG00000105011', 'ENSG00000105063', 'ENSG00000105136', 'ENSG00000105146', 'ENSG00000105186', 'ENSG00000105245', 'ENSG00000105248', 'ENSG00000105258', 'ENSG00000105287', 'ENSG00000105290', 'ENSG00000105298', 'ENSG00000105321', 'ENSG00000105339', 'ENSG00000105341', 'ENSG00000105371', 'ENSG00000105401', 'ENSG00000105404', 'ENSG00000105426', 'ENSG00000105464', 'ENSG00000105497', 'ENSG00000105499', 'ENSG00000105501', 'ENSG00000105519', 'ENSG00000105520', 'ENSG00000105568', 'ENSG00000105607', 'ENSG00000105609', 'ENSG00000105618', 'ENSG00000105650', 'ENSG00000105656', 'ENSG00000105672', 'ENSG00000105695', 'ENSG00000105699', 'ENSG00000105750', 'ENSG00000105755', 'ENSG00000105771', 'ENSG00000105808', 'ENSG00000105829', 'ENSG00000105855', 'ENSG00000105875', 'ENSG00000105877', 'ENSG00000105887', 'ENSG00000105928', 'ENSG00000105963', 'ENSG00000105971', 'ENSG00000105974', 'ENSG00000106049', 'ENSG00000106100', 'ENSG00000106123', 'ENSG00000106125', 'ENSG00000106153', 'ENSG00000106302', 'ENSG00000106366', 'ENSG00000106392', 'ENSG00000106404', 'ENSG00000106460', 'ENSG00000106477', 'ENSG00000106484', 'ENSG00000106538', 'ENSG00000106591', 'ENSG00000106603', 'ENSG00000106617', 'ENSG00000106624', 'ENSG00000106733', 'ENSG00000106771', 'ENSG00000106772', 'ENSG00000106780', 'ENSG00000106789', 'ENSG00000106976', 'ENSG00000107020', 'ENSG00000107104', 'ENSG00000107281', 'ENSG00000107521', 'ENSG00000107537', 'ENSG00000107551', 'ENSG00000107554', 'ENSG00000107679', 'ENSG00000107719', 'ENSG00000107738', 'ENSG00000107745', 'ENSG00000107771', 'ENSG00000107796', 'ENSG00000107854', 'ENSG00000107882', 'ENSG00000107902', 'ENSG00000107951', 'ENSG00000107959', 'ENSG00000107960', 'ENSG00000108010', 'ENSG00000108039', 'ENSG00000108107', 'ENSG00000108262', 'ENSG00000108264', 'ENSG00000108272', 'ENSG00000108278', 'ENSG00000108294', 'ENSG00000108349', 'ENSG00000108352', 'ENSG00000108375', 'ENSG00000108379', 'ENSG00000108384', 'ENSG00000108389', 'ENSG00000108395', 'ENSG00000108405', 'ENSG00000108406', 'ENSG00000108433', 'ENSG00000108439', 'ENSG00000108448', 'ENSG00000108556', 'ENSG00000108559', 'ENSG00000108587', 'ENSG00000108592', 'ENSG00000108666', 'ENSG00000108771', 'ENSG00000108797', 'ENSG00000108813', 'ENSG00000108823', 'ENSG00000108883', 'ENSG00000108960', 'ENSG00000109063', 'ENSG00000109084', 'ENSG00000109163', 'ENSG00000109265', 'ENSG00000109390', 'ENSG00000109519', 'ENSG00000109667', 'ENSG00000109674', 'ENSG00000109684', 'ENSG00000109689', 'ENSG00000109794', 'ENSG00000109814', 'ENSG00000109854', 'ENSG00000109919', 'ENSG00000109927', 'ENSG00000109944', 'ENSG00000110031', 'ENSG00000110042', 'ENSG00000110074', 'ENSG00000110080', 'ENSG00000110092', 'ENSG00000110108', 'ENSG00000110171', 'ENSG00000110218', 'ENSG00000110315', 'ENSG00000110328', 'ENSG00000110344', 'ENSG00000110375', 'ENSG00000110427', 'ENSG00000110435', 'ENSG00000110455', 'ENSG00000110628', 'ENSG00000110851', 'ENSG00000110880', 'ENSG00000111196', 'ENSG00000111215', 'ENSG00000111245', 'ENSG00000111254', 'ENSG00000111321', 'ENSG00000111328', 'ENSG00000111331', 'ENSG00000111452', 'ENSG00000111602', 'ENSG00000111666', 'ENSG00000111671', 'ENSG00000111696', 'ENSG00000111725', 'ENSG00000111801', 'ENSG00000111816', 'ENSG00000111843', 'ENSG00000111846', 'ENSG00000111850', 'ENSG00000111863', 'ENSG00000111875', 'ENSG00000111880', 'ENSG00000111886', 'ENSG00000111906', 'ENSG00000111962', 'ENSG00000112039', 'ENSG00000112081', 'ENSG00000112096', 'ENSG00000112139', 'ENSG00000112195', 'ENSG00000112210', 'ENSG00000112218', 'ENSG00000112290', 'ENSG00000112294', 'ENSG00000112297', 'ENSG00000112306', 'ENSG00000112308', 'ENSG00000112343', 'ENSG00000112584', 'ENSG00000112599', 'ENSG00000112664', 'ENSG00000112667', 'ENSG00000112679', 'ENSG00000112697', 'ENSG00000112763', 'ENSG00000112787', 'ENSG00000112799', 'ENSG00000112874', 'ENSG00000112977', 'ENSG00000112992', 'ENSG00000113231', 'ENSG00000113273', 'ENSG00000113296', 'ENSG00000113318', 'ENSG00000113319', 'ENSG00000113441', 'ENSG00000113494', 'ENSG00000113504', 'ENSG00000113638', 'ENSG00000113645', 'ENSG00000113721', 'ENSG00000113734', 'ENSG00000113758', 'ENSG00000113812', 'ENSG00000113946', 'ENSG00000113971', 'ENSG00000114021', 'ENSG00000114054', 'ENSG00000114107', 'ENSG00000114166', 'ENSG00000114446', 'ENSG00000114455', 'ENSG00000114529', 'ENSG00000114757', 'ENSG00000114805', 'ENSG00000115107', 'ENSG00000115109', 'ENSG00000115129', 'ENSG00000115138', 'ENSG00000115216', 'ENSG00000115257', 'ENSG00000115268', 'ENSG00000115282', 'ENSG00000115306', 'ENSG00000115310', 'ENSG00000115350', 'ENSG00000115364', 'ENSG00000115368', 'ENSG00000115423', 'ENSG00000115486', 'ENSG00000115525', 'ENSG00000115590', 'ENSG00000115594', 'ENSG00000115649', 'ENSG00000115657', 'ENSG00000115677', 'ENSG00000115687', 'ENSG00000115750', 'ENSG00000115825', 'ENSG00000115828', 'ENSG00000115850', 'ENSG00000115884', 'ENSG00000115902', 'ENSG00000115919', 'ENSG00000115944', 'ENSG00000115946', 'ENSG00000115947', 'ENSG00000116120', 'ENSG00000116127', 'ENSG00000116133', 'ENSG00000116157', 'ENSG00000116198', 'ENSG00000116213', 'ENSG00000116237', 'ENSG00000116260', 'ENSG00000116406', 'ENSG00000116473', 'ENSG00000116489', 'ENSG00000116514', 'ENSG00000116663', 'ENSG00000116679', 'ENSG00000116704', 'ENSG00000116711', 'ENSG00000116741', 'ENSG00000116761', 'ENSG00000116771', 'ENSG00000116791', 'ENSG00000116815', 'ENSG00000116857', 'ENSG00000116883', 'ENSG00000116954', 'ENSG00000116957', 'ENSG00000116977', 'ENSG00000116981', 'ENSG00000116983', 'ENSG00000116985', 'ENSG00000117013', 'ENSG00000117091', 'ENSG00000117115', 'ENSG00000117133', 'ENSG00000117153', 'ENSG00000117174', 'ENSG00000117226', 'ENSG00000117228', 'ENSG00000117280', 'ENSG00000117335', 'ENSG00000117362', 'ENSG00000117394', 'ENSG00000117480', 'ENSG00000117481', 'ENSG00000117500', 'ENSG00000117505', 'ENSG00000117569', 'ENSG00000117595', 'ENSG00000117748', 'ENSG00000117791', 'ENSG00000117868', 'ENSG00000118096', 'ENSG00000118162', 'ENSG00000118197', 'ENSG00000118217', 'ENSG00000118418', 'ENSG00000118432', 'ENSG00000118507', 'ENSG00000118514', 'ENSG00000118564', 'ENSG00000118579', 'ENSG00000118640', 'ENSG00000118680', 'ENSG00000118894', 'ENSG00000118961', 'ENSG00000119125', 'ENSG00000119139', 'ENSG00000119185', 'ENSG00000119227', 'ENSG00000119242', 'ENSG00000119280', 'ENSG00000119314', 'ENSG00000119326', 'ENSG00000119411', 'ENSG00000119431', 'ENSG00000119471', 'ENSG00000119514', 'ENSG00000119541', 'ENSG00000119599', 'ENSG00000119608', 'ENSG00000119632', 'ENSG00000119640', 'ENSG00000119669', 'ENSG00000119673', 'ENSG00000119718', 'ENSG00000119723', 'ENSG00000119771', 'ENSG00000119787', 'ENSG00000119844', 'ENSG00000119878', 'ENSG00000119900', 'ENSG00000119906', 'ENSG00000119950', 'ENSG00000119965', 'ENSG00000119977', 'ENSG00000120029', 'ENSG00000120051', 'ENSG00000120071', 'ENSG00000120087', 'ENSG00000120088', 'ENSG00000120162', 'ENSG00000120437', 'ENSG00000120549', 'ENSG00000120594', 'ENSG00000120658', 'ENSG00000120659', 'ENSG00000120675', 'ENSG00000120784', 'ENSG00000120860', 'ENSG00000120915', 'ENSG00000121083', 'ENSG00000121104', 'ENSG00000121289', 'ENSG00000121310', 'ENSG00000121410', 'ENSG00000121454', 'ENSG00000121552', 'ENSG00000121691', 'ENSG00000121716', 'ENSG00000121895', 'ENSG00000121897', 'ENSG00000121989', 'ENSG00000122034', 'ENSG00000122223', 'ENSG00000122224', 'ENSG00000122335', 'ENSG00000122359', 'ENSG00000122386', 'ENSG00000122481', 'ENSG00000122497', 'ENSG00000122641', 'ENSG00000122674', 'ENSG00000122741', 'ENSG00000122783', 'ENSG00000122863', 'ENSG00000122912', 'ENSG00000122965', 'ENSG00000123179', 'ENSG00000123191', 'ENSG00000123219', 'ENSG00000123297', 'ENSG00000123360', 'ENSG00000123415', 'ENSG00000123453', 'ENSG00000123685', 'ENSG00000123810', 'ENSG00000123815', 'ENSG00000123843', 'ENSG00000124145', 'ENSG00000124164', 'ENSG00000124171', 'ENSG00000124225', 'ENSG00000124275', 'ENSG00000124299', 'ENSG00000124357', 'ENSG00000124491', 'ENSG00000124496', 'ENSG00000124508', 'ENSG00000124532', 'ENSG00000124535', 'ENSG00000124562', 'ENSG00000124570', 'ENSG00000124587', 'ENSG00000124588', 'ENSG00000124593', 'ENSG00000124613', 'ENSG00000124615', 'ENSG00000124713', 'ENSG00000124721', 'ENSG00000124733', 'ENSG00000124784', 'ENSG00000124787', 'ENSG00000125124', 'ENSG00000125166', 'ENSG00000125170', 'ENSG00000125247', 'ENSG00000125319', 'ENSG00000125388', 'ENSG00000125430', 'ENSG00000125445', 'ENSG00000125450', 'ENSG00000125485', 'ENSG00000125503', 'ENSG00000125510', 'ENSG00000125534', 'ENSG00000125538', 'ENSG00000125551', 'ENSG00000125618', 'ENSG00000125629', 'ENSG00000125637', 'ENSG00000125648', 'ENSG00000125703', 'ENSG00000125734', 'ENSG00000125735', 'ENSG00000125743', 'ENSG00000125744', 'ENSG00000125753', 'ENSG00000125755', 'ENSG00000125775', 'ENSG00000125818', 'ENSG00000125821', 'ENSG00000125843', 'ENSG00000125868', 'ENSG00000125871', 'ENSG00000125877', 'ENSG00000125885', 'ENSG00000125901', 'ENSG00000125910', 'ENSG00000125912', 'ENSG00000125966', 'ENSG00000126070', 'ENSG00000126091', 'ENSG00000126106', 'ENSG00000126216', 'ENSG00000126217', 'ENSG00000126246', 'ENSG00000126266', 'ENSG00000126432', 'ENSG00000126709', 'ENSG00000126790', 'ENSG00000126858', 'ENSG00000126860', 'ENSG00000126870', 'ENSG00000127220', 'ENSG00000127249', 'ENSG00000127337', 'ENSG00000127366', 'ENSG00000127399', 'ENSG00000127415', 'ENSG00000127418', 'ENSG00000127445', 'ENSG00000127507', 'ENSG00000127561', 'ENSG00000127616', 'ENSG00000127666', 'ENSG00000127884', 'ENSG00000127946', 'ENSG00000127948', 'ENSG00000127951', 'ENSG00000127952', 'ENSG00000128039', 'ENSG00000128185', 'ENSG00000128218', 'ENSG00000128245', 'ENSG00000128253', 'ENSG00000128266', 'ENSG00000128274', 'ENSG00000128276', 'ENSG00000128284', 'ENSG00000128383', 'ENSG00000128408', 'ENSG00000128487', 'ENSG00000128510', 'ENSG00000128578', 'ENSG00000128604', 'ENSG00000128641', 'ENSG00000128683', 'ENSG00000128708', 'ENSG00000128789', 'ENSG00000128805', 'ENSG00000128833', 'ENSG00000128886', 'ENSG00000128891', 'ENSG00000129003', 'ENSG00000129048', 'ENSG00000129055', 'ENSG00000129103', 'ENSG00000129195', 'ENSG00000129204', 'ENSG00000129282', 'ENSG00000129317', 'ENSG00000129422', 'ENSG00000129562', 'ENSG00000129566', 'ENSG00000129625', 'ENSG00000129657', 'ENSG00000129667', 'ENSG00000129673', 'ENSG00000129925', 'ENSG00000129993', 'ENSG00000130175', 'ENSG00000130177', 'ENSG00000130299', 'ENSG00000130300', 'ENSG00000130309', 'ENSG00000130312', 'ENSG00000130338', 'ENSG00000130348', 'ENSG00000130363', 'ENSG00000130377', 'ENSG00000130413', 'ENSG00000130414', 'ENSG00000130477', 'ENSG00000130487', 'ENSG00000130513', 'ENSG00000130544', 'ENSG00000130584', 'ENSG00000130590', 'ENSG00000130635', 'ENSG00000130640', 'ENSG00000130653', 'ENSG00000130669', 'ENSG00000130695', 'ENSG00000130725', 'ENSG00000130731', 'ENSG00000130758', 'ENSG00000130768', 'ENSG00000130810', 'ENSG00000130812', 'ENSG00000130943', 'ENSG00000130950', 'ENSG00000130956', 'ENSG00000131013', 'ENSG00000131042', 'ENSG00000131044', 'ENSG00000131100', 'ENSG00000131148', 'ENSG00000131153', 'ENSG00000131188', 'ENSG00000131238', 'ENSG00000131323', 'ENSG00000131351', 'ENSG00000131370', 'ENSG00000131373', 'ENSG00000131378', 'ENSG00000131379', 'ENSG00000131398', 'ENSG00000131435', 'ENSG00000131459', 'ENSG00000131484', 'ENSG00000131507', 'ENSG00000131669', 'ENSG00000131697', 'ENSG00000131711', 'ENSG00000131845', 'ENSG00000131849', 'ENSG00000131899', 'ENSG00000131944', 'ENSG00000132003', 'ENSG00000132141', 'ENSG00000132170', 'ENSG00000132185', 'ENSG00000132196', 'ENSG00000132199', 'ENSG00000132205', 'ENSG00000132256', 'ENSG00000132274', 'ENSG00000132305', 'ENSG00000132313', 'ENSG00000132334', 'ENSG00000132357', 'ENSG00000132359', 'ENSG00000132388', 'ENSG00000132406', 'ENSG00000132423', 'ENSG00000132436', 'ENSG00000132481', 'ENSG00000132507', 'ENSG00000132541', 'ENSG00000132600', 'ENSG00000132623', 'ENSG00000132664', 'ENSG00000132740', 'ENSG00000132781', 'ENSG00000132819', 'ENSG00000132823', 'ENSG00000132837', 'ENSG00000132842', 'ENSG00000132958', 'ENSG00000133048', 'ENSG00000133059', 'ENSG00000133065', 'ENSG00000133101', 'ENSG00000133104', 'ENSG00000133106', 'ENSG00000133116', 'ENSG00000133121', 'ENSG00000133195', 'ENSG00000133313', 'ENSG00000133392', 'ENSG00000133466', 'ENSG00000133574', 'ENSG00000133687', 'ENSG00000133704', 'ENSG00000133739', 'ENSG00000133789', 'ENSG00000133816', 'ENSG00000133835', 'ENSG00000133863', 'ENSG00000133985', 'ENSG00000134046', 'ENSG00000134056', 'ENSG00000134058', 'ENSG00000134070', 'ENSG00000134077', 'ENSG00000134184', 'ENSG00000134201', 'ENSG00000134202', 'ENSG00000134243', 'ENSG00000134255', 'ENSG00000134262', 'ENSG00000134265', 'ENSG00000134278', 'ENSG00000134317', 'ENSG00000134369', 'ENSG00000134463', 'ENSG00000134548', 'ENSG00000134551', 'ENSG00000134574', 'ENSG00000134575', 'ENSG00000134627', 'ENSG00000134709', 'ENSG00000134755', 'ENSG00000134759', 'ENSG00000134779', 'ENSG00000134809', 'ENSG00000134824', 'ENSG00000134851', 'ENSG00000134905', 'ENSG00000134955', 'ENSG00000135002', 'ENSG00000135052', 'ENSG00000135074', 'ENSG00000135077', 'ENSG00000135124', 'ENSG00000135211', 'ENSG00000135299', 'ENSG00000135318', 'ENSG00000135334', 'ENSG00000135336', 'ENSG00000135362', 'ENSG00000135390', 'ENSG00000135404', 'ENSG00000135424', 'ENSG00000135441', 'ENSG00000135506', 'ENSG00000135525', 'ENSG00000135541', 'ENSG00000135587', 'ENSG00000135643', 'ENSG00000135698', 'ENSG00000135778', 'ENSG00000135821', 'ENSG00000135828', 'ENSG00000135842', 'ENSG00000135898', 'ENSG00000135905', 'ENSG00000135926', 'ENSG00000135932', 'ENSG00000135951', 'ENSG00000135972', 'ENSG00000136002', 'ENSG00000136010', 'ENSG00000136051', 'ENSG00000136052', 'ENSG00000136068', 'ENSG00000136098', 'ENSG00000136108', 'ENSG00000136111', 'ENSG00000136141', 'ENSG00000136144', 'ENSG00000136158', 'ENSG00000136159', 'ENSG00000136160', 'ENSG00000136167', 'ENSG00000136231', 'ENSG00000136235', 'ENSG00000136237', 'ENSG00000136238', 'ENSG00000136240', 'ENSG00000136247', 'ENSG00000136270', 'ENSG00000136280', 'ENSG00000136371', 'ENSG00000136378', 'ENSG00000136425', 'ENSG00000136436', 'ENSG00000136448', 'ENSG00000136449', 'ENSG00000136492', 'ENSG00000136573', 'ENSG00000136653', 'ENSG00000136689', 'ENSG00000136710', 'ENSG00000136717', 'ENSG00000136810', 'ENSG00000136842', 'ENSG00000136848', 'ENSG00000136856', 'ENSG00000136866', 'ENSG00000136868', 'ENSG00000136869', 'ENSG00000136875', 'ENSG00000136897', 'ENSG00000136925', 'ENSG00000136982', 'ENSG00000137054', 'ENSG00000137101', 'ENSG00000137106', 'ENSG00000137168', 'ENSG00000137193', 'ENSG00000137225', 'ENSG00000137251', 'ENSG00000137267', 'ENSG00000137274', 'ENSG00000137285', 'ENSG00000137288', 'ENSG00000137310', 'ENSG00000137331', 'ENSG00000137411', 'ENSG00000137413', 'ENSG00000137449', 'ENSG00000137462', 'ENSG00000137486', 'ENSG00000137501', 'ENSG00000137547', 'ENSG00000137714', 'ENSG00000137731', 'ENSG00000137767', 'ENSG00000137806', 'ENSG00000137841', 'ENSG00000137877', 'ENSG00000137880', 'ENSG00000138028', 'ENSG00000138029', 'ENSG00000138030', 'ENSG00000138031', 'ENSG00000138035', 'ENSG00000138036', 'ENSG00000138061', 'ENSG00000138083', 'ENSG00000138085', 'ENSG00000138095', 'ENSG00000138101', 'ENSG00000138107', 'ENSG00000138134', 'ENSG00000138175', 'ENSG00000138185', 'ENSG00000138297', 'ENSG00000138346', 'ENSG00000138375', 'ENSG00000138378', 'ENSG00000138399', 'ENSG00000138400', 'ENSG00000138439', 'ENSG00000138468', 'ENSG00000138495', 'ENSG00000138615', 'ENSG00000138617', 'ENSG00000138621', 'ENSG00000138639', 'ENSG00000138641', 'ENSG00000138678', 'ENSG00000138685', 'ENSG00000138686', 'ENSG00000138709', 'ENSG00000138722', 'ENSG00000138735', 'ENSG00000138744', 'ENSG00000138772', 'ENSG00000138780', 'ENSG00000138796', 'ENSG00000138801', 'ENSG00000138823', 'ENSG00000138964', 'ENSG00000139044', 'ENSG00000139182', 'ENSG00000139187', 'ENSG00000139190', 'ENSG00000139192', 'ENSG00000139197', 'ENSG00000139410', 'ENSG00000139428', 'ENSG00000139508', 'ENSG00000139514', 'ENSG00000139537', 'ENSG00000139620', 'ENSG00000139714', 'ENSG00000139832', 'ENSG00000139835', 'ENSG00000139899', 'ENSG00000139921', 'ENSG00000139998', 'ENSG00000140006', 'ENSG00000140009', 'ENSG00000140030', 'ENSG00000140092', 'ENSG00000140105', 'ENSG00000140262', 'ENSG00000140263', 'ENSG00000140264', 'ENSG00000140297', 'ENSG00000140368', 'ENSG00000140386', 'ENSG00000140391', 'ENSG00000140403', 'ENSG00000140474', 'ENSG00000140479', 'ENSG00000140525', 'ENSG00000140534', 'ENSG00000140545', 'ENSG00000140718', 'ENSG00000140832', 'ENSG00000140848', 'ENSG00000140876', 'ENSG00000140905', 'ENSG00000140988', 'ENSG00000141012', 'ENSG00000141028', 'ENSG00000141127', 'ENSG00000141141', 'ENSG00000141293', 'ENSG00000141294', 'ENSG00000141295', 'ENSG00000141314', 'ENSG00000141380', 'ENSG00000141384', 'ENSG00000141391', 'ENSG00000141428', 'ENSG00000141452', 'ENSG00000141458', 'ENSG00000141469', 'ENSG00000141504', 'ENSG00000141540', 'ENSG00000141542', 'ENSG00000141556', 'ENSG00000141560', 'ENSG00000141562', 'ENSG00000141569', 'ENSG00000141570', 'ENSG00000141576', 'ENSG00000141580', 'ENSG00000141696', 'ENSG00000141698', 'ENSG00000141756', 'ENSG00000141759', 'ENSG00000141956', 'ENSG00000141965', 'ENSG00000141994', 'ENSG00000142046', 'ENSG00000142065', 'ENSG00000142089', 'ENSG00000142102', 'ENSG00000142149', 'ENSG00000142207', 'ENSG00000142224', 'ENSG00000142252', 'ENSG00000142453', 'ENSG00000142534', 'ENSG00000142583', 'ENSG00000142621', 'ENSG00000142632', 'ENSG00000142675', 'ENSG00000142684', 'ENSG00000142686', 'ENSG00000142794', 'ENSG00000142856', 'ENSG00000142867', 'ENSG00000143079', 'ENSG00000143149', 'ENSG00000143153', 'ENSG00000143155', 'ENSG00000143157', 'ENSG00000143158', 'ENSG00000143178', 'ENSG00000143195', 'ENSG00000143198', 'ENSG00000143226', 'ENSG00000143228', 'ENSG00000143248', 'ENSG00000143353', 'ENSG00000143387', 'ENSG00000143498', 'ENSG00000143537', 'ENSG00000143554', 'ENSG00000143570', 'ENSG00000143643', 'ENSG00000143653', 'ENSG00000143727', 'ENSG00000143776', 'ENSG00000143797', 'ENSG00000144021', 'ENSG00000144026', 'ENSG00000144034', 'ENSG00000144118', 'ENSG00000144120', 'ENSG00000144199', 'ENSG00000144231', 'ENSG00000144455', 'ENSG00000144485', 'ENSG00000144488', 'ENSG00000144559', 'ENSG00000144597', 'ENSG00000144642', 'ENSG00000144645', 'ENSG00000144647', 'ENSG00000144655', 'ENSG00000144677', 'ENSG00000144712', 'ENSG00000144741', 'ENSG00000144746', 'ENSG00000144821', 'ENSG00000144824', 'ENSG00000144827', 'ENSG00000144843', 'ENSG00000144868', 'ENSG00000145002', 'ENSG00000145020', 'ENSG00000145088', 'ENSG00000145214', 'ENSG00000145246', 'ENSG00000145284', 'ENSG00000145287', 'ENSG00000145348', 'ENSG00000145354', 'ENSG00000145358', 'ENSG00000145365', 'ENSG00000145386', 'ENSG00000145416', 'ENSG00000145476', 'ENSG00000145725', 'ENSG00000145736', 'ENSG00000145777', 'ENSG00000145781', 'ENSG00000145817', 'ENSG00000145882', 'ENSG00000145934', 'ENSG00000145949', 'ENSG00000145965', 'ENSG00000145979', 'ENSG00000145982', 'ENSG00000145996', 'ENSG00000146066', 'ENSG00000146085', 'ENSG00000146094', 'ENSG00000146109', 'ENSG00000146192', 'ENSG00000146205', 'ENSG00000146242', 'ENSG00000146243', 'ENSG00000146281', 'ENSG00000146376', 'ENSG00000146386', 'ENSG00000146409', 'ENSG00000146535', 'ENSG00000146574', 'ENSG00000146707', 'ENSG00000146733', 'ENSG00000146833', 'ENSG00000146856', 'ENSG00000146859', 'ENSG00000147316', 'ENSG00000147324', 'ENSG00000147408', 'ENSG00000147592', 'ENSG00000147684', 'ENSG00000147804', 'ENSG00000147813', 'ENSG00000147852', 'ENSG00000147853', 'ENSG00000147894', 'ENSG00000148019', 'ENSG00000148110', 'ENSG00000148120', 'ENSG00000148187', 'ENSG00000148218', 'ENSG00000148225', 'ENSG00000148229', 'ENSG00000148290', 'ENSG00000148296', 'ENSG00000148331', 'ENSG00000148335', 'ENSG00000148341', 'ENSG00000148377', 'ENSG00000148384', 'ENSG00000148411', 'ENSG00000148426', 'ENSG00000148450', 'ENSG00000148468', 'ENSG00000148484', 'ENSG00000148498', 'ENSG00000148634', 'ENSG00000148730', 'ENSG00000148814', 'ENSG00000148824', 'ENSG00000148841', 'ENSG00000148943', 'ENSG00000149050', 'ENSG00000149054', 'ENSG00000149084', 'ENSG00000149089', 'ENSG00000149115', 'ENSG00000149196', 'ENSG00000149201', 'ENSG00000149218', 'ENSG00000149231', 'ENSG00000149262', 'ENSG00000149292', 'ENSG00000149418', 'ENSG00000149489', 'ENSG00000149548', 'ENSG00000149591', 'ENSG00000149596', 'ENSG00000149599', 'ENSG00000149679', 'ENSG00000149922', 'ENSG00000150093', 'ENSG00000150403', 'ENSG00000150456', 'ENSG00000150527', 'ENSG00000150593', 'ENSG00000150625', 'ENSG00000150627', 'ENSG00000150667', 'ENSG00000150764', 'ENSG00000150768', 'ENSG00000150977', 'ENSG00000151012', 'ENSG00000151079', 'ENSG00000151135', 'ENSG00000151150', 'ENSG00000151229', 'ENSG00000151287', 'ENSG00000151353', 'ENSG00000151364', 'ENSG00000151470', 'ENSG00000151498', 'ENSG00000151500', 'ENSG00000151552', 'ENSG00000151640', 'ENSG00000151689', 'ENSG00000151690', 'ENSG00000151718', 'ENSG00000151725', 'ENSG00000151729', 'ENSG00000151773', 'ENSG00000151806', 'ENSG00000151917', 'ENSG00000151948', 'ENSG00000152128', 'ENSG00000152133', 'ENSG00000152207', 'ENSG00000152213', 'ENSG00000152219', 'ENSG00000152223', 'ENSG00000152291', 'ENSG00000152348', 'ENSG00000152359', 'ENSG00000152404', 'ENSG00000152492', 'ENSG00000152495', 'ENSG00000152558', 'ENSG00000152580', 'ENSG00000152601', 'ENSG00000152778', 'ENSG00000152904', 'ENSG00000152944', 'ENSG00000153060', 'ENSG00000153113', 'ENSG00000153130', 'ENSG00000153157', 'ENSG00000153201', 'ENSG00000153363', 'ENSG00000153391', 'ENSG00000153395', 'ENSG00000153406', 'ENSG00000153495', 'ENSG00000153531', 'ENSG00000153558', 'ENSG00000153574', 'ENSG00000153832', 'ENSG00000153898', 'ENSG00000153933', 'ENSG00000153989', 'ENSG00000154035', 'ENSG00000154040', 'ENSG00000154079', 'ENSG00000154099', 'ENSG00000154122', 'ENSG00000154134', 'ENSG00000154165', 'ENSG00000154310', 'ENSG00000154319', 'ENSG00000154359', 'ENSG00000154511', 'ENSG00000154537', 'ENSG00000154548', 'ENSG00000154645', 'ENSG00000154719', 'ENSG00000154743', 'ENSG00000154767', 'ENSG00000154803', 'ENSG00000154845', 'ENSG00000154864', 'ENSG00000154889', 'ENSG00000154930', 'ENSG00000155016', 'ENSG00000155085', 'ENSG00000155090', 'ENSG00000155093', 'ENSG00000155130', 'ENSG00000155158', 'ENSG00000155275', 'ENSG00000155307', 'ENSG00000155463', 'ENSG00000155465', 'ENSG00000155542', 'ENSG00000155719', 'ENSG00000155850', 'ENSG00000155858', 'ENSG00000156110', 'ENSG00000156171', 'ENSG00000156172', 'ENSG00000156239', 'ENSG00000156253', 'ENSG00000156261', 'ENSG00000156398', 'ENSG00000156482', 'ENSG00000156535', 'ENSG00000156599', 'ENSG00000156603', 'ENSG00000156711', 'ENSG00000156795', 'ENSG00000156869', 'ENSG00000156958', 'ENSG00000156966', 'ENSG00000156973', 'ENSG00000157017', 'ENSG00000157214', 'ENSG00000157227', 'ENSG00000157240', 'ENSG00000157322', 'ENSG00000157326', 'ENSG00000157335', 'ENSG00000157379', 'ENSG00000157426', 'ENSG00000157557', 'ENSG00000157601', 'ENSG00000157653', 'ENSG00000157680', 'ENSG00000157693', 'ENSG00000157764', 'ENSG00000157823', 'ENSG00000157873', 'ENSG00000158023', 'ENSG00000158106', 'ENSG00000158109', 'ENSG00000158122', 'ENSG00000158234', 'ENSG00000158270', 'ENSG00000158470', 'ENSG00000158483', 'ENSG00000158497', 'ENSG00000158555', 'ENSG00000158604', 'ENSG00000158623', 'ENSG00000158669', 'ENSG00000158711', 'ENSG00000158715', 'ENSG00000158717', 'ENSG00000158747', 'ENSG00000159055', 'ENSG00000159063', 'ENSG00000159110', 'ENSG00000159166', 'ENSG00000159202', 'ENSG00000159212', 'ENSG00000159228', 'ENSG00000159267', 'ENSG00000159314', 'ENSG00000159352', 'ENSG00000159479', 'ENSG00000159556', 'ENSG00000159588', 'ENSG00000159593', 'ENSG00000159733', 'ENSG00000159788', 'ENSG00000159884', 'ENSG00000159915', 'ENSG00000159958', 'ENSG00000160007', 'ENSG00000160013', 'ENSG00000160014', 'ENSG00000160111', 'ENSG00000160113', 'ENSG00000160117', 'ENSG00000160145', 'ENSG00000160185', 'ENSG00000160188', 'ENSG00000160193', 'ENSG00000160207', 'ENSG00000160209', 'ENSG00000160213', 'ENSG00000160233', 'ENSG00000160284', 'ENSG00000160285', 'ENSG00000160293', 'ENSG00000160310', 'ENSG00000160352', 'ENSG00000160392', 'ENSG00000160401', 'ENSG00000160439', 'ENSG00000160447', 'ENSG00000160588', 'ENSG00000160593', 'ENSG00000160712', 'ENSG00000160781', 'ENSG00000160856', 'ENSG00000160948', 'ENSG00000160949', 'ENSG00000160953', 'ENSG00000161016', 'ENSG00000161036', 'ENSG00000161091', 'ENSG00000161217', 'ENSG00000161265', 'ENSG00000161326', 'ENSG00000161513', 'ENSG00000161551', 'ENSG00000161570', 'ENSG00000161618', 'ENSG00000161640', 'ENSG00000161664', 'ENSG00000161888', 'ENSG00000161929', 'ENSG00000161958', 'ENSG00000161980', 'ENSG00000161981', 'ENSG00000162062', 'ENSG00000162076', 'ENSG00000162105', 'ENSG00000162174', 'ENSG00000162222', 'ENSG00000162384', 'ENSG00000162396', 'ENSG00000162441', 'ENSG00000162461', 'ENSG00000162482', 'ENSG00000162614', 'ENSG00000162616', 'ENSG00000162620', 'ENSG00000162631', 'ENSG00000162643', 'ENSG00000162654', 'ENSG00000162688', 'ENSG00000162733', 'ENSG00000162734', 'ENSG00000162769', 'ENSG00000162777', 'ENSG00000162817', 'ENSG00000162825', 'ENSG00000162836', 'ENSG00000162885', 'ENSG00000162927', 'ENSG00000162929', 'ENSG00000162946', 'ENSG00000162976', 'ENSG00000162994', 'ENSG00000163001', 'ENSG00000163002', 'ENSG00000163040', 'ENSG00000163041', 'ENSG00000163072', 'ENSG00000163131', 'ENSG00000163138', 'ENSG00000163191', 'ENSG00000163219', 'ENSG00000163249', 'ENSG00000163251', 'ENSG00000163281', 'ENSG00000163320', 'ENSG00000163322', 'ENSG00000163389', 'ENSG00000163393', 'ENSG00000163428', 'ENSG00000163430', 'ENSG00000163486', 'ENSG00000163528', 'ENSG00000163535', 'ENSG00000163564', 'ENSG00000163568', 'ENSG00000163584', 'ENSG00000163607', 'ENSG00000163644', 'ENSG00000163686', 'ENSG00000163687', 'ENSG00000163806', 'ENSG00000163807', 'ENSG00000163811', 'ENSG00000163814', 'ENSG00000163864', 'ENSG00000163875', 'ENSG00000163898', 'ENSG00000163931', 'ENSG00000163945', 'ENSG00000163959', 'ENSG00000163961', 'ENSG00000164002', 'ENSG00000164010', 'ENSG00000164022', 'ENSG00000164037', 'ENSG00000164048', 'ENSG00000164099', 'ENSG00000164111', 'ENSG00000164136', 'ENSG00000164144', 'ENSG00000164181', 'ENSG00000164190', 'ENSG00000164237', 'ENSG00000164253', 'ENSG00000164284', 'ENSG00000164307', 'ENSG00000164308', 'ENSG00000164338', 'ENSG00000164346', 'ENSG00000164347', 'ENSG00000164414', 'ENSG00000164440', 'ENSG00000164484', 'ENSG00000164494', 'ENSG00000164574', 'ENSG00000164587', 'ENSG00000164615', 'ENSG00000164627', 'ENSG00000164647', 'ENSG00000164695', 'ENSG00000164707', 'ENSG00000164708', 'ENSG00000164715', 'ENSG00000164733', 'ENSG00000164749', 'ENSG00000164761', 'ENSG00000164823', 'ENSG00000164896', 'ENSG00000164904', 'ENSG00000164924', 'ENSG00000164930', 'ENSG00000164933', 'ENSG00000164934', 'ENSG00000164941', 'ENSG00000164978', 'ENSG00000164985', 'ENSG00000164989', 'ENSG00000165025', 'ENSG00000165028', 'ENSG00000165118', 'ENSG00000165138', 'ENSG00000165171', 'ENSG00000165271', 'ENSG00000165275', 'ENSG00000165282', 'ENSG00000165390', 'ENSG00000165392', 'ENSG00000165410', 'ENSG00000165434', 'ENSG00000165449', 'ENSG00000165474', 'ENSG00000165476', 'ENSG00000165487', 'ENSG00000165502', 'ENSG00000165511', 'ENSG00000165555', 'ENSG00000165630', 'ENSG00000165633', 'ENSG00000165646', 'ENSG00000165661', 'ENSG00000165672', 'ENSG00000165714', 'ENSG00000165730', 'ENSG00000165752', 'ENSG00000165782', 'ENSG00000165801', 'ENSG00000165802', 'ENSG00000165810', 'ENSG00000165832', 'ENSG00000165879', 'ENSG00000165929', 'ENSG00000165935', 'ENSG00000165948', 'ENSG00000165983', 'ENSG00000165985', 'ENSG00000165996', 'ENSG00000165997', 'ENSG00000166002', 'ENSG00000166073', 'ENSG00000166130', 'ENSG00000166140', 'ENSG00000166260', 'ENSG00000166275', 'ENSG00000166278', 'ENSG00000166295', 'ENSG00000166321', 'ENSG00000166401', 'ENSG00000166435', 'ENSG00000166436', 'ENSG00000166439', 'ENSG00000166444', 'ENSG00000166452', 'ENSG00000166471', 'ENSG00000166478', 'ENSG00000166503', 'ENSG00000166529', 'ENSG00000166548', 'ENSG00000166582', 'ENSG00000166685', 'ENSG00000166704', 'ENSG00000166750', 'ENSG00000166762', 'ENSG00000166788', 'ENSG00000166793', 'ENSG00000166821', 'ENSG00000166839', 'ENSG00000166845', 'ENSG00000166847', 'ENSG00000166888', 'ENSG00000166896', 'ENSG00000166927', 'ENSG00000166938', 'ENSG00000166974', 'ENSG00000166997', 'ENSG00000167065', 'ENSG00000167074', 'ENSG00000167077', 'ENSG00000167081', 'ENSG00000167112', 'ENSG00000167131', 'ENSG00000167136', 'ENSG00000167159', 'ENSG00000167173', 'ENSG00000167182', 'ENSG00000167191', 'ENSG00000167202', 'ENSG00000167216', 'ENSG00000167220', 'ENSG00000167272', 'ENSG00000167280', 'ENSG00000167306', 'ENSG00000167363', 'ENSG00000167383', 'ENSG00000167384', 'ENSG00000167434', 'ENSG00000167460', 'ENSG00000167468', 'ENSG00000167535', 'ENSG00000167578', 'ENSG00000167608', 'ENSG00000167617', 'ENSG00000167634', 'ENSG00000167637', 'ENSG00000167642', 'ENSG00000167658', 'ENSG00000167670', 'ENSG00000167671', 'ENSG00000167705', 'ENSG00000167711', 'ENSG00000167720', 'ENSG00000167723', 'ENSG00000167740', 'ENSG00000167747', 'ENSG00000167748', 'ENSG00000167751', 'ENSG00000167766', 'ENSG00000167778', 'ENSG00000167780', 'ENSG00000167815', 'ENSG00000167840', 'ENSG00000167842', 'ENSG00000167850', 'ENSG00000167920', 'ENSG00000167965', 'ENSG00000167969', 'ENSG00000167981', 'ENSG00000168005', 'ENSG00000168028', 'ENSG00000168038', 'ENSG00000168078', 'ENSG00000168116', 'ENSG00000168209', 'ENSG00000168228', 'ENSG00000168255', 'ENSG00000168268', 'ENSG00000168274', 'ENSG00000168275', 'ENSG00000168297', 'ENSG00000168329', 'ENSG00000168356', 'ENSG00000168405', 'ENSG00000168411', 'ENSG00000168461', 'ENSG00000168487', 'ENSG00000168597', 'ENSG00000168614', 'ENSG00000168631', 'ENSG00000168646', 'ENSG00000168653', 'ENSG00000168675', 'ENSG00000168724', 'ENSG00000168765', 'ENSG00000168778', 'ENSG00000168792', 'ENSG00000168803', 'ENSG00000168806', 'ENSG00000168811', 'ENSG00000168894', 'ENSG00000168899', 'ENSG00000168916', 'ENSG00000168936', 'ENSG00000168944', 'ENSG00000169026', 'ENSG00000169047', 'ENSG00000169062', 'ENSG00000169087', 'ENSG00000169131', 'ENSG00000169136', 'ENSG00000169193', 'ENSG00000169217', 'ENSG00000169230', 'ENSG00000169231', 'ENSG00000169241', 'ENSG00000169245', 'ENSG00000169246', 'ENSG00000169252', 'ENSG00000169255', 'ENSG00000169282', 'ENSG00000169567', 'ENSG00000169570', 'ENSG00000169629', 'ENSG00000169660', 'ENSG00000169682', 'ENSG00000169715', 'ENSG00000169718', 'ENSG00000169738', 'ENSG00000169826', 'ENSG00000169857', 'ENSG00000169860', 'ENSG00000169902', 'ENSG00000169914', 'ENSG00000169991', 'ENSG00000170027', 'ENSG00000170074', 'ENSG00000170160', 'ENSG00000170161', 'ENSG00000170264', 'ENSG00000170291', 'ENSG00000170322', 'ENSG00000170382', 'ENSG00000170425', 'ENSG00000170430', 'ENSG00000170469', 'ENSG00000170542', 'ENSG00000170571', 'ENSG00000170638', 'ENSG00000170667', 'ENSG00000170689', 'ENSG00000170819', 'ENSG00000170846', 'ENSG00000170889', 'ENSG00000170915', 'ENSG00000170954', 'ENSG00000171033', 'ENSG00000171045', 'ENSG00000171067', 'ENSG00000171103', 'ENSG00000171115', 'ENSG00000171130', 'ENSG00000171135', 'ENSG00000171160', 'ENSG00000171161', 'ENSG00000171217', 'ENSG00000171246', 'ENSG00000171282', 'ENSG00000171298', 'ENSG00000171320', 'ENSG00000171368', 'ENSG00000171421', 'ENSG00000171469', 'ENSG00000171475', 'ENSG00000171476', 'ENSG00000171488', 'ENSG00000171502', 'ENSG00000171522', 'ENSG00000171574', 'ENSG00000171603', 'ENSG00000171617', 'ENSG00000171634', 'ENSG00000171680', 'ENSG00000171759', 'ENSG00000171763', 'ENSG00000171790', 'ENSG00000171792', 'ENSG00000171793', 'ENSG00000171806', 'ENSG00000171811', 'ENSG00000171848', 'ENSG00000171867', 'ENSG00000171916', 'ENSG00000171928', 'ENSG00000171940', 'ENSG00000171953', 'ENSG00000171962', 'ENSG00000171984', 'ENSG00000172006', 'ENSG00000172007', 'ENSG00000172014', 'ENSG00000172057', 'ENSG00000172058', 'ENSG00000172059', 'ENSG00000172062', 'ENSG00000172070', 'ENSG00000172113', 'ENSG00000172123', 'ENSG00000172197', 'ENSG00000172215', 'ENSG00000172239', 'ENSG00000172270', 'ENSG00000172292', 'ENSG00000172301', 'ENSG00000172331', 'ENSG00000172340', 'ENSG00000172345', 'ENSG00000172349', 'ENSG00000172403', 'ENSG00000172404', 'ENSG00000172500', 'ENSG00000172543', 'ENSG00000172548', 'ENSG00000172575', 'ENSG00000172590', 'ENSG00000172661', 'ENSG00000172671', 'ENSG00000172673', 'ENSG00000172687', 'ENSG00000172716', 'ENSG00000172728', 'ENSG00000172803', 'ENSG00000172818', 'ENSG00000172893', 'ENSG00000172927', 'ENSG00000172954', 'ENSG00000172985', 'ENSG00000173041', 'ENSG00000173085', 'ENSG00000173110', 'ENSG00000173113', 'ENSG00000173193', 'ENSG00000173200', 'ENSG00000173208', 'ENSG00000173209', 'ENSG00000173214', 'ENSG00000173221', 'ENSG00000173226', 'ENSG00000173272', 'ENSG00000173409', 'ENSG00000173457', 'ENSG00000173486', 'ENSG00000173535', 'ENSG00000173566', 'ENSG00000173621', 'ENSG00000173727', 'ENSG00000173809', 'ENSG00000173848', 'ENSG00000173894', 'ENSG00000173930', 'ENSG00000173991', 'ENSG00000173992', 'ENSG00000174007', 'ENSG00000174100', 'ENSG00000174123', 'ENSG00000174125', 'ENSG00000174130', 'ENSG00000174136', 'ENSG00000174137', 'ENSG00000174165', 'ENSG00000174177', 'ENSG00000174236', 'ENSG00000174327', 'ENSG00000174353', 'ENSG00000174374', 'ENSG00000174405', 'ENSG00000174529', 'ENSG00000174574', 'ENSG00000174586', 'ENSG00000174600', 'ENSG00000174628', 'ENSG00000174652', 'ENSG00000174721', 'ENSG00000174837', 'ENSG00000174851', 'ENSG00000174928', 'ENSG00000174989', 'ENSG00000175110', 'ENSG00000175193', 'ENSG00000175221', 'ENSG00000175265', 'ENSG00000175354', 'ENSG00000175489', 'ENSG00000175518', 'ENSG00000175567', 'ENSG00000175575', 'ENSG00000175581', 'ENSG00000175611', 'ENSG00000175643', 'ENSG00000175691', 'ENSG00000175711', 'ENSG00000175779', 'ENSG00000175866', 'ENSG00000175873', 'ENSG00000175895', 'ENSG00000176014', 'ENSG00000176022', 'ENSG00000176124', 'ENSG00000176125', 'ENSG00000176148', 'ENSG00000176209', 'ENSG00000176222', 'ENSG00000176381', 'ENSG00000176390', 'ENSG00000176393', 'ENSG00000176406', 'ENSG00000176422', 'ENSG00000176472', 'ENSG00000176485', 'ENSG00000176490', 'ENSG00000176531', 'ENSG00000176593', 'ENSG00000176624', 'ENSG00000176658', 'ENSG00000176681', 'ENSG00000176732', 'ENSG00000176749', 'ENSG00000176809', 'ENSG00000176894', 'ENSG00000176903', 'ENSG00000176909', 'ENSG00000176912', 'ENSG00000176945', 'ENSG00000176974', 'ENSG00000176978', 'ENSG00000176986', 'ENSG00000177000', 'ENSG00000177030', 'ENSG00000177076', 'ENSG00000177096', 'ENSG00000177103', 'ENSG00000177181', 'ENSG00000177182', 'ENSG00000177225', 'ENSG00000177272', 'ENSG00000177283', 'ENSG00000177303', 'ENSG00000177380', 'ENSG00000177465', 'ENSG00000177570', 'ENSG00000177576', 'ENSG00000177595', 'ENSG00000177602', 'ENSG00000177613', 'ENSG00000177628', 'ENSG00000177646', 'ENSG00000177674', 'ENSG00000177685', 'ENSG00000177697', 'ENSG00000177721', 'ENSG00000177757', 'ENSG00000177868', 'ENSG00000177875', 'ENSG00000177946', 'ENSG00000178015', 'ENSG00000178028', 'ENSG00000178053', 'ENSG00000178150', 'ENSG00000178184', 'ENSG00000178199', 'ENSG00000178201', 'ENSG00000178202', 'ENSG00000178209', 'ENSG00000178338', 'ENSG00000178343', 'ENSG00000178381', 'ENSG00000178409', 'ENSG00000178425', 'ENSG00000178445', 'ENSG00000178562', 'ENSG00000178567', 'ENSG00000178585', 'ENSG00000178623', 'ENSG00000178718', 'ENSG00000178773', 'ENSG00000178802', 'ENSG00000178878', 'ENSG00000178921', 'ENSG00000178966', 'ENSG00000178971', 'ENSG00000178996', 'ENSG00000179057', 'ENSG00000179115', 'ENSG00000179119', 'ENSG00000179163', 'ENSG00000179294', 'ENSG00000179344', 'ENSG00000179593', 'ENSG00000179598', 'ENSG00000179603', 'ENSG00000179630', 'ENSG00000179698', 'ENSG00000179750', 'ENSG00000179841', 'ENSG00000179855', 'ENSG00000179889', 'ENSG00000179918', 'ENSG00000179922', 'ENSG00000179933', 'ENSG00000179934', 'ENSG00000179950', 'ENSG00000179954', 'ENSG00000179979', 'ENSG00000179981', 'ENSG00000180011', 'ENSG00000180185', 'ENSG00000180340', 'ENSG00000180481', 'ENSG00000180539', 'ENSG00000180549', 'ENSG00000180611', 'ENSG00000180616', 'ENSG00000180628', 'ENSG00000180817', 'ENSG00000180822', 'ENSG00000180855', 'ENSG00000180884', 'ENSG00000180901', 'ENSG00000180902', 'ENSG00000180914', 'ENSG00000180953', 'ENSG00000180979', 'ENSG00000180992', 'ENSG00000181004', 'ENSG00000181007', 'ENSG00000181026', 'ENSG00000181027', 'ENSG00000181029', 'ENSG00000181031', 'ENSG00000181035', 'ENSG00000181074', 'ENSG00000181192', 'ENSG00000181240', 'ENSG00000181350', 'ENSG00000181396', 'ENSG00000181458', 'ENSG00000181649', 'ENSG00000181754', 'ENSG00000181798', 'ENSG00000181826', 'ENSG00000181856', 'ENSG00000181894', 'ENSG00000181915', 'ENSG00000182022', 'ENSG00000182093', 'ENSG00000182108', 'ENSG00000182141', 'ENSG00000182150', 'ENSG00000182173', 'ENSG00000182230', 'ENSG00000182253', 'ENSG00000182362', 'ENSG00000182368', 'ENSG00000182446', 'ENSG00000182472', 'ENSG00000182500', 'ENSG00000182511', 'ENSG00000182512', 'ENSG00000182534', 'ENSG00000182551', 'ENSG00000182578', 'ENSG00000182628', 'ENSG00000182648', 'ENSG00000182670', 'ENSG00000182749', 'ENSG00000182782', 'ENSG00000182919', 'ENSG00000182952', 'ENSG00000182963', 'ENSG00000182986', 'ENSG00000182993', 'ENSG00000183018', 'ENSG00000183066', 'ENSG00000183087', 'ENSG00000183092', 'ENSG00000183161', 'ENSG00000183172', 'ENSG00000183196', 'ENSG00000183208', 'ENSG00000183250', 'ENSG00000183260', 'ENSG00000183281', 'ENSG00000183291', 'ENSG00000183307', 'ENSG00000183310', 'ENSG00000183323', 'ENSG00000183386', 'ENSG00000183474', 'ENSG00000183476', 'ENSG00000183562', 'ENSG00000183569', 'ENSG00000183570', 'ENSG00000183617', 'ENSG00000183621', 'ENSG00000183648', 'ENSG00000183655', 'ENSG00000183665', 'ENSG00000183682', 'ENSG00000183688', 'ENSG00000183722', 'ENSG00000183784', 'ENSG00000183828', 'ENSG00000183833', 'ENSG00000183891', 'ENSG00000184060', 'ENSG00000184068', 'ENSG00000184110', 'ENSG00000184117', 'ENSG00000184164', 'ENSG00000184178', 'ENSG00000184220', 'ENSG00000184227', 'ENSG00000184232', 'ENSG00000184293', 'ENSG00000184349', 'ENSG00000184361', 'ENSG00000184451', 'ENSG00000184465', 'ENSG00000184517', 'ENSG00000184524', 'ENSG00000184716', 'ENSG00000184730', 'ENSG00000184752', 'ENSG00000184779', 'ENSG00000184840', 'ENSG00000184860', 'ENSG00000184898', 'ENSG00000184903', 'ENSG00000184983', 'ENSG00000184988', 'ENSG00000185000', 'ENSG00000185022', 'ENSG00000185033', 'ENSG00000185055', 'ENSG00000185065', 'ENSG00000185068', 'ENSG00000185101', 'ENSG00000185112', 'ENSG00000185127', 'ENSG00000185128', 'ENSG00000185155', 'ENSG00000185156', 'ENSG00000185163', 'ENSG00000185164', 'ENSG00000185187', 'ENSG00000185201', 'ENSG00000185236', 'ENSG00000185272', 'ENSG00000185298', 'ENSG00000185324', 'ENSG00000185420', 'ENSG00000185436', 'ENSG00000185442', 'ENSG00000185483', 'ENSG00000185730', 'ENSG00000185829', 'ENSG00000185875', 'ENSG00000185909', 'ENSG00000185920', 'ENSG00000185963', 'ENSG00000186020', 'ENSG00000186026', 'ENSG00000186075', 'ENSG00000186088', 'ENSG00000186111', 'ENSG00000186184', 'ENSG00000186197', 'ENSG00000186226', 'ENSG00000186230', 'ENSG00000186280', 'ENSG00000186314', 'ENSG00000186446', 'ENSG00000186468', 'ENSG00000186469', 'ENSG00000186470', 'ENSG00000186480', 'ENSG00000186496', 'ENSG00000186510', 'ENSG00000186523', 'ENSG00000186583', 'ENSG00000186660', 'ENSG00000186716', 'ENSG00000186807', 'ENSG00000186825', 'ENSG00000186952', 'ENSG00000187010', 'ENSG00000187134', 'ENSG00000187145', 'ENSG00000187231', 'ENSG00000187260', 'ENSG00000187446', 'ENSG00000187456', 'ENSG00000187607', 'ENSG00000187624', 'ENSG00000187630', 'ENSG00000187650', 'ENSG00000187676', 'ENSG00000187726', 'ENSG00000187741', 'ENSG00000187775', 'ENSG00000187796', 'ENSG00000187862', 'ENSG00000187987', 'ENSG00000187997', 'ENSG00000188042', 'ENSG00000188089', 'ENSG00000188126', 'ENSG00000188152', 'ENSG00000188186', 'ENSG00000188191', 'ENSG00000188211', 'ENSG00000188223', 'ENSG00000188227', 'ENSG00000188321', 'ENSG00000188372', 'ENSG00000188404', 'ENSG00000188483', 'ENSG00000188493', 'ENSG00000188511', 'ENSG00000188596', 'ENSG00000188611', 'ENSG00000188659', 'ENSG00000188672', 'ENSG00000188677', 'ENSG00000188690', 'ENSG00000188707', 'ENSG00000188732', 'ENSG00000188785', 'ENSG00000188820', 'ENSG00000188846', 'ENSG00000188906', 'ENSG00000188921', 'ENSG00000188986', 'ENSG00000189042', 'ENSG00000189050', 'ENSG00000189067', 'ENSG00000189152', 'ENSG00000189157', 'ENSG00000189171', 'ENSG00000189190', 'ENSG00000189223', 'ENSG00000189306', 'ENSG00000189339', 'ENSG00000189366', 'ENSG00000189409', 'ENSG00000196072', 'ENSG00000196110', 'ENSG00000196126', 'ENSG00000196141', 'ENSG00000196151', 'ENSG00000196152', 'ENSG00000196154', 'ENSG00000196167', 'ENSG00000196172', 'ENSG00000196189', 'ENSG00000196218', 'ENSG00000196220', 'ENSG00000196262', 'ENSG00000196267', 'ENSG00000196268', 'ENSG00000196284', 'ENSG00000196295', 'ENSG00000196329', 'ENSG00000196357', 'ENSG00000196358', 'ENSG00000196365', 'ENSG00000196367', 'ENSG00000196371', 'ENSG00000196372', 'ENSG00000196381', 'ENSG00000196405', 'ENSG00000196408', 'ENSG00000196421', 'ENSG00000196436', 'ENSG00000196449', 'ENSG00000196470', 'ENSG00000196476', 'ENSG00000196511', 'ENSG00000196539', 'ENSG00000196576', 'ENSG00000196605', 'ENSG00000196620', 'ENSG00000196636', 'ENSG00000196648', 'ENSG00000196653', 'ENSG00000196655', 'ENSG00000196683', 'ENSG00000196700', 'ENSG00000196704', 'ENSG00000196705', 'ENSG00000196715', 'ENSG00000196730', 'ENSG00000196735', 'ENSG00000196739', 'ENSG00000196743', 'ENSG00000196756', 'ENSG00000196774', 'ENSG00000196776', 'ENSG00000196793', 'ENSG00000196810', 'ENSG00000196821', 'ENSG00000196862', 'ENSG00000196867', 'ENSG00000196878', 'ENSG00000196937', 'ENSG00000196966', 'ENSG00000196967', 'ENSG00000196981', 'ENSG00000197013', 'ENSG00000197016', 'ENSG00000197043', 'ENSG00000197084', 'ENSG00000197119', 'ENSG00000197124', 'ENSG00000197128', 'ENSG00000197134', 'ENSG00000197182', 'ENSG00000197249', 'ENSG00000197279', 'ENSG00000197345', 'ENSG00000197362', 'ENSG00000197375', 'ENSG00000197405', 'ENSG00000197417', 'ENSG00000197444', 'ENSG00000197457', 'ENSG00000197461', 'ENSG00000197465', 'ENSG00000197472', 'ENSG00000197497', 'ENSG00000197498', 'ENSG00000197535', 'ENSG00000197557', 'ENSG00000197563', 'ENSG00000197568', 'ENSG00000197586', 'ENSG00000197619', 'ENSG00000197629', 'ENSG00000197635', 'ENSG00000197665', 'ENSG00000197670', 'ENSG00000197701', 'ENSG00000197712', 'ENSG00000197728', 'ENSG00000197747', 'ENSG00000197766', 'ENSG00000197771', 'ENSG00000197775', 'ENSG00000197780', 'ENSG00000197813', 'ENSG00000197863', 'ENSG00000197885', 'ENSG00000197888', 'ENSG00000197927', 'ENSG00000197937', 'ENSG00000197943', 'ENSG00000197951', 'ENSG00000197956', 'ENSG00000197958', 'ENSG00000197965', 'ENSG00000197978', 'ENSG00000197980', 'ENSG00000198035', 'ENSG00000198113', 'ENSG00000198130', 'ENSG00000198142', 'ENSG00000198171', 'ENSG00000198182', 'ENSG00000198185', 'ENSG00000198189', 'ENSG00000198208', 'ENSG00000198216', 'ENSG00000198231', 'ENSG00000198246', 'ENSG00000198252', 'ENSG00000198270', 'ENSG00000198380', 'ENSG00000198420', 'ENSG00000198453', 'ENSG00000198464', 'ENSG00000198468', 'ENSG00000198477', 'ENSG00000198496', 'ENSG00000198498', 'ENSG00000198502', 'ENSG00000198521', 'ENSG00000198624', 'ENSG00000198668', 'ENSG00000198722', 'ENSG00000198742', 'ENSG00000198754', 'ENSG00000198794', 'ENSG00000198805', 'ENSG00000198832', 'ENSG00000198833', 'ENSG00000198837', 'ENSG00000198860', 'ENSG00000198879', 'ENSG00000198885', 'ENSG00000198892', 'ENSG00000198894', 'ENSG00000198912', 'ENSG00000198933', 'ENSG00000198951', 'ENSG00000198954', 'ENSG00000203666', 'ENSG00000203734', 'ENSG00000203797', 'ENSG00000203827', 'ENSG00000203865', 'ENSG00000203871', 'ENSG00000203872', 'ENSG00000203875', 'ENSG00000203880', 'ENSG00000203993', 'ENSG00000203995', 'ENSG00000204084', 'ENSG00000204110', 'ENSG00000204128', 'ENSG00000204147', 'ENSG00000204149', 'ENSG00000204161', 'ENSG00000204169', 'ENSG00000204172', 'ENSG00000204186', 'ENSG00000204219', 'ENSG00000204227', 'ENSG00000204228', 'ENSG00000204252', 'ENSG00000204264', 'ENSG00000204267', 'ENSG00000204301', 'ENSG00000204308', 'ENSG00000204348', 'ENSG00000204390', 'ENSG00000204392', 'ENSG00000204428', 'ENSG00000204438', 'ENSG00000204472', 'ENSG00000204482', 'ENSG00000204514', 'ENSG00000204516', 'ENSG00000204520', 'ENSG00000204525', 'ENSG00000204531', 'ENSG00000204536', 'ENSG00000204580', 'ENSG00000204604', 'ENSG00000204632', 'ENSG00000204642', 'ENSG00000204673', 'ENSG00000204677', 'ENSG00000204807', 'ENSG00000204837', 'ENSG00000204839', 'ENSG00000204920', 'ENSG00000204934', 'ENSG00000204947', 'ENSG00000204954', 'ENSG00000204991', 'ENSG00000205018', 'ENSG00000205036', 'ENSG00000205038', 'ENSG00000205045', 'ENSG00000205056', 'ENSG00000205057', 'ENSG00000205060', 'ENSG00000205086', 'ENSG00000205181', 'ENSG00000205189', 'ENSG00000205233', 'ENSG00000205236', 'ENSG00000205277', 'ENSG00000205302', 'ENSG00000205309', 'ENSG00000205464', 'ENSG00000205571', 'ENSG00000205593', 'ENSG00000205609', 'ENSG00000205710', 'ENSG00000205786', 'ENSG00000205795', 'ENSG00000205808', 'ENSG00000205853', 'ENSG00000205863', 'ENSG00000206052', 'ENSG00000206176', 'ENSG00000206344', 'ENSG00000206418', 'ENSG00000206503', 'ENSG00000206527', 'ENSG00000206530', 'ENSG00000206535', 'ENSG00000206561', 'ENSG00000212743', 'ENSG00000212807', 'ENSG00000212916', 'ENSG00000212978', 'ENSG00000213015', 'ENSG00000213066', 'ENSG00000213077', 'ENSG00000213160', 'ENSG00000213214', 'ENSG00000213221', 'ENSG00000213246', 'ENSG00000213366', 'ENSG00000213445', 'ENSG00000213462', 'ENSG00000213672', 'ENSG00000213676', 'ENSG00000213689', 'ENSG00000213853', 'ENSG00000213889', 'ENSG00000213930', 'ENSG00000213971', 'ENSG00000214063', 'ENSG00000214078', 'ENSG00000214087', 'ENSG00000214106', 'ENSG00000214113', 'ENSG00000214176', 'ENSG00000214253', 'ENSG00000214290', 'ENSG00000214293', 'ENSG00000214309', 'ENSG00000214338', 'ENSG00000214425', 'ENSG00000214435', 'ENSG00000214447', 'ENSG00000214711', 'ENSG00000214872', 'ENSG00000214960', 'ENSG00000215190', 'ENSG00000215252', 'ENSG00000215424', 'ENSG00000215570', 'ENSG00000215790', 'ENSG00000215845', 'ENSG00000215908', 'ENSG00000215910', 'ENSG00000216937', 'ENSG00000217555', 'ENSG00000218510', 'ENSG00000218739', 'ENSG00000219607', 'ENSG00000219626', 'ENSG00000219665', 'ENSG00000220008', 'ENSG00000221823', 'ENSG00000221838', 'ENSG00000221887', 'ENSG00000221923', 'ENSG00000221944', 'ENSG00000221947', 'ENSG00000221970', 'ENSG00000221983', 'ENSG00000221990', 'ENSG00000222041', 'ENSG00000222042', 'ENSG00000223385', 'ENSG00000223474', 'ENSG00000223704', 'ENSG00000223797', 'ENSG00000223799', 'ENSG00000223891', 'ENSG00000224046', 'ENSG00000224137', 'ENSG00000224184', 'ENSG00000224376', 'ENSG00000224429', 'ENSG00000224565', 'ENSG00000224635', 'ENSG00000224660', 'ENSG00000224712', 'ENSG00000224818', 'ENSG00000224870', 'ENSG00000224877', 'ENSG00000224997', 'ENSG00000225039', 'ENSG00000225241', 'ENSG00000225339', 'ENSG00000225353', 'ENSG00000225484', 'ENSG00000225880', 'ENSG00000225889', 'ENSG00000225978', 'ENSG00000226007', 'ENSG00000226025', 'ENSG00000226029', 'ENSG00000226124', 'ENSG00000226167', 'ENSG00000226180', 'ENSG00000226287', 'ENSG00000226328', 'ENSG00000226381', 'ENSG00000226479', 'ENSG00000226742', 'ENSG00000226752', 'ENSG00000226950', 'ENSG00000227017', 'ENSG00000227039', 'ENSG00000227124', 'ENSG00000227345', 'ENSG00000227354', 'ENSG00000227403', 'ENSG00000227450', 'ENSG00000227502', 'ENSG00000227533', 'ENSG00000227775', 'ENSG00000228049', 'ENSG00000228157', 'ENSG00000228246', 'ENSG00000228300', 'ENSG00000228327', 'ENSG00000228590', 'ENSG00000228649', 'ENSG00000228672', 'ENSG00000228696', 'ENSG00000228716', 'ENSG00000228775', 'ENSG00000228789', 'ENSG00000228857', 'ENSG00000228998', 'ENSG00000229140', 'ENSG00000229153', 'ENSG00000229178', 'ENSG00000229180', 'ENSG00000229450', 'ENSG00000229676', 'ENSG00000230055', 'ENSG00000230091', 'ENSG00000230107', 'ENSG00000230138', 'ENSG00000230438', 'ENSG00000230487', 'ENSG00000230493', 'ENSG00000230510', 'ENSG00000230628', 'ENSG00000230658', 'ENSG00000230943', 'ENSG00000231074', 'ENSG00000231242', 'ENSG00000231360', 'ENSG00000231389', 'ENSG00000231486', 'ENSG00000231507', 'ENSG00000231671', 'ENSG00000231889', 'ENSG00000231997', 'ENSG00000232063', 'ENSG00000232104', 'ENSG00000232112', 'ENSG00000232116', 'ENSG00000232224', 'ENSG00000232629', 'ENSG00000232703', 'ENSG00000232941', 'ENSG00000233280', 'ENSG00000233290', 'ENSG00000233488', 'ENSG00000233527', 'ENSG00000233610', 'ENSG00000233791', 'ENSG00000233806', 'ENSG00000233834', 'ENSG00000234028', 'ENSG00000234171', 'ENSG00000234284', 'ENSG00000234572', 'ENSG00000234665', 'ENSG00000234684', 'ENSG00000234745', 'ENSG00000235098', 'ENSG00000235398', 'ENSG00000236129', 'ENSG00000236338', 'ENSG00000236404', 'ENSG00000236624', 'ENSG00000236756', 'ENSG00000237190', 'ENSG00000237198', 'ENSG00000237292', 'ENSG00000237301', 'ENSG00000237310', 'ENSG00000237357', 'ENSG00000237372', 'ENSG00000237438', 'ENSG00000237440', 'ENSG00000237489', 'ENSG00000237520', 'ENSG00000237541', 'ENSG00000237595', 'ENSG00000237638', 'ENSG00000237651', 'ENSG00000237753', 'ENSG00000237940', 'ENSG00000238083', 'ENSG00000238121', 'ENSG00000238197', 'ENSG00000238198', 'ENSG00000238227', 'ENSG00000240065', 'ENSG00000240303', 'ENSG00000240344', 'ENSG00000240583', 'ENSG00000240654', 'ENSG00000240875', 'ENSG00000241058', 'ENSG00000241135', 'ENSG00000241258', 'ENSG00000241472', 'ENSG00000241732', 'ENSG00000241768', 'ENSG00000242110', 'ENSG00000242485', 'ENSG00000242550', 'ENSG00000242574', 'ENSG00000243150', 'ENSG00000243156', 'ENSG00000243224', 'ENSG00000243317', 'ENSG00000243646', 'ENSG00000243701', 'ENSG00000243795', 'ENSG00000243811', 'ENSG00000244165', 'ENSG00000244291', 'ENSG00000244607', 'ENSG00000244733', 'ENSG00000244752', 'ENSG00000244879', 'ENSG00000245060', 'ENSG00000245080', 'ENSG00000245317', 'ENSG00000245498', 'ENSG00000245532', 'ENSG00000245614', 'ENSG00000245648', 'ENSG00000245685', 'ENSG00000245937', 'ENSG00000245954', 'ENSG00000246067', 'ENSG00000246089', 'ENSG00000246090', 'ENSG00000246174', 'ENSG00000246273', 'ENSG00000246308', 'ENSG00000246528', 'ENSG00000246560', 'ENSG00000246731', 'ENSG00000246982', 'ENSG00000247157', 'ENSG00000247271', 'ENSG00000247317', 'ENSG00000247363', 'ENSG00000247400', 'ENSG00000247796', 'ENSG00000247828', 'ENSG00000247950', 'ENSG00000247982', 'ENSG00000248044', 'ENSG00000248049', 'ENSG00000248098', 'ENSG00000248099', 'ENSG00000248243', 'ENSG00000248265', 'ENSG00000248508', 'ENSG00000249096', 'ENSG00000249334', 'ENSG00000249471', 'ENSG00000249476', 'ENSG00000249624', 'ENSG00000249685', 'ENSG00000250081', 'ENSG00000250264', 'ENSG00000250312', 'ENSG00000250317', 'ENSG00000250565', 'ENSG00000251136', 'ENSG00000251230', 'ENSG00000251323', 'ENSG00000251615', 'ENSG00000251661', 'ENSG00000253140', 'ENSG00000253598', 'ENSG00000253633', 'ENSG00000254006', 'ENSG00000254206', 'ENSG00000254319', 'ENSG00000254353', 'ENSG00000254470', 'ENSG00000254531', 'ENSG00000254614', 'ENSG00000254873', 'ENSG00000254997', 'ENSG00000254999', 'ENSG00000255046', 'ENSG00000255121', 'ENSG00000255284', 'ENSG00000255310', 'ENSG00000255328', 'ENSG00000255354', 'ENSG00000255398', 'ENSG00000255423', 'ENSG00000255455', 'ENSG00000255733', 'ENSG00000255837', 'ENSG00000256043', 'ENSG00000256092', 'ENSG00000256249', 'ENSG00000256436', 'ENSG00000256568', 'ENSG00000256574', 'ENSG00000256576', 'ENSG00000256771', 'ENSG00000257093', 'ENSG00000257218', 'ENSG00000257365', 'ENSG00000257704', 'ENSG00000257949', 'ENSG00000258289', 'ENSG00000258301', 'ENSG00000258311', 'ENSG00000258365', 'ENSG00000258504', 'ENSG00000258512', 'ENSG00000258572', 'ENSG00000258701', 'ENSG00000258733', 'ENSG00000258908', 'ENSG00000258920', 'ENSG00000259243', 'ENSG00000259327', 'ENSG00000259332', 'ENSG00000259363', 'ENSG00000259577', 'ENSG00000259658', 'ENSG00000259705', 'ENSG00000259850', 'ENSG00000259863', 'ENSG00000259865', 'ENSG00000259915', 'ENSG00000259959', 'ENSG00000260006', 'ENSG00000260065', 'ENSG00000260077', 'ENSG00000260101', 'ENSG00000260176', 'ENSG00000260193', 'ENSG00000260257', 'ENSG00000260261', 'ENSG00000260303', 'ENSG00000260423', 'ENSG00000260456', 'ENSG00000260482', 'ENSG00000260539', 'ENSG00000260655', 'ENSG00000260755', 'ENSG00000260804', 'ENSG00000260805', 'ENSG00000261098', 'ENSG00000261159', 'ENSG00000261211', 'ENSG00000261311', 'ENSG00000261455', 'ENSG00000261584', 'ENSG00000261618', 'ENSG00000261652', 'ENSG00000261740', 'ENSG00000261770', 'ENSG00000261790', 'ENSG00000261824', 'ENSG00000262155', 'ENSG00000262292', 'ENSG00000262304', 'ENSG00000262356', 'ENSG00000262370', 'ENSG00000262412', 'ENSG00000262874', 'ENSG00000262879', 'ENSG00000262951', 'ENSG00000262992', 'ENSG00000263004', 'ENSG00000263280']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">eqtl_predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> all_genes[all_genes.index.isin(eqtl_genes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])]</span>
<span id="cb21-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(eqtl_predictions.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes in correlation test"</span>)</span>
<span id="cb21-3">eqtl_predictions.corr()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2853 genes in correlation test</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geuvadis</th>
<th data-quarto-table-cell-role="th">enformer, 10 bin</th>
<th data-quarto-table-cell-role="th">enformer, 3 bin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">geuvadis</td>
<td>1.000000</td>
<td>0.304581</td>
<td>0.321576</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">enformer, 10 bin</td>
<td>0.304581</td>
<td>1.000000</td>
<td>0.919356</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">enformer, 3 bin</td>
<td>0.321576</td>
<td>0.919356</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This is slightly better, but a couple hundred genes got dropped somewhere along the way?</p>
</section>
<section id="original-code-1" class="level3">
<h3 class="anchored" data-anchor-id="original-code-1">Original Code</h3>
<p>My only modification was hard-coding paths and removing the fasta folder argument in <a href="https://github.com/ni-lab/personalized-expression-benchmark/blob/main/enformer/run_enformer_reference.py"><code>personalized-expression-benchmark/enformer/run_enformer_reference.py</code></a></p>
<pre><code>module load conda
conda activate ml-python
cd /home/s1mi/Github/personalized-expression-benchmark

python3 enformer/run_enformer_reference.py . data/gene_list.csv
</code></pre>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/Github/personalized-expression-benchmark/output/reference_predictions.csv"</span>)</span>
<span id="cb24-2">corr_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> output[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tss3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tss10"</span>]].corr()</span>
<span id="cb24-3">corr_df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">tss3</th>
<th data-quarto-table-cell-role="th">tss10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">mean</td>
<td>1.000000</td>
<td>0.309661</td>
<td>0.399530</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">tss3</td>
<td>0.309661</td>
<td>1.000000</td>
<td>0.835206</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">tss10</td>
<td>0.399530</td>
<td>0.835206</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-09-06-validating-Huang-et-al/index.html</guid>
  <pubDate>Wed, 06 Sep 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Rerunning Enformer pipeline on missing individuals, intervals</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-31-Br-personalized-prediction-on-more-genes/debugging.html</link>
  <description><![CDATA[ 




<section id="split-by-number-missing" class="level3">
<h3 class="anchored" data-anchor-id="split-by-number-missing">Split by Number Missing</h3>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span></code></pre></div>
</div>
<div class="cell" data-execution_count="266">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">predictions_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/Br_predictions/predictions_folder/personalized_Br_selected_genes/predictions_2023-09-02/enformer_predictions"</span></span>
<span id="cb2-2">successful_predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb2-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> individual <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> os.listdir(predictions_dir):</span>
<span id="cb2-4">    n_intervals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(os.listdir(os.path.join(predictions_dir, individual, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"haplotype0"</span>)))</span>
<span id="cb2-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> n_intervals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">868</span>:</span>
<span id="cb2-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> n_intervals <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> successful_predictions.keys():</span>
<span id="cb2-7">            successful_predictions[n_intervals] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [individual]</span>
<span id="cb2-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb2-9">            successful_predictions[n_intervals].append(individual)</span>
<span id="cb2-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n_intervals <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> successful_predictions.keys():</span>
<span id="cb2-11">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n individuals with"</span>, n_intervals, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"predictions:"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(successful_predictions[n_intervals]))</span>
<span id="cb2-12"></span></code></pre></div>
</div>
<div class="cell" data-execution_count="257">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata/intervals.txt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb3-2">    all_intervals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read().splitlines()</span></code></pre></div>
</div>
</section>
<section id="write-metadata" class="level2">
<h2 class="anchored" data-anchor-id="write-metadata">Write Metadata</h2>
<div class="cell" data-execution_count="258">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> index, n_intervals <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(successful_predictions.keys()):</span>
<span id="cb4-2">    individuals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> successful_predictions[n_intervals]</span>
<span id="cb4-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"metadata/individuals</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>index<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.txt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb4-4">        f.write(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join(individuals))</span>
<span id="cb4-5">    individual <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> individuals[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb4-6">    files <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.listdir(os.path.join(predictions_dir, individual, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"haplotype0"</span>))</span>
<span id="cb4-7">    intervals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_predictions.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> files]</span>
<span id="cb4-8">    missing_intervals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [interval <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> interval <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_intervals <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> interval <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> intervals]</span>
<span id="cb4-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"metadata/intervals</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>index<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.txt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb4-10">        f.write(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join(missing_intervals))</span></code></pre></div>
</div>
</section>
<section id="write-config-files" class="level2">
<h2 class="anchored" data-anchor-id="write-config-files">Write Config Files</h2>
<div class="cell" data-execution_count="259">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"personalized_config.json"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> input_json:</span>
<span id="cb5-4">    parameters <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> json.load(input_json)</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> index, n_intervals <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(successful_predictions.keys()):</span>
<span id="cb5-7">    parameters[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"individuals"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"/home/s1mi/Github/deep-learning-in-genomics/posts/2023-08-31-Br-personalized-prediction-on-more-genes/metadata/individuals</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>index<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.txt"</span></span>
<span id="cb5-8">    parameters[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"interval_list_file"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"/home/s1mi/Github/deep-learning-in-genomics/posts/2023-08-31-Br-personalized-prediction-on-more-genes/metadata/intervals</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>index<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.txt"</span></span>
<span id="cb5-9">    parameters[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_individuals"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(successful_predictions[n_intervals])</span>
<span id="cb5-10">    parameters[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"batch_individuals"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb5-11">    parameters[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_regions"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">868</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> n_intervals</span>
<span id="cb5-12">    parameters[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"batch_regions"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb5-13">    parameters[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-09-02"</span></span>
<span id="cb5-14">    parameters[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parsl_parameters"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"walltime"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"00:30:00"</span></span>
<span id="cb5-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"personalized_config</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>index<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.json"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> output_json:</span>
<span id="cb5-16">        json.dump(parameters, output_json, indent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</div>
</section>
<section id="run-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="run-pipeline">Run Pipeline</h2>
<pre><code>module load conda
conda activate /lus/grand/projects/TFXcan/imlab/shared/software/conda_envs/enformer-predict-tools

for i in {0..2}; do
    python /home/s1mi/Github/enformer_epigenome_pipeline/enformer_predict.py --parameters /home/s1mi/Github/deep-learning-in-genomics/posts/2023-08-31-Br-personalized-prediction-on-more-genes/personalized_config${i}.json &amp;
    sleep 20
done</code></pre>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-31-Br-personalized-prediction-on-more-genes/debugging.html</guid>
  <pubDate>Sat, 02 Sep 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Comparing human and rat reference gene expression</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-09-01-comparing-human-vs-rat-mean-expression-across-genes/index.html</link>
  <description><![CDATA[ 




<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span></code></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## read rat observed gene expression data</span></span>
<span id="cb2-2">rat_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/expression_data/Brain.rn7.expr.tpm.bed"</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gene_id'</span>)</span>
<span id="cb2-3">rat_mean_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rat_tpm.iloc[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>:].mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-4">rat_mean_tpm.name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rat mean tpm"</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_145300/1109491104.py:2: DtypeWarning: Columns (0) have mixed types. Specify dtype option on import or set low_memory=False.
  rat_tpm = pd.read_csv("/home/s1mi/enformer_rat_data/expression_data/Brain.rn7.expr.tpm.bed", sep="\t", header=0, index_col='gene_id')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## read human gene expression data</span></span>
<span id="cb4-2">human_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/expression_data/gene_tpm_2017-06-05_v8_brain_cortex.gct.gz"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-3">human_tpm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> human_tpm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> gene: gene.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb4-4">human_tpm.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate average gene expression</span></span>
<span id="cb4-6">human_mean_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> human_tpm.drop(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Description'</span>]).mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-7">human_mean_tpm.name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"human mean tpm"</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">ortho_genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/annotation/rn7_hg38.ortholog_genes.txt"</span>, sep <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ensembl_gene_id"</span>)</span>
<span id="cb5-2">ortho_genes.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">hsapiens_homolog_ensembl_gene</th>
<th data-quarto-table-cell-role="th">external_gene_name</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ensembl_gene_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSRNOG00000033395</td>
<td>ENSG00000174937</td>
<td>Or5m3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSRNOG00000070901</td>
<td>ENSG00000167378</td>
<td>Irgq</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSRNOG00000031391</td>
<td>ENSG00000213892</td>
<td>Ceacam16</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSRNOG00000050129</td>
<td>ENSG00000164520</td>
<td>AABR07000137.1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSRNOG00000056886</td>
<td>ENSG00000199095</td>
<td>Mir291b</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">merged_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ortho_genes.join(rat_mean_tpm, how<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inner"</span>)</span>
<span id="cb6-2">merged_df.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hsapiens_homolog_ensembl_gene"</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-3">expr_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> merged_df.join(human_mean_tpm)</span>
<span id="cb6-4">expr_df.corr()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rat mean tpm</th>
<th data-quarto-table-cell-role="th">human mean tpm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">rat mean tpm</td>
<td>1.000000</td>
<td>0.886398</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">human mean tpm</td>
<td>0.886398</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr_df.corr().iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb7-2">plt.scatter(expr_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rat mean tpm"</span>], expr_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"human mean tpm"</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Correlation: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>corr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb7-3">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rat mean tpm'</span>)</span>
<span id="cb7-4">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'human mean tpm'</span>)</span>
<span id="cb7-5">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Correlation between observed human and observed rat reference gene expression'</span>)</span>
<span id="cb7-6">plt.legend()</span>
<span id="cb7-7">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb7-8">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-09-01-comparing-human-vs-rat-mean-expression-across-genes/index_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-09-01-comparing-human-vs-rat-mean-expression-across-genes/index.html</guid>
  <pubDate>Fri, 01 Sep 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Personalized Prediction Correlations for 868 rn7 genes</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-31-Br-personalized-prediction-on-more-genes/index.html</link>
  <description><![CDATA[ 




<p>We ran the personalized Enformer pipeline 868 genes for high variation in Br rats and number of eQTLs. There are too many predictions to concatenate iteratively, so I wrote <a href="collect_predictions.py">collect_predictions.py</a> to parallelize in a submitted job.</p>
<p>Note: This script appends predictions to the h5 in parallel, I first initialized the h5 file with individuals list to be paired with all gene expression datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3">project_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/Br_predictions/predictions_folder/personalized_Br_selected_genes"</span></span>
<span id="cb1-4"></span>
<span id="cb1-5">obs_gene_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/expression_data/Brain.rn7.expr.tpm.bed"</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>project_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/selected_genes_mouse_and_human_predictions.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>:</span>
<span id="cb1-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>.attrs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> obs_gene_expr.columns.to_list()[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>:]</span></code></pre></div>
</div>
<section id="read-processed-predictions" class="level2">
<h2 class="anchored" data-anchor-id="read-processed-predictions">Read Processed Predictions</h2>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb2-3">project_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/Br_predictions/predictions_folder/personalized_Br_selected_genes"</span></span>
<span id="cb2-4">expr_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb2-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>project_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/selected_genes_mouse_and_human_predictions.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>:</span>
<span id="cb2-6">    index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>.attrs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span>]</span>
<span id="cb2-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>.keys():</span>
<span id="cb2-8">        matrix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>[gene][:]</span>
<span id="cb2-9">        expr_dict[gene] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(matrix, index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> index, columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"observed"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"human predicted"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mouse predicted"</span>])</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">corr_by_gene_and_track <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"human"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mouse"</span>], index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gene_list)</span>
<span id="cb3-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> gene_list:</span>
<span id="cb3-3">    corr_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr_dict[gene].corr()</span>
<span id="cb3-4">    corr_by_gene_and_track.loc[gene] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_numeric(corr_df.iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span></code></pre></div>
</div>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-31-Br-personalized-prediction-on-more-genes/index.html</guid>
  <pubDate>Fri, 01 Sep 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Investigating the various CAGE brain tissue mouse tracks</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-09-01-selecting-mouse-track-for-CAGE-brain-prediction/index.html</link>
  <description><![CDATA[ 




<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span></code></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## subset to all brain-specific CAGE targets</span></span>
<span id="cb2-2">targets <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/calico/basenji/master/manuscripts/cross2020/targets_mouse.txt"</span>, sep <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb2-3">CAGE_targets <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> targets[targets[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'index'</span>].isin([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6612</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6613</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6622</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6627</span>])]</span>
<span id="cb2-4">track_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(CAGE_targets.index)</span>
<span id="cb2-5">CAGE_targets.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">genome</th>
<th data-quarto-table-cell-role="th">identifier</th>
<th data-quarto-table-cell-role="th">file</th>
<th data-quarto-table-cell-role="th">clip</th>
<th data-quarto-table-cell-role="th">scale</th>
<th data-quarto-table-cell-role="th">sum_stat</th>
<th data-quarto-table-cell-role="th">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1299</td>
<td>6612</td>
<td>1</td>
<td>CNhs10477</td>
<td>/home/drk/tillage/datasets/mouse/cage/fantom/C...</td>
<td>384</td>
<td>1</td>
<td>sum</td>
<td>CAGE:medulla oblongata, adult</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1300</td>
<td>6613</td>
<td>1</td>
<td>CNhs10478</td>
<td>/home/drk/tillage/datasets/mouse/cage/fantom/C...</td>
<td>384</td>
<td>1</td>
<td>sum</td>
<td>CAGE:hippocampus, adult</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1309</td>
<td>6622</td>
<td>1</td>
<td>CNhs10489</td>
<td>/home/drk/tillage/datasets/mouse/cage/fantom/C...</td>
<td>384</td>
<td>1</td>
<td>sum</td>
<td>CAGE:olfactory brain, adult</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1314</td>
<td>6627</td>
<td>1</td>
<td>CNhs10494</td>
<td>/home/drk/tillage/datasets/mouse/cage/fantom/C...</td>
<td>384</td>
<td>1</td>
<td>sum</td>
<td>CAGE:cerebellum, adult</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">predictions_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/Br_predictions/predictions_folder/personalized_Br_selected_genes/predictions_2023-09-01/enformer_predictions"</span></span>
<span id="cb3-2">gene_expr_bed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/expression_data/Brain.rn7.expr.tpm.bed"</span></span>
<span id="cb3-3">obs_gene_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(gene_expr_bed, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gene_id'</span>)</span>
<span id="cb3-4">annot_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/annotation/rn7.gene.txt"</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'geneId'</span>)</span>
<span id="cb3-5">gene_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENSRNOG00000060185"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENSRNOG00000022448"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENSRNOG00000006331"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENSRNOG00000000435"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENSRNOG00000001336"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENSRNOG00000016623"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENSRNOG00000025324"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENSRNOG00000012087"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENSRNOG00000021663"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENSRNOG00000012333"</span>]</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_120274/1359220184.py:3: DtypeWarning: Columns (0) have mixed types. Specify dtype option on import or set low_memory=False.
  obs_gene_expr = pd.read_csv(gene_expr_bed, sep="\t", header=0, index_col='gene_id')
/tmp/ipykernel_120274/1359220184.py:4: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  annot_df = pd.read_csv("/home/s1mi/enformer_rat_data/annotation/rn7.gene.txt", sep="\t", header= 0, index_col='geneId')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">expr_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb5-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> gene_list:</span>
<span id="cb5-3">    obs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> obs_gene_expr.loc[gene][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>:]</span>
<span id="cb5-4">    expr_dict[gene] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"observed"</span>: obs})</span>
<span id="cb5-5">            </span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb6-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> gene_list:</span>
<span id="cb6-3">    gene_annot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> annot_df.loc[gene]</span>
<span id="cb6-4">    interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>gene_annot[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chromosome'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>gene_annot[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tss'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>gene_annot[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tss'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-5">    medulla_oblongata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb6-6">    hippocampus <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb6-7">    olfactory_brain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb6-8">    cerebellum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb6-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> individual <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> expr_dict[gene].index:</span>
<span id="cb6-10">        haplo0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> h5py.File(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>predictions_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>individual<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/haplotype0/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>interval<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_predictions.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>)</span>
<span id="cb6-11">        predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> haplo0[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mouse"</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">446</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">450</span>, track_indices]</span>
<span id="cb6-12">        medulla_oblongata.append(np.average(predictions[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))</span>
<span id="cb6-13">        hippocampus.append(np.average(predictions[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span>
<span id="cb6-14">        olfactory_brain.append(np.average(predictions[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]))</span>
<span id="cb6-15">        cerebellum.append(np.average(predictions[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]))</span>
<span id="cb6-16">    expr_dict[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medulla oblongata"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> medulla_oblongata</span>
<span id="cb6-17">    expr_dict[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hippocampus"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hippocampus</span>
<span id="cb6-18">    expr_dict[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"olfactory brain"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> olfactory_brain</span>
<span id="cb6-19">    expr_dict[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cerebellum"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cerebellum</span></code></pre></div>
</div>
<div class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">corr_by_gene_and_track <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medulla oblongata"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hippocampus"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"olfactory brain"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cerebellum"</span>], index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gene_list)</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> gene_list:</span>
<span id="cb7-4">    corr_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr_dict[gene].corr()</span>
<span id="cb7-5">    corr_by_gene_and_track.loc[gene] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_numeric(corr_df.iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:])</span>
<span id="cb7-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(corr_by_gene_and_track)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   medulla oblongata hippocampus olfactory brain cerebellum
ENSRNOG00000060185          0.340841    0.339026        0.340439   0.338799
ENSRNOG00000022448          0.176105    0.183011        0.179076   0.176374
ENSRNOG00000006331          0.284351    0.326806        0.327064    0.32246
ENSRNOG00000000435          0.212012    0.233529        0.171748   0.097784
ENSRNOG00000001336          0.550703    0.540987         0.54114   0.551966
ENSRNOG00000016623          0.060619    0.170785        0.153715  -0.109455
ENSRNOG00000025324         -0.315003   -0.223645       -0.240727  -0.174633
ENSRNOG00000012087          0.285358    0.309409        0.312098   0.312001
ENSRNOG00000021663         -0.325343   -0.430207       -0.426303  -0.014811
ENSRNOG00000012333         -0.081875    0.098419        0.077553   0.038098</code></pre>
</div>
</div>
<p>Based off a row-wise look at the table, I’ve decided to use the CAGE:hippocampus mouse track as a representative of brain tissue.</p>



 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-09-01-selecting-mouse-track-for-CAGE-brain-prediction/index.html</guid>
  <pubDate>Fri, 01 Sep 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Running personalized Enformer pipeline on Br rats for many more genes</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-31-Br-personalized-prediction-on-more-genes/pipeline.html</link>
  <description><![CDATA[ 




<section id="selecting-genes" class="level2">
<h2 class="anchored" data-anchor-id="selecting-genes">Selecting Genes</h2>
<p>We are aiming for ~1,000 genes at the end of the selection process</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span></code></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/expression_data/Brain.rn7.expr.tpm.bed"</span>, header <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,  index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gene_id'</span>)</span>
<span id="cb2-2">tpm_var <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tpm.iloc[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>:].var(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-3">tpm_threshold <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tpm_var.quantile(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## subset of genes with high observed expression variation</span></span>
<span id="cb2-5">high_tpm_var_genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(tpm[tpm_var<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> tpm_threshold].index)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_14438/1587770446.py:1: DtypeWarning: Columns (0) have mixed types. Specify dtype option on import or set low_memory=False.
  tpm = pd.read_csv("/home/s1mi/enformer_rat_data/expression_data/Brain.rn7.expr.tpm.bed", header = 0, sep="\t",  index_col= 'gene_id')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">eqtl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/annotation/Brain.rn7.cis_qtl_signif.txt"</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-2">counts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> eqtl[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gene_id'</span>].value_counts()</span>
<span id="cb4-3">counts.describe()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>count    11238.000000
mean      2312.935398
std       1490.079008
min          1.000000
25%       1160.250000
50%       2236.000000
75%       3277.750000
max      10799.000000
Name: gene_id, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">eqtl_threshold <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> counts.quantile(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span>
<span id="cb6-2">eqtl_genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> counts[counts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> eqtl_threshold].index</span></code></pre></div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">gene_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> high_tpm_var_genes.intersection(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(eqtl_genes))</span>
<span id="cb7-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(gene_list), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"candidate genes for enformer prediction experiments"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>868 candidate genes for enformer prediction experiments</code></pre>
</div>
</div>
</section>
<section id="run-the-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="run-the-pipeline">Run the Pipeline</h2>
<section id="write-metadata" class="level3">
<h3 class="anchored" data-anchor-id="write-metadata">Write Metadata</h3>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## write intervals.txt</span></span>
<span id="cb9-2">annot_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/home/s1mi/enformer_rat_data/annotation/rn7.gene.txt'</span>, sep <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>,  index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'geneId'</span>)</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> write_intervals(gene_list, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>):</span>
<span id="cb9-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb9-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> gene_list:</span>
<span id="cb9-7">            gene_annot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> annot_df.loc[gene]</span>
<span id="cb9-8">            tss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gene_annot[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tss'</span>]</span>
<span id="cb9-9">            interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>gene_annot[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chromosome'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb9-10">            f.write(interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_14438/1105297742.py:2: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  annot_df = pd.read_csv('/home/s1mi/enformer_rat_data/annotation/rn7.gene.txt', sep ='\t',  index_col='geneId')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_list.txt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb11-2">    f.write(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join(gene_list))</span>
<span id="cb11-3">write_intervals(gene_list, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata/intervals.txt"</span>)</span></code></pre></div>
</div>
</section>
<section id="submit-jobs" class="level3">
<h3 class="anchored" data-anchor-id="submit-jobs">Submit Jobs</h3>
<pre><code>module load conda
conda activate /lus/grand/projects/TFXcan/imlab/shared/software/conda_envs/enformer-predict-tools

python /home/s1mi/Github/enformer_epigenome_pipeline/enformer_predict.py --parameters /home/s1mi/Github/deep-learning-in-genomics/posts/2023-08-31-Br-personalized-prediction-on-more-genes/personalized_config.json

</code></pre>
</section>
<section id="submit-jobs-1" class="level3">
<h3 class="anchored" data-anchor-id="submit-jobs-1">Submit Jobs</h3>
<pre><code>module load conda
conda activate /lus/grand/projects/TFXcan/imlab/shared/software/conda_envs/enformer-predict-tools

python /home/s1mi/Github/enformer_epigenome_pipeline/enformer_predict.py --parameters /home/s1mi/Github/deep-learning-in-genomics/posts/2023-08-31-Br-personalized-prediction-on-more-genes/personalized_config.json
</code></pre>


</section>
</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-31-Br-personalized-prediction-on-more-genes/pipeline.html</guid>
  <pubDate>Thu, 31 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Testing the Enformer pipeline option to output both human and mouse head together</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-31-testing-multiple-heads-in-pipeline/index.html</link>
  <description><![CDATA[ 




<section id="personalized-test" class="level2">
<h2 class="anchored" data-anchor-id="personalized-test">Personalized Test</h2>
<p>We chose <code>ENSRNOG00000054549</code>, centered at the TSS chr20:12118762.</p>
<p>Highthroughput on polaris:</p>
<pre><code>module load conda
conda activate /lus/grand/projects/TFXcan/imlab/shared/software/conda_envs/enformer-predict-tools

python /home/s1mi/Github/enformer_epigenome_pipeline/enformer_predict.py --parameters /home/s1mi/Github/deep-learning-in-genomics/posts/2023-08-31-testing-multiple-heads-in-pipeline/local_test_personalized.json
</code></pre>
<p>Local:</p>
<pre><code>conda activate enformer-predict-tools
python /Users/sabrinami/Github/enformer_epigenome_pipeline/enformer_predict.py --parameters /Users/sabrinami/Github/deep-learning-in-genomics/posts/2023-08-31-testing-multiple-heads-in-pipeline/local_test_personalized2.json
</code></pre>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb3-3">f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> h5py.File(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/predictions_folder/personalized_enformer_rat_single_gene/predictions_2023-08-31/enformer_predictions/000789972A/haplotype0/chr20_12118762_12118762_predictions.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>)</span>
<span id="cb3-4">human_prediction <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'human'</span>][()]</span>
<span id="cb3-5">mouse_prediction <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mouse'</span>][()]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> EnformerVCF</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> kipoiseq</span>
<span id="cb4-3">fasta_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/rn7_data/rn7_genome.fasta'</span></span>
<span id="cb4-4">fasta_extractor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.FastaStringExtractor(fasta_file)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">target_interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kipoiseq.Interval(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chr20"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12118762</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12118762</span>)</span>
<span id="cb5-2">chr20_vcf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.read_vcf(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/rn7_data/chr20.vcf.gz"</span>)</span>
<span id="cb5-3">haplo1, haplo2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.vcf_to_seq(target_interval, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'000789972A'</span>, chr20_vcf, fasta_extractor)</span>
<span id="cb5-4">haplo1_enc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.one_hot_encode(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>.join(haplo1))[np.newaxis]</span>
<span id="cb5-5">haplo2_enc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.one_hot_encode(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>.join(haplo2))[np.newaxis]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">mean_haplo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (haplo1_enc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> haplo2_enc) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb6-2">output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.model.predict_on_batch(mean_haplo)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(human_prediction)</span>
<span id="cb7-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(output[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'human'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0.23258275 0.2962714  0.52013165 ... 0.19615567 1.1101408  0.25560504]
 [0.15570731 0.20205402 0.3755348  ... 0.04365927 0.24989623 0.08517855]
 [0.1536611  0.21689793 0.4510562  ... 0.05227472 0.2147567  0.08478698]
 ...
 [0.1794057  0.22463816 0.29514343 ... 0.01105995 0.02652512 0.03385386]
 [0.1694869  0.20448665 0.26207498 ... 0.01688805 0.04071837 0.06028533]
 [0.15269741 0.20196484 0.22278813 ... 0.02438667 0.03900523 0.05988767]]
[[0.23258275 0.2962714  0.52013165 ... 0.19615567 1.1101408  0.25560504]
 [0.15570731 0.20205402 0.3755348  ... 0.04365927 0.24989623 0.08517855]
 [0.1536611  0.21689793 0.4510562  ... 0.05227472 0.2147567  0.08478698]
 ...
 [0.1794057  0.22463816 0.29514343 ... 0.01105995 0.02652512 0.03385386]
 [0.1694869  0.20448665 0.26207498 ... 0.01688805 0.04071837 0.06028533]
 [0.15269741 0.20196484 0.22278813 ... 0.02438667 0.03900523 0.05988767]]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"There are"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(human_prediction <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> output[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'human'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"differences between the human heads and"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(mouse_prediction <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> output[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mouse'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"differences in the mouse heads."</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 0 differences between the human heads and 0 differences in the mouse heads.</code></pre>
</div>
</div>
</section>
<section id="reference-test" class="level2">
<h2 class="anchored" data-anchor-id="reference-test">Reference Test</h2>
<pre><code>conda activate enformer-predict-tools

python /Users/sabrinami/Github/enformer_epigenome_pipeline/enformer_predict.py --parameters /Users/sabrinami/Github/deep-learning-in-genomics/posts/2023-08-31-testing-multiple-heads-in-pipeline/local_test_reference.json
</code></pre>
<section id="check-predictions" class="level3">
<h3 class="anchored" data-anchor-id="check-predictions">Check Predictions</h3>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb12-2">f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> h5py.File(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/predictions_folder/reference_enformer_rat_single_gene/predictions_2023-08-31/enformer_predictions/reference_enformer_rat/haplotype0/chr20_12118762_12118762_predictions.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>)</span>
<span id="cb12-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> kipoiseq </span>
<span id="cb12-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> kipoiseq <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Interval</span>
<span id="cb12-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> EnformerVCF</span>
<span id="cb12-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb12-7">fasta_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/rn7_data/rn7_genome.fasta'</span></span>
<span id="cb12-8">fasta_extractor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.FastaStringExtractor(fasta_file)</span>
<span id="cb12-9">human_prediction1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'human'</span>][()]</span>
<span id="cb12-10">mouse_prediction1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mouse'</span>][()]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">SEQUENCE_LENGTH <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">393216</span></span>
<span id="cb13-2">target_interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kipoiseq.Interval(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chr20"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12118762</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12118762</span>)</span>
<span id="cb13-3">sequence_one_hot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.one_hot_encode(fasta_extractor.extract(target_interval.resize(SEQUENCE_LENGTH)))</span>
<span id="cb13-4">output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.model.predict_on_batch(sequence_one_hot[np.newaxis])</span>
<span id="cb13-5">mouse_prediction2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> output[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mouse'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb13-6">human_prediction2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> output[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'human'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"There are"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(human_prediction1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> human_prediction2)), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"differences between human predictions and"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(human_prediction1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> human_prediction2)), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"differences between mouse predictions."</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 0 differences between human predictions and 0 differences between mouse predictions.</code></pre>
</div>
</div>


</section>
</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-31-testing-multiple-heads-in-pipeline/index.html</guid>
  <pubDate>Thu, 31 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Correlation between Enformer CAGE:Brain predictions and mean TPM in various GTEx brain tissues</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index.html</link>
  <description><![CDATA[ 




<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"></span>
<span id="cb1-4">brain_tissues <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"amygdala"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anterior_cingulate_cortex_ba24"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"caudate_basal_ganglia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cerebellar_hemisphere"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cerebellum"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cortex"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"frontal_cortex_ba9"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hippocampus"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hypothalamus"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nucleus_accumbens_basal_ganglia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"putamen_basal_ganglia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spinal_cord_cervical_c-1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"substantia_nigra"</span>]</span>
<span id="cb1-5">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/output/hg38_predicted_expression.csv"</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> tissue <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> brain_tissues:</span>
<span id="cb1-7">    tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"https://storage.googleapis.com/gtex_analysis_v8/rna_seq_data/gene_tpm/gene_tpm_2017-06-05_v8_brain_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tissue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.gct.gz"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-8">    tpm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tpm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> gene: gene.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb1-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># some genes are repeated (different ensembl version), remove second occurrence</span></span>
<span id="cb1-10">    tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tpm[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>tpm.duplicated(subset<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>], keep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'first'</span>)]</span>
<span id="cb1-11">    tpm.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate average gene expression</span></span>
<span id="cb1-13">    mean_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tpm.drop(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Description'</span>]).mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-14">    mean_tpm.name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tissue.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>)</span>
<span id="cb1-15">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.merge(mean_tpm, left_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, right_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, how <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inner"</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">df.to_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/output/hg38_predicted_vs_observed_expression_all_GTEx_brain_tissues.csv"</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">corr_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.corr()</span>
<span id="cb3-2">corr_df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">enformer</th>
<th data-quarto-table-cell-role="th">amygdala</th>
<th data-quarto-table-cell-role="th">anterior cingulate cortex ba24</th>
<th data-quarto-table-cell-role="th">caudate basal ganglia</th>
<th data-quarto-table-cell-role="th">cerebellar hemisphere</th>
<th data-quarto-table-cell-role="th">cerebellum</th>
<th data-quarto-table-cell-role="th">cortex</th>
<th data-quarto-table-cell-role="th">frontal cortex ba9</th>
<th data-quarto-table-cell-role="th">hippocampus</th>
<th data-quarto-table-cell-role="th">hypothalamus</th>
<th data-quarto-table-cell-role="th">nucleus accumbens basal ganglia</th>
<th data-quarto-table-cell-role="th">putamen basal ganglia</th>
<th data-quarto-table-cell-role="th">spinal cord cervical c-1</th>
<th data-quarto-table-cell-role="th">substantia nigra</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">enformer</td>
<td>1.000000</td>
<td>0.467619</td>
<td>0.537760</td>
<td>0.475759</td>
<td>0.525852</td>
<td>0.523848</td>
<td>0.539825</td>
<td>0.557909</td>
<td>0.472233</td>
<td>0.410200</td>
<td>0.487022</td>
<td>0.463762</td>
<td>0.246135</td>
<td>0.380836</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">amygdala</td>
<td>0.467619</td>
<td>1.000000</td>
<td>0.954906</td>
<td>0.932110</td>
<td>0.699623</td>
<td>0.720513</td>
<td>0.908948</td>
<td>0.896015</td>
<td>0.967708</td>
<td>0.802080</td>
<td>0.935692</td>
<td>0.934127</td>
<td>0.713773</td>
<td>0.896603</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">anterior cingulate cortex ba24</td>
<td>0.537760</td>
<td>0.954906</td>
<td>1.000000</td>
<td>0.918404</td>
<td>0.766384</td>
<td>0.779114</td>
<td>0.975494</td>
<td>0.978834</td>
<td>0.919471</td>
<td>0.763097</td>
<td>0.929791</td>
<td>0.905958</td>
<td>0.570054</td>
<td>0.783233</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">caudate basal ganglia</td>
<td>0.475759</td>
<td>0.932110</td>
<td>0.918404</td>
<td>1.000000</td>
<td>0.683751</td>
<td>0.714650</td>
<td>0.900610</td>
<td>0.880568</td>
<td>0.900796</td>
<td>0.752087</td>
<td>0.977106</td>
<td>0.989579</td>
<td>0.616714</td>
<td>0.820553</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">cerebellar hemisphere</td>
<td>0.525852</td>
<td>0.699623</td>
<td>0.766384</td>
<td>0.683751</td>
<td>1.000000</td>
<td>0.977913</td>
<td>0.759456</td>
<td>0.783059</td>
<td>0.698800</td>
<td>0.609139</td>
<td>0.725290</td>
<td>0.664395</td>
<td>0.386328</td>
<td>0.581458</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">cerebellum</td>
<td>0.523848</td>
<td>0.720513</td>
<td>0.779114</td>
<td>0.714650</td>
<td>0.977913</td>
<td>1.000000</td>
<td>0.789908</td>
<td>0.782710</td>
<td>0.717366</td>
<td>0.626874</td>
<td>0.749312</td>
<td>0.697112</td>
<td>0.410336</td>
<td>0.611442</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">cortex</td>
<td>0.539825</td>
<td>0.908948</td>
<td>0.975494</td>
<td>0.900610</td>
<td>0.759456</td>
<td>0.789908</td>
<td>1.000000</td>
<td>0.981027</td>
<td>0.887993</td>
<td>0.730072</td>
<td>0.895736</td>
<td>0.893500</td>
<td>0.538779</td>
<td>0.742445</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">frontal cortex ba9</td>
<td>0.557909</td>
<td>0.896015</td>
<td>0.978834</td>
<td>0.880568</td>
<td>0.783059</td>
<td>0.782710</td>
<td>0.981027</td>
<td>1.000000</td>
<td>0.877334</td>
<td>0.722115</td>
<td>0.884639</td>
<td>0.870592</td>
<td>0.514861</td>
<td>0.719960</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">hippocampus</td>
<td>0.472233</td>
<td>0.967708</td>
<td>0.919471</td>
<td>0.900796</td>
<td>0.698800</td>
<td>0.717366</td>
<td>0.887993</td>
<td>0.877334</td>
<td>1.000000</td>
<td>0.814058</td>
<td>0.899047</td>
<td>0.915272</td>
<td>0.812031</td>
<td>0.934632</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">hypothalamus</td>
<td>0.410200</td>
<td>0.802080</td>
<td>0.763097</td>
<td>0.752087</td>
<td>0.609139</td>
<td>0.626874</td>
<td>0.730072</td>
<td>0.722115</td>
<td>0.814058</td>
<td>1.000000</td>
<td>0.763480</td>
<td>0.745192</td>
<td>0.681446</td>
<td>0.806814</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">nucleus accumbens basal ganglia</td>
<td>0.487022</td>
<td>0.935692</td>
<td>0.929791</td>
<td>0.977106</td>
<td>0.725290</td>
<td>0.749312</td>
<td>0.895736</td>
<td>0.884639</td>
<td>0.899047</td>
<td>0.763480</td>
<td>1.000000</td>
<td>0.962463</td>
<td>0.588651</td>
<td>0.808008</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">putamen basal ganglia</td>
<td>0.463762</td>
<td>0.934127</td>
<td>0.905958</td>
<td>0.989579</td>
<td>0.664395</td>
<td>0.697112</td>
<td>0.893500</td>
<td>0.870592</td>
<td>0.915272</td>
<td>0.745192</td>
<td>0.962463</td>
<td>1.000000</td>
<td>0.655825</td>
<td>0.844448</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">spinal cord cervical c-1</td>
<td>0.246135</td>
<td>0.713773</td>
<td>0.570054</td>
<td>0.616714</td>
<td>0.386328</td>
<td>0.410336</td>
<td>0.538779</td>
<td>0.514861</td>
<td>0.812031</td>
<td>0.681446</td>
<td>0.588651</td>
<td>0.655825</td>
<td>1.000000</td>
<td>0.916613</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">substantia nigra</td>
<td>0.380836</td>
<td>0.896603</td>
<td>0.783233</td>
<td>0.820553</td>
<td>0.581458</td>
<td>0.611442</td>
<td>0.742445</td>
<td>0.719960</td>
<td>0.934632</td>
<td>0.806814</td>
<td>0.808008</td>
<td>0.844448</td>
<td>0.916613</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> plot_predicted_vs_observed(tissue):</span>
<span id="cb4-2">    corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> corr_df.loc[tissue, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"enformer"</span>]</span>
<span id="cb4-3">    plt.scatter(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'enformer'</span>], df[tissue], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Correlation: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>corr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb4-4">    plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'enformer'</span>)</span>
<span id="cb4-5">    plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gtex'</span>)</span>
<span id="cb4-6">    plt.title(tissue.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>))</span>
<span id="cb4-7">    plt.legend()</span>
<span id="cb4-8">    plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-9">    plt.show()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> tissue <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> brain_tissues:</span>
<span id="cb5-2">    plot_predicted_vs_observed(tissue.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>))</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-9.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-10.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-11.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-12.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index_files/figure-html/cell-6-output-13.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-30-comparing-predicted-reference-expression-to-various-GTEx-brain-tissues/index.html</guid>
  <pubDate>Wed, 30 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Comparing the predicted reference epigenome to Enformer runs centered at the TSS and ground truth</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index.html</link>
  <description><![CDATA[ 




<p>We are trying to debug low correlation values between predicted reference CAGE values and reference observed gene expression by inspecting a few genes.</p>
<section id="select-genes" class="level2">
<h2 class="anchored" data-anchor-id="select-genes">Select Genes</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tensorflow <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> tf</span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make sure the GPU is enabled </span></span>
<span id="cb1-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">assert</span> tf.config.list_physical_devices(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'GPU'</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Start the colab kernel with GPU: Runtime -&gt; Change runtime type -&gt; GPU'</span></span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tensorflow_hub <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> hub</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> joblib</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> gzip</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> kipoiseq</span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> kipoiseq <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Interval</span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pyfaidx</span>
<span id="cb1-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-11"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-12"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-13"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> mpl</span>
<span id="cb1-14"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb1-15"></span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span>
<span id="cb1-19"></span>
<span id="cb1-20">transform_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gs://dm-enformer/models/enformer.finetuned.SAD.robustscaler-PCA500-robustscaler.transform.pkl'</span></span>
<span id="cb1-21">model_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'https://tfhub.dev/deepmind/enformer/1'</span></span>
<span id="cb1-22">fasta_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/lus/grand/projects/TFXcan/imlab/data/hg_sequences/hg38/Homo_sapiens_assembly38.fasta'</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">annot_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/annotation/hg38.protein_coding_TSS.txt"</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb2-2">genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> annot_df.sample(n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb2-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(genes)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       ensembl_gene_id external_gene_name chromosome_name  \
2199   ENSG00000121898              CPXM2              10   
1804   ENSG00000162613              FUBP1               1   
15362  ENSG00000164327             RICTOR               5   
5786   ENSG00000087303               NID2              14   
4613   ENSG00000139233               LLPH              12   
6638   ENSG00000050820              BCAR1              16   
2681   ENSG00000171160              MORN4              10   
9526   ENSG00000181781             ODF3L2              19   
4709   ENSG00000123064              DDX54              12   
10435  ENSG00000135632              SMYD5               2   

       transcription_start_site  
2199                  123891807  
1804                   77979072  
15362                  39074399  
5786                   52069059  
4613                   66130750  
6638                   75251624  
2681                   97633500  
9526                     474983  
4709                  113185478  
10435                  73214245  </code></pre>
</div>
</div>
</section>
<section id="run-enformer-at-the-tss" class="level2">
<h2 class="anchored" data-anchor-id="run-enformer-at-the-tss">Run Enformer at the TSS</h2>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">SEQUENCE_LENGTH <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">393216</span></span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Enformer:</span>
<span id="cb4-4"></span>
<span id="cb4-5">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, tfhub_url):</span>
<span id="cb4-6">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hub.load(tfhub_url).model</span>
<span id="cb4-7"></span>
<span id="cb4-8">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> predict_on_batch(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, inputs):</span>
<span id="cb4-9">    predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._model.predict_on_batch(inputs)</span>
<span id="cb4-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {k: v.numpy() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> k, v <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> predictions.items()}</span>
<span id="cb4-11"></span>
<span id="cb4-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tf.function</span></span>
<span id="cb4-13">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> contribution_input_grad(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, input_sequence,</span>
<span id="cb4-14">                              target_mask, output_head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'human'</span>):</span>
<span id="cb4-15">    input_sequence <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> input_sequence[tf.newaxis]</span>
<span id="cb4-16"></span>
<span id="cb4-17">    target_mask_mass <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tf.reduce_sum(target_mask)</span>
<span id="cb4-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> tf.GradientTape() <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> tape:</span>
<span id="cb4-19">      tape.watch(input_sequence)</span>
<span id="cb4-20">      prediction <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tf.reduce_sum(</span>
<span id="cb4-21">          target_mask[tf.newaxis] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb4-22">          <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._model.predict_on_batch(input_sequence)[output_head]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> target_mask_mass</span>
<span id="cb4-23"></span>
<span id="cb4-24">    input_grad <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tape.gradient(prediction, input_sequence) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> input_sequence</span>
<span id="cb4-25">    input_grad <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tf.squeeze(input_grad, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb4-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> tf.reduce_sum(input_grad, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-27">  </span>
<span id="cb4-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> plot_tracks(tracks, interval, height<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>):</span>
<span id="cb4-29">  fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(tracks), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(tracks)), sharex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-30">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> ax, (title, y) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(axes, tracks.items()):</span>
<span id="cb4-31">    ax.fill_between(np.linspace(interval.start, interval.end, num<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(y)), y)</span>
<span id="cb4-32">    ax.set_title(title)</span>
<span id="cb4-33">    sns.despine(top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, right<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, bottom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-34">  ax.set_xlabel(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(interval))</span>
<span id="cb4-35">  plt.tight_layout()</span>
<span id="cb4-36">  </span>
<span id="cb4-37"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> FastaStringExtractor:</span>
<span id="cb4-38">    </span>
<span id="cb4-39">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, fasta_file):</span>
<span id="cb4-40">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fasta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pyfaidx.Fasta(fasta_file)</span>
<span id="cb4-41">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._chromosome_sizes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {k: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(v) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> k, v <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fasta.items()}</span>
<span id="cb4-42"></span>
<span id="cb4-43">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> extract(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, interval: Interval, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb4-44">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Truncate interval if it extends beyond the chromosome lengths.</span></span>
<span id="cb4-45">        chromosome_length <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._chromosome_sizes[interval.chrom]</span>
<span id="cb4-46">        trimmed_interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Interval(interval.chrom,</span>
<span id="cb4-47">                                    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(interval.start, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb4-48">                                    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(interval.end, chromosome_length),</span>
<span id="cb4-49">                                    )</span>
<span id="cb4-50">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pyfaidx wants a 1-based interval</span></span>
<span id="cb4-51">        sequence <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fasta.get_seq(trimmed_interval.chrom,</span>
<span id="cb4-52">                                          trimmed_interval.start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb4-53">                                          trimmed_interval.stop).seq).upper()</span>
<span id="cb4-54">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fill truncated values with N's.</span></span>
<span id="cb4-55">        pad_upstream <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'N'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>interval.start, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb4-56">        pad_downstream <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'N'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(interval.end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> chromosome_length, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb4-57">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> pad_upstream <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sequence <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pad_downstream</span>
<span id="cb4-58"></span>
<span id="cb4-59">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> close(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb4-60">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fasta.close()</span>
<span id="cb4-61">    </span>
<span id="cb4-62"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> one_hot_encode(sequence):</span>
<span id="cb4-63">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> kipoiseq.transforms.functional.one_hot_dna(sequence).astype(np.float32)</span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Enformer(model_path)</span>
<span id="cb5-2">fasta_extractor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FastaStringExtractor(fasta_file)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Create Interval object for each TSS</span></span>
<span id="cb6-2">intervals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [kipoiseq.Interval(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chr'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chromosome_name'</span>], row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'transcription_start_site'</span>], row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'transcription_start_site'</span>])</span>
<span id="cb6-3">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> _, row <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> genes.iterrows()]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">tss_predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb7-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> index, gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(genes[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ensembl_gene_id'</span>]):</span>
<span id="cb7-3">    tss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> intervals[index]</span>
<span id="cb7-4">    sequence_one_hot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> one_hot_encode(fasta_extractor.extract(tss.resize(SEQUENCE_LENGTH)))</span>
<span id="cb7-5">    tss_predictions[gene] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.predict_on_batch(sequence_one_hot[np.newaxis])[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'human'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span></code></pre></div>
</div>
</section>
<section id="query-predicted-reference-epigenome-at-the-tss" class="level2">
<h2 class="anchored" data-anchor-id="query-predicted-reference-epigenome-at-the-tss">Query Predicted Reference Epigenome at the TSS</h2>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb8-2"></span>
<span id="cb8-3">enfref_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/grand/TFXcan/imlab/users/lvairus/reftile_project/enformer-reference-epigenome"</span></span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query_epigenome(chr_num, center_bp, num_bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, tracks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb8-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Parameters:</span></span>
<span id="cb8-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        path_to_enfref (str): path to the directory containing the concatenated reference enformer files</span></span>
<span id="cb8-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        chr_num (int/string): chromosome number</span></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        center_bp (int): center base pair position (1-indexed)</span></span>
<span id="cb8-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        num_bins (int): number of bins to extract centered around center_bp (default: 896) </span></span>
<span id="cb8-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            note: if the number of bins is even, the center bin will be in the second half of the array</span></span>
<span id="cb8-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        tracks (int list): list of tracks to extract (default: all 5313 tracks)</span></span>
<span id="cb8-14"></span>
<span id="cb8-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns:</span></span>
<span id="cb8-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        epigen (np.array): enformer predictions centered at center_bp of shape (num_bins, len(tracks))</span></span>
<span id="cb8-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb8-18"></span>
<span id="cb8-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># from position choose center bin</span></span>
<span id="cb8-20">    center_ind <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb8-21">    center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_ind <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb8-22">    </span>
<span id="cb8-23">    half_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> num_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb8-24">    start_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> half_bins</span>
<span id="cb8-25">    end_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> half_bins</span>
<span id="cb8-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> num_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if num_bins is odd</span></span>
<span id="cb8-27">        end_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb8-28"></span>
<span id="cb8-29">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>enfref_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_cat.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb8-30">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get tracks if list provided</span></span>
<span id="cb8-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> tracks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb8-32">            epigen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>][start_bin:end_bin, :] </span>
<span id="cb8-33">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb8-34">            epigen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>][start_bin:end_bin, tracks] </span>
<span id="cb8-35"></span>
<span id="cb8-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> epigen</span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">predicted_reference_epigenome <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb9-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> index, gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(genes[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ensembl_gene_id'</span>]):</span>
<span id="cb9-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> genes.iloc[index][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chromosome_name'</span>]</span>
<span id="cb9-4">    pos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> genes.iloc[index][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'transcription_start_site'</span>]</span>
<span id="cb9-5">    predicted_reference_epigenome[gene] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query_epigenome(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, pos, num_bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">896</span>)</span></code></pre></div>
</div>
<p>We’ll save these matrices so we can come back to the same genes.</p>
<div class="cell" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># with h5py.File('/home/s1mi/enformer_rat_data/output/hg38_tss_predictions.h5', 'w') as hf:</span></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     for key, value in tss_predictions.items():</span></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         hf[key] = value</span></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># with h5py.File('/home/s1mi/enformer_rat_data/output/hg38_reference_epigenome_tss.h5', 'w') as hf:</span></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     for key, value in predicted_reference_epigenome.items():</span></span>
<span id="cb10-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         hf[key] = value</span></span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import h5py</span></span>
<span id="cb11-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># annot_df = pd.read_csv("/home/s1mi/enformer_rat_data/annotation/hg38.protein_coding_TSS.txt", sep="\t", index_col='ensembl_gene_id')</span></span>
<span id="cb11-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># predicted_reference_epigenome = {}</span></span>
<span id="cb11-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># with h5py.File('/home/s1mi/enformer_rat_data/output/hg38_reference_epigenome_tss.h5', 'r') as hf:</span></span>
<span id="cb11-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     for key in hf.keys():</span></span>
<span id="cb11-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         predicted_reference_epigenome[key] = hf[key][()]</span></span>
<span id="cb11-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tss_predictions = {}</span></span>
<span id="cb11-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># with h5py.File('/home/s1mi/enformer_rat_data/output/hg38_tss_predictions.h5', 'r') as hf:</span></span>
<span id="cb11-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     for key in hf.keys():</span></span>
<span id="cb11-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         tss_predictions[key] = hf[key][()]</span></span></code></pre></div>
</div>
</section>
<section id="compare-matrices" class="level2">
<h2 class="anchored" data-anchor-id="compare-matrices">Compare Matrices</h2>
<p>I used Laura’s matrix comparison functions, which can be expanded below:</p>
<div class="cell" data-execution_count="12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_diffmat(mat1, mat2):</span>
<span id="cb12-2">    </span>
<span id="cb12-3">    diffmat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mat1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mat2</span>
<span id="cb12-4">    colwise_maxes1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(mat1, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb12-5">    colwise_maxes2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(mat2, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb12-6"></span>
<span id="cb12-7">    colwise_maxes_maxes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.maximum(colwise_maxes1, colwise_maxes2)</span>
<span id="cb12-8"></span>
<span id="cb12-9">    relmax3_diffmat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> diffmat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> colwise_maxes_maxes</span>
<span id="cb12-10">    relmax3_diffmat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(relmax3_diffmat)</span>
<span id="cb12-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> relmax3_diffmat</span>
<span id="cb12-12"></span>
<span id="cb12-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_summary(arr):</span>
<span id="cb12-14">    summary <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb12-15">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>: np.mean(arr),</span>
<span id="cb12-16">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"median"</span>: np.median(arr),</span>
<span id="cb12-17">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minimum"</span>: np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(arr),</span>
<span id="cb12-18">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maximum"</span>: np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(arr),</span>
<span id="cb12-19">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"q1"</span>: np.percentile(arr, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>),</span>
<span id="cb12-20">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"q3"</span>: np.percentile(arr, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>),</span>
<span id="cb12-21">    }</span>
<span id="cb12-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> summary</span>
<span id="cb12-23"></span>
<span id="cb12-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> plot_hist(arr, bin_num, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Value'</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Frequency'</span>, title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Histogram'</span>):</span>
<span id="cb12-25">    plt.hist(arr, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bin_num)</span>
<span id="cb12-26">    plt.title(title)</span>
<span id="cb12-27">    plt.xlabel(xlab)</span>
<span id="cb12-28">    plt.ylabel(ylab)</span>
<span id="cb12-29">    plt.show()</span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">diff_mats <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {gene: get_diffmat(tss_predictions[gene], predicted_reference_epigenome[gene]) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> tss_predictions.keys()}</span>
<span id="cb13-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> diff_mats.keys():</span>
<span id="cb13-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(gene, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"summary:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, get_summary(diff_mats[gene]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ENSG00000121898 summary:
 {'mean': 0.032200303, 'median': 0.01341768, 'minimum': 0.0, 'maximum': 0.9901849, 'q1': 0.003314544155728072, 'q3': 0.038835618644952774}
ENSG00000162613 summary:
 {'mean': 0.01999371, 'median': 0.005458167, 'minimum': 0.0, 'maximum': 0.988134, 'q1': 0.0007359800220001489, 'q3': 0.022952284663915634}
ENSG00000164327 summary:
 {'mean': 0.025973188, 'median': 0.0063576996, 'minimum': 2.6839478e-10, 'maximum': 0.99930054, 'q1': 0.0010229847976006567, 'q3': 0.0275100851431489}
ENSG00000087303 summary:
 {'mean': 0.02138613, 'median': 0.0077090887, 'minimum': 0.0, 'maximum': 0.9420468, 'q1': 0.001561658486025408, 'q3': 0.025569051504135132}
ENSG00000139233 summary:
 {'mean': 0.015630499, 'median': 0.0037975144, 'minimum': 0.0, 'maximum': 0.9219668, 'q1': 0.0006033704994479194, 'q3': 0.016216954216361046}
ENSG00000050820 summary:
 {'mean': 0.013206795, 'median': 0.004311326, 'minimum': 0.0, 'maximum': 0.91182494, 'q1': 0.0008041909604799002, 'q3': 0.015259698033332825}
ENSG00000171160 summary:
 {'mean': 0.02672244, 'median': 0.00733448, 'minimum': 0.0, 'maximum': 0.98480076, 'q1': 0.001141986605944112, 'q3': 0.030081284698098898}
ENSG00000181781 summary:
 {'mean': 0.026071776, 'median': 0.0058201756, 'minimum': 0.0, 'maximum': 0.99881804, 'q1': 0.0007384350174106658, 'q3': 0.027037601452320814}
ENSG00000123064 summary:
 {'mean': 0.018377414, 'median': 0.0051327366, 'minimum': 0.0, 'maximum': 0.84950185, 'q1': 0.0008188941283151507, 'q3': 0.020361649803817272}
ENSG00000135632 summary:
 {'mean': 0.010653677, 'median': 0.002438372, 'minimum': 0.0, 'maximum': 0.88420224, 'q1': 0.0003591718268580735, 'q3': 0.010761200217530131}</code></pre>
</div>
</div>
<p>Since <code>get_diffmat</code> quantifies relative difference between two matrices, a maximum of 1 is quite high.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">corr_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {key: np.empty(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5313</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> key <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> diff_mats.keys()}</span>
<span id="cb15-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> corr_dict.keys():</span>
<span id="cb15-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> col <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5313</span>):</span>
<span id="cb15-4">        col_corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.corrcoef(tss_predictions[gene][:, col], predicted_reference_epigenome[gene][:, col])[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb15-5">        corr_dict[gene][col] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> col_corr</span></code></pre></div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> corr_dict.keys():</span>
<span id="cb16-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(get_summary(corr_dict[gene]))</span>
<span id="cb16-3">    plot_hist(corr_dict[gene], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gene)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'mean': 0.8049430343560166, 'median': 0.8328356084654803, 'minimum': 0.0886049231976136, 'maximum': 0.9873011016369064, 'q1': 0.7457438348765015, 'q3': 0.8957395348558694}
{'mean': 0.8986475454955245, 'median': 0.9287121904359038, 'minimum': 0.44826868323321156, 'maximum': 0.9945962529032818, 'q1': 0.8838251793830844, 'q3': 0.9635682170126223}
{'mean': 0.8045267661551807, 'median': 0.8533021666864998, 'minimum': 0.04249028764892999, 'maximum': 0.9829007173160716, 'q1': 0.7808240903986677, 'q3': 0.9162318636964755}
{'mean': 0.9153468696782503, 'median': 0.9217565843086337, 'minimum': 0.24337527243785198, 'maximum': 0.9960668159468162, 'q1': 0.8843923256605982, 'q3': 0.9570777829613587}
{'mean': 0.9067276703056678, 'median': 0.9487685336551595, 'minimum': 0.3544397363159794, 'maximum': 0.9962932767154381, 'q1': 0.9172946319240809, 'q3': 0.9721852288345812}
{'mean': 0.9685002179647139, 'median': 0.9718918783698673, 'minimum': 0.5774837936897961, 'maximum': 0.9970822682600515, 'q1': 0.9603764167762545, 'q3': 0.983808164894418}
{'mean': 0.8188228830558877, 'median': 0.8774429361059797, 'minimum': 0.15878411819220745, 'maximum': 0.9908752372163073, 'q1': 0.806399316249025, 'q3': 0.9316126393219638}
{'mean': 0.8244396183353139, 'median': 0.8766614272845572, 'minimum': 0.21515277099870878, 'maximum': 0.9734314614679092, 'q1': 0.8314860244560973, 'q3': 0.9116283548886374}
{'mean': 0.9224101439094681, 'median': 0.9397228749133515, 'minimum': 0.6120791237641421, 'maximum': 0.9941067107710185, 'q1': 0.9002750036208108, 'q3': 0.9632379272802634}
{'mean': 0.9115669859866135, 'median': 0.9701754129932663, 'minimum': 0.2662981770716635, 'maximum': 0.9971998874233308, 'q1': 0.9490859996588221, 'q3': 0.9862075624647917}</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-15-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-15-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-15-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-15-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-15-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-15-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-15-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-15-output-9.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-15-output-10.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-15-output-11.png" class="img-fluid"></p>
</div>
</div>
<p>This is pretty bad. But we’ll still plot the brain CAGE tracks, in case the root of our problems is bin indexing.</p>
<div class="cell" data-execution_count="25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">annot_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/annotation/hg38.protein_coding_TSS.txt"</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ensembl_gene_id'</span>)</span>
<span id="cb18-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> plot_CAGE_tracks(gene):</span>
<span id="cb18-3">    gene_annot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> annot_df.loc[gene]</span>
<span id="cb18-4">    start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gene_annot[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'transcription_start_site'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">57344</span></span>
<span id="cb18-5">    end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gene_annot[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'transcription_start_site'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">57344</span></span>
<span id="cb18-6">    target_interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kipoiseq.Interval(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>gene_annot[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chromosome_name'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, start, end)</span>
<span id="cb18-7">    tracks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Centered at TSS"</span>: tss_predictions[gene][:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>],</span>
<span id="cb18-8">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Queried from reference"</span>: predicted_reference_epigenome[gene][:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>]}</span>
<span id="cb18-9">    plot_tracks(tracks, target_interval)</span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> tss_predictions.keys():</span>
<span id="cb19-2">    plot_CAGE_tracks(gene)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-17-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-17-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-17-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-17-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-17-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-17-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-17-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-17-output-9.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index_files/figure-html/cell-17-output-10.png" class="img-fluid"></p>
</div>
</div>
<p>At least for the CAGE:Brain track, centering the input sequence at the TSS does not noticeably affect prediction along bins. But it is worth noting that the peaks predicted by centering sequences at TSS look slightly wider than when predicting in a fixed 448 bin window. Let’s query 8 bins around the TSS to verify. (In theory, the TSS will land on index 448 in both cases, or index 4 in the 8 bin window.)</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> corr_dict.keys():</span>
<span id="cb20-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(gene)</span>
<span id="cb20-3">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb20-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Centered at TSS"</span>: tss_predictions[gene][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">444</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">452</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>],</span>
<span id="cb20-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Queried from reference"</span>: predicted_reference_epigenome[gene][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">444</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">452</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>]</span>
<span id="cb20-6">    })</span>
<span id="cb20-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(df.transpose())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ENSG00000121898
                               0         1         2         3          4  \
Centered at TSS         0.082086  0.279907  0.440625  4.071788   3.021415   
Queried from reference  0.026973  0.184488  0.306243  0.599280  10.036044   

                               5         6         7  
Centered at TSS         0.033681  0.012400  0.010115  
Queried from reference  0.683917  0.033996  0.018840  
ENSG00000162613
                               0         1         2          3           4  \
Centered at TSS         0.076932  0.107431  0.190104  59.414913   44.131977   
Queried from reference  0.054259  0.077803  0.129248   0.457014  113.825249   

                               5         6         7  
Centered at TSS         7.694908  0.878686  3.008540  
Queried from reference  7.781330  4.396933  2.460186  
ENSG00000164327
                               0         1         2          3          4  \
Centered at TSS         0.392323  0.314011  0.328351  12.959496   4.288091   
Queried from reference  0.125206  0.404037  0.652251   0.185249  17.119499   

                               5         6         7  
Centered at TSS         0.746995  0.368291  0.123126  
Queried from reference  0.754246  0.489976  0.373154  
ENSG00000087303
                               0         1         2         3         4  \
Centered at TSS         0.039021  0.053638  0.235429  0.646864  1.494921   
Queried from reference  0.080472  0.029643  0.127269  0.273104  2.420461   

                               5         6         7  
Centered at TSS         0.172857  0.049821  0.075797  
Queried from reference  0.190278  0.060742  0.115897  
ENSG00000139233
                               0         1         2         3          4  \
Centered at TSS         0.040307  0.030658  0.027995  5.852082   9.505428   
Queried from reference  0.070822  0.031764  0.034324  0.041555  11.567361   

                               5         6         7  
Centered at TSS         0.185968  0.026289  0.013464  
Queried from reference  0.815561  0.030036  0.016201  
ENSG00000050820
                               0         1         2         3          4  \
Centered at TSS         0.114673  0.221738  0.484987  3.659282  15.693231   
Queried from reference  0.141583  0.171815  0.351790  0.665281  24.632042   

                               5         6         7  
Centered at TSS         0.169728  0.162921  0.282628  
Queried from reference  0.280914  0.157273  0.284518  
ENSG00000171160
                               0         1         2          3          4  \
Centered at TSS         0.073427  0.057288  0.123217  17.251186   3.344472   
Queried from reference  0.055889  0.057332  0.082732   0.132029  18.254246   

                               5         6         7  
Centered at TSS         0.072126  0.083481  0.012901  
Queried from reference  0.312892  0.033270  0.029419  
ENSG00000181781
                               0         1         2         3         4  \
Centered at TSS         0.018649  0.026022  0.118225  0.119143  0.134566   
Queried from reference  0.027906  0.015841  0.033200  0.094467  0.129208   

                               5         6         7  
Centered at TSS         0.011545  0.005993  0.008782  
Queried from reference  0.110075  0.010298  0.006653  
ENSG00000123064
                               0         1         2          3          4  \
Centered at TSS         1.115006  0.157705  0.413661  12.203613  16.859051   
Queried from reference  0.175724  1.541537  0.067659   0.507933  21.480145   

                               5         6         7  
Centered at TSS         0.659016  0.442875  0.483138  
Queried from reference  7.751738  0.415864  0.562360  
ENSG00000135632
                               0         1         2         3          4  \
Centered at TSS         0.004197  0.005604  0.035540  3.246182   9.616517   
Queried from reference  0.002469  0.006195  0.026891  0.172134  14.617000   

                               5         6         7  
Centered at TSS         0.261616  1.216553  0.174459  
Queried from reference  0.161753  1.406903  0.269044  </code></pre>
</div>
</div>
<p>Now the difference is much more noticeable. Let’s confirm with a correlation test for CAGE:Brain track.</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> corr_dict.keys():</span>
<span id="cb22-2">    col_corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.corrcoef(tss_predictions[gene][:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>], predicted_reference_epigenome[gene][:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>])[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb22-3">    dist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> annot_df.loc[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'transcription_start_site'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">57344</span></span>
<span id="cb22-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(gene, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Correlation:"</span>, col_corr, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">TSS distance from center:"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(dist, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">57344</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> dist))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ENSG00000121898 
Correlation: 0.6396015700677352 
TSS distance from center: 28577
ENSG00000162613 
Correlation: 0.6089762800309391 
TSS distance from center: 8768
ENSG00000164327 
Correlation: 0.3250502250053843 
TSS distance from center: 23135
ENSG00000087303 
Correlation: 0.94357261835514 
TSS distance from center: 707
ENSG00000139233 
Correlation: 0.510355799911747 
TSS distance from center: 13118
ENSG00000050820 
Correlation: 0.9543710850658597 
TSS distance from center: 16296
ENSG00000171160 
Correlation: 0.36819984155156643 
TSS distance from center: 23332
ENSG00000181781 
Correlation: 0.6519049075736117 
TSS distance from center: 16231
ENSG00000123064 
Correlation: 0.9232435790584608 
TSS distance from center: 11578
ENSG00000135632 
Correlation: 0.5146963218167778 
TSS distance from center: 14043</code></pre>
</div>
</div>
<p>The distance between the gene TSS and the center of input sequence is likely affecting predictions. Now we’ll want to consider whether centering at the TSS improves predictions based on a <em>very</em> small sample of 10 genes.</p>
</section>
<section id="compare-to-gtex-gene-expression" class="level2">
<h2 class="anchored" data-anchor-id="compare-to-gtex-gene-expression">Compare to GTEx gene expression</h2>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">gtex_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/expression_data/gene_tpm_2017-06-05_v8_brain_cortex.gct.gz"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb24-2">gtex_tpm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gtex_tpm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> gene: gene.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb24-3">gtex_tpm.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb24-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate average gene expression</span></span>
<span id="cb24-5">gtex_mean_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gtex_tpm.drop(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Description'</span>]).mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb24-6">gtex_mean_tpm.name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'GTEx'</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Quantify predicted gene expression</span></span>
<span id="cb25-2">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb25-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Centered at TSS"</span>: [np.average(tss_predictions[gene][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">446</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">450</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>]) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> tss_predictions.keys()],</span>
<span id="cb25-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Queried from reference"</span>: [np.average(predicted_reference_epigenome[gene][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">446</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">450</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>]) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> predicted_reference_epigenome.keys()]</span>
<span id="cb25-5">    }, index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tss_predictions.keys())</span></code></pre></div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">reference_gex_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.merge(gtex_mean_tpm, left_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, right_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, how<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'inner'</span>)</span>
<span id="cb26-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(reference_gex_df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Centered at TSS  Queried from reference       GTEx
ENSG00000050820         9.676256               12.648662  20.471502
ENSG00000087303         1.070892                1.346782   0.780738
ENSG00000121898         3.546602                5.317662   1.135701
ENSG00000123064        14.531332               10.994039  11.954925
ENSG00000135632         6.431349                7.394567  25.394757
ENSG00000139233         7.678755                5.804458   2.995251
ENSG00000162613        51.773445               57.141132  17.891106
ENSG00000164327         8.623794                8.652374   5.890239
ENSG00000171160        10.297829                9.193137  34.015620
ENSG00000181781         0.126855                0.111838   0.479827</code></pre>
</div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">gex_corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> reference_gex_df.corr()</span>
<span id="cb28-2">gex_corr</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Centered at TSS</th>
<th data-quarto-table-cell-role="th">Queried from reference</th>
<th data-quarto-table-cell-role="th">GTEx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centered at TSS</td>
<td>1.000000</td>
<td>0.991899</td>
<td>0.324152</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Queried from reference</td>
<td>0.991899</td>
<td>1.000000</td>
<td>0.316441</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">GTEx</td>
<td>0.324152</td>
<td>0.316441</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It’s worth noting that once the four bins around the TSS are averaged, predictions centered at TSS compared to 57,344 bp increments in the reference epigenome are very similar.</p>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-28-comparing-enformer-at-gene-tss-vs-reference-epigenome-vs-encode-experiments/index.html</guid>
  <pubDate>Mon, 28 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Cisd2 Correlation across rats</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-24-Cisd2-correlation-across-rats/index.html</link>
  <description><![CDATA[ 




<p>We picked Cisd2 out the selection process.</p>
<section id="run-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="run-pipeline">Run Pipeline</h3>
<p>We centered the interval at Cisd2’s TSS chr2:223868946.</p>
<pre><code>module load conda
conda activate /lus/grand/projects/TFXcan/imlab/shared/software/conda_envs/enformer-predict-tools
cd /home/s1mi/Github/shared_pipelines/enformer_pipeline
python scripts/enformer_predict.py --parameters /home/s1mi/Github/deep-learning-in-genomics/posts/2023-08-24-Cisd2-correlation-across-rats/Cisd2_personalized.json</code></pre>
</section>
<section id="compare-to-observed" class="level3">
<h3 class="anchored" data-anchor-id="compare-to-observed">Compare to Observed</h3>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb2-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">gene <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENSRNOG00000048258"</span></span>
<span id="cb3-2">gene_expr_bed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/expression_data/Brain.rn7.expr.tpm.bed"</span></span>
<span id="cb3-3">predictions_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/Br_predictions/predictions_folder/personalized_Br_genes/predictions_2023-08-24/enformer_predictions"</span></span>
<span id="cb3-4">obs_gene_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(gene_expr_bed, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gene_id'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_174805/3252868614.py:4: DtypeWarning: Columns (0) have mixed types. Specify dtype option on import or set low_memory=False.
  obs_gene_expr = pd.read_csv(gene_expr_bed, sep="\t", header=0, index_col='gene_id')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">obs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> obs_gene_expr.loc[gene][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>:]</span>
<span id="cb5-2">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"observed"</span>: obs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"predicted"</span>: np.zeros(obs.shape)})</span></code></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> individual <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> df.index:</span>
<span id="cb6-2">    haplo0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> h5py.File(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>predictions_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>individual<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/haplotype0/chr2_223868946_223868946_predictions.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>)</span>
<span id="cb6-3">    predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> haplo0[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chr2_223868946_223868946"</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">446</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">450</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb6-4">    df.loc[individual, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"predicted"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.average(predictions)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">df.corr()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">observed</th>
<th data-quarto-table-cell-role="th">predicted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">observed</td>
<td>1.000000</td>
<td>0.318211</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">predicted</td>
<td>0.318211</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"></span>
<span id="cb8-2">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'observed'</span>]</span>
<span id="cb8-3">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'predicted'</span>]</span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create the dot plot</span></span>
<span id="cb8-5">plt.scatter(x, y, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add labels and title</span></span>
<span id="cb8-8">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Observed'</span>)</span>
<span id="cb8-9">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Predicted'</span>)</span>
<span id="cb8-10">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Cisd2'</span>)</span>
<span id="cb8-11"></span>
<span id="cb8-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show the plot</span></span>
<span id="cb8-13">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-24-Cisd2-correlation-across-rats/index_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-24-Cisd2-correlation-across-rats/index.html</guid>
  <pubDate>Thu, 24 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Correlation of Enformer CAGE predictions on rn7 reference genome and measured gene expression in Br rats</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-22-correlation-across-rn7-genes-by-chromosome/index.html</link>
  <description><![CDATA[ 




<section id="concatenate-predictions" class="level2">
<h2 class="anchored" data-anchor-id="concatenate-predictions">Concatenate Predictions</h2>
<p>We start with concatenating our predictions into separate files by chromosome number, firstly because our predictions are currently split between two directories and secondly, by grouping intervals together by chromosome, we can parallelize computing gene expression.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> glob</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> parsl</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> parsl <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> python_app</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> parsl.configs.local_threads <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> config</span>
<span id="cb1-7">parsl.load(config)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>&lt;parsl.dataflow.dflow.DataFlowKernel at 0x7ff1b2188070&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">output_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/Br_predictions/predictions_folder/reference_Br_all_genes"</span></span>
<span id="cb3-2">chr_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"9"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"12"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"13"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"14"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"15"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"16"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"17"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"18"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"19"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@python_app</span></span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> concatenate_predictions_by_chromosome(predictions_dir, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, output_dir):</span>
<span id="cb4-3">    output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(output_dir, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_predictions.h5"</span>)</span>
<span id="cb4-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> output_file:</span>
<span id="cb4-5">        files <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> glob.glob(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>predictions_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">*_predictions.h5"</span>)</span>
<span id="cb4-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> files:</span>
<span id="cb4-7">            interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.basename(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>).replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_predictions.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb4-8">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> input_file:</span>
<span id="cb4-9">                output_file[interval] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> input_file[interval][()]</span>
<span id="cb4-10">            </span></code></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## concatenate files in first prediction run</span></span>
<span id="cb5-2">predictions_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>output_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/predictions_2023-08-16/enformer_predictions/reference_Br/haplotype0"</span></span>
<span id="cb5-3">app_futures <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb5-5">    app_futures.append(concatenate_predictions_by_chromosome(predictions_dir, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, output_dir))</span>
<span id="cb5-6">exec_futures <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [q.result() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> q <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> app_futures]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## concatenate files in second prediction run</span></span>
<span id="cb6-2">predictions_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>output_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/predictions_2023-08-29/enformer_predictions/reference_Br/haplotype0"</span></span>
<span id="cb6-3">app_futures <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb6-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb6-5">    app_futures.append(concatenate_predictions_by_chromosome(predictions_dir, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, output_dir))</span>
<span id="cb6-6"></span>
<span id="cb6-7">exec_futures <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [q.result() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> q <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> app_futures]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Second prediction folder done</code></pre>
</div>
</div>
</section>
<section id="compare-predicted-and-observed" class="level2">
<h2 class="anchored" data-anchor-id="compare-predicted-and-observed">Compare Predicted and Observed</h2>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb8-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb8-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb8-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> parsl</span>
<span id="cb8-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> parsl <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> python_app</span>
<span id="cb8-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> parsl.configs.local_threads <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> config</span>
<span id="cb8-8">parsl.load(config)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>&lt;parsl.dataflow.dflow.DataFlowKernel at 0x7f5325796800&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">project_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/Br_predictions/predictions_folder/reference_Br_all_genes"</span></span>
<span id="cb10-2">chr_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"9"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"12"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"13"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"14"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"15"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"16"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"17"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"18"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"19"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>]</span>
<span id="cb10-3">rn7_annot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/home/s1mi/enformer_rat_data/annotation/rn7.gene.txt'</span>, sep <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb10-4">gene_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rn7_annot.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chromosome'</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'geneId'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>).to_dict()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_89896/1953959868.py:3: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  rn7_annot = pd.read_csv('/home/s1mi/enformer_rat_data/annotation/rn7.gene.txt', sep ='\t')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## filter genes to chr1-20 and X and make chr all strings</span></span>
<span id="cb12-2">gene_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(key): value <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> key, value <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> gene_dict.items() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(key) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list}</span></code></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/expression_data/Brain.rn7.expr.tpm.bed"</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gene_id'</span>)</span>
<span id="cb13-2">mean_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tpm.iloc[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>:].mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-3">mean_tpm.name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'observed'</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_89896/417279503.py:1: DtypeWarning: Columns (0) have mixed types. Specify dtype option on import or set low_memory=False.
  tpm = pd.read_csv("/home/s1mi/enformer_rat_data/expression_data/Brain.rn7.expr.tpm.bed", sep="\t", header=0, index_col='gene_id')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Function to put CAGE predictions in list (in the same order as gene list by chromosome)</span></span>
<span id="cb15-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@python_app</span></span>
<span id="cb15-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query_genes(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>):</span>
<span id="cb15-4">    gene_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gene_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>]</span>
<span id="cb15-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>project_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_predictions.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>:</span>
<span id="cb15-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> gene_list:</span>
<span id="cb15-7">            interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>rn7_annot<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>loc[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tss'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>rn7_annot<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>loc[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tss'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb15-8">            bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>[interval][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">446</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">450</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>]</span>
<span id="cb15-9">            CAGE_predictions[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>].append(np.average(bins))</span></code></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">rn7_annot.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"geneId"</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb16-2">CAGE_predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>: [] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list}</span>
<span id="cb16-3">app_futures <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb16-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Collect CAGE predictions in parallel across genes</span></span>
<span id="cb16-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb16-6">    app_futures.append(query_genes(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>))</span>
<span id="cb16-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Wait for all chromosomes to finish</span></span>
<span id="cb16-8">exec_futures <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [q.result() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> q <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> app_futures]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">merged_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb17-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb17-3">    merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gene_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>])</span>
<span id="cb17-4">    merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'predicted'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CAGE_predictions[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>]</span>
<span id="cb17-5">    merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'observed'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mean_tpm.loc[gene_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>]]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">all_genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat(merged_dict.values())</span>
<span id="cb18-2">all_genes.to_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/output/rn7_reference_predicted_vs_observed_expression.csv"</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> all_genes.corr().iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb19-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation across all rn7 genes:"</span>, corr)</span>
<span id="cb19-3">plt.scatter(all_genes[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'observed'</span>], all_genes[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'predicted'</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Correlation: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>corr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb19-4">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'observed'</span>)</span>
<span id="cb19-5">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'predicted'</span>)</span>
<span id="cb19-6">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rn7 prediction across genes"</span>)</span>
<span id="cb19-7">plt.legend()</span>
<span id="cb19-8">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb19-9">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Correlation across all rn7 genes: 0.45259620551544333</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-22-correlation-across-rn7-genes-by-chromosome/index_files/figure-html/cell-15-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb21-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(gene_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>]), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes on chromosome"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">correlation ="</span>, merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>].corr().iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3953 genes on chromosome 1  correlation = 0.476354606549354
2003 genes on chromosome 2  correlation = 0.5218130288311454
2030 genes on chromosome 3  correlation = 0.4610018149991454
1959 genes on chromosome 4  correlation = 0.5244393504977057
1780 genes on chromosome 5  correlation = 0.22610655969051743
1390 genes on chromosome 6  correlation = 0.5712413035540091
1648 genes on chromosome 7  correlation = 0.6087498490236489
1612 genes on chromosome 8  correlation = 0.4427092910204691
1146 genes on chromosome 9  correlation = 0.5372756452275427
2127 genes on chromosome 10     correlation = 0.5956000550961525
832 genes on chromosome 11  correlation = 0.4791331079400649
909 genes on chromosome 12  correlation = 0.585056162086108
881 genes on chromosome 13  correlation = 0.47875298103605635
989 genes on chromosome 14  correlation = 0.44209977697290426
1000 genes on chromosome 15     correlation = 0.48793264345973547
843 genes on chromosome 16  correlation = 0.5956281375952103
620 genes on chromosome 17  correlation = 0.45611724657883396
722 genes on chromosome 18  correlation = 0.1949450345152701
750 genes on chromosome 19  correlation = 0.5805874016394145
806 genes on chromosome 20  correlation = 0.43625318887442455
1344 genes on chromosome X  correlation = 0.32646076975552135</code></pre>
</div>
</div>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-22-correlation-across-rn7-genes-by-chromosome/index.html</guid>
  <pubDate>Wed, 23 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Correlation between Enformer reference CAGE prediction and GTEx brain tissue expression across genes</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-22-correlation-between-Enformer-and-GTEx-expression-across-genes-by-chromosome/index.html</link>
  <description><![CDATA[ 




<section id="collect-predicted-and-observed-reference-gene-expression-for-each-chromosome" class="level2">
<h2 class="anchored" data-anchor-id="collect-predicted-and-observed-reference-gene-expression-for-each-chromosome">Collect predicted and observed reference gene expression for each chromosome</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> parsl</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> parsl <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> python_app</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> parsl.configs.local_threads <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> config</span>
<span id="cb1-7">parsl.load(config)</span>
<span id="cb1-8"></span>
<span id="cb1-9">enfref_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/grand/TFXcan/imlab/users/lvairus/reftile_project/enformer-reference-epigenome"</span></span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query_epigenome(chr_num, center_bp, num_bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, tracks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb1-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Parameters:</span></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        path_to_enfref (str): path to the directory containing the concatenated reference enformer files</span></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        chr_num (int/string): chromosome number</span></span>
<span id="cb1-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        center_bp (int): center base pair position (1-indexed)</span></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        num_bins (int): number of bins to extract centered around center_bp (default: 896) </span></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            note: if the number of bins is even, the center bin will be in the second half of the array</span></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        tracks (int list): list of tracks to extract (default: all 5313 tracks)</span></span>
<span id="cb1-20"></span>
<span id="cb1-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns:</span></span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        epigen (np.array): enformer predictions centered at center_bp of shape (num_bins, len(tracks))</span></span>
<span id="cb1-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb1-24"></span>
<span id="cb1-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># from position choose center bin</span></span>
<span id="cb1-26">    center_ind <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-27">    center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_ind <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb1-28">    </span>
<span id="cb1-29">    half_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> num_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-30">    start_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> half_bins</span>
<span id="cb1-31">    end_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> half_bins</span>
<span id="cb1-32">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> num_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if num_bins is odd</span></span>
<span id="cb1-33">        end_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-34"></span>
<span id="cb1-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>enfref_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_cat.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb1-36">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get tracks if list provided</span></span>
<span id="cb1-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> tracks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb1-38">            epigen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>][start_bin:end_bin, :] </span>
<span id="cb1-39">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb1-40">            epigen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>][start_bin:end_bin, tracks] </span>
<span id="cb1-41"></span>
<span id="cb1-42">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> epigen</span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## create lists of genes on each chromomsome</span></span>
<span id="cb2-2">hg38_annot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/annotation/hg38.protein_coding_TSS.txt"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb2-3">gene_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hg38_annot.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chromosome_name'</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ensembl_gene_id'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>).to_dict()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Initialize lists of CAGE predictions for each gene</span></span>
<span id="cb3-2">hg38_annot.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ensembl_gene_id"</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb3-3">chr_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"9"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"12"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"13"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"14"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"15"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"16"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"17"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"18"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"19"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"21"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"22"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>]</span>
<span id="cb3-4">CAGE_predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {key: [] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> key <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list}</span></code></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Function to put CAGE predictions in list (in the same order as gene list by chromosome)</span></span>
<span id="cb4-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@python_app</span></span>
<span id="cb4-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query_genes(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>):</span>
<span id="cb4-4">    gene_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gene_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>]</span>
<span id="cb4-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> gene_list:</span>
<span id="cb4-6">        bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query_epigenome(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, hg38_annot.loc[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'transcription_start_site'</span>], tracks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>])</span>
<span id="cb4-7">        CAGE_predictions[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>].append(np.average(bins))</span></code></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">app_futures <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Collect CAGE predictions in parallel across genes</span></span>
<span id="cb5-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb5-4">    app_futures.append(query_genes(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>))</span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Wait for all chromosomes to finish</span></span>
<span id="cb5-6">exec_futures <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [q.result() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> q <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> app_futures]</span></code></pre></div>
</div>
</section>
<section id="count-missing-genes-in-reference-enformer" class="level2">
<h2 class="anchored" data-anchor-id="count-missing-genes-in-reference-enformer">Count missing genes in reference Enformer</h2>
<p>We are only missing TSS CAGE values for 12 genes, all on chromosome 12.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb6-2">    n_missing <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(np.isnan(np.array(CAGE_predictions[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>])))</span>
<span id="cb6-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> n_missing <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb6-4">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chromosome"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"missing"</span>, n_missing, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes in the predicted human reference epigenome"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chromosome 12 missing 27 genes in the predicted human reference epigenome</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">merged_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>: pd.DataFrame(index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gene_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>]) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list}</span>
<span id="cb8-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb8-3">    merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'enformer'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CAGE_predictions[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>]</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">all_predicted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat(merged_dict.values())</span>
<span id="cb9-2">all_predicted.to_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/output/hg38_predicted_expression.csv"</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">gtex_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/expression_data/gene_tpm_2017-06-05_v8_brain_cortex.gct.gz"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-2">gtex_tpm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gtex_tpm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> gene: gene.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb10-3">gtex_tpm.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate average gene expression</span></span>
<span id="cb10-5">gtex_mean_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gtex_tpm.drop(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Description'</span>]).mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-6">gtex_mean_tpm.name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gtex'</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb11-2">    gene_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>].index.intersection(gtex_tpm.index)</span>
<span id="cb11-3">    merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>].loc[gene_list]</span>
<span id="cb11-4">    merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>].merge(gtex_mean_tpm, left_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, right_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, how<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'inner'</span>).dropna()</span>
<span id="cb11-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>].shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes on chromosome"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"to be used in correlation test"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1977 genes on chromosome 1 to be used in correlation test
1201 genes on chromosome 2 to be used in correlation test
1031 genes on chromosome 3 to be used in correlation test
738 genes on chromosome 4 to be used in correlation test
858 genes on chromosome 5 to be used in correlation test
996 genes on chromosome 6 to be used in correlation test
878 genes on chromosome 7 to be used in correlation test
662 genes on chromosome 8 to be used in correlation test
748 genes on chromosome 9 to be used in correlation test
707 genes on chromosome 10 to be used in correlation test
1259 genes on chromosome 11 to be used in correlation test
965 genes on chromosome 12 to be used in correlation test
314 genes on chromosome 13 to be used in correlation test
587 genes on chromosome 14 to be used in correlation test
566 genes on chromosome 15 to be used in correlation test
815 genes on chromosome 16 to be used in correlation test
1133 genes on chromosome 17 to be used in correlation test
259 genes on chromosome 18 to be used in correlation test
1380 genes on chromosome 19 to be used in correlation test
520 genes on chromosome 20 to be used in correlation test
213 genes on chromosome 21 to be used in correlation test
416 genes on chromosome 22 to be used in correlation test
857 genes on chromosome X to be used in correlation test</code></pre>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chr_list:</span>
<span id="cb13-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chromosome"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"correlation:"</span>, merged_dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>].corr().iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chromosome 1 correlation: 0.6279205208330061
Chromosome 2 correlation: 0.4577084823841293
Chromosome 3 correlation: 0.5590473627720567
Chromosome 4 correlation: 0.6622514111261547
Chromosome 5 correlation: 0.5659772926746754
Chromosome 6 correlation: 0.5405769582022613
Chromosome 7 correlation: 0.4736588849210786
Chromosome 8 correlation: 0.6197347486783672
Chromosome 9 correlation: 0.6160610260212112
Chromosome 10 correlation: 0.7113057334708601
Chromosome 11 correlation: 0.5348642297249536
Chromosome 12 correlation: 0.6363452896594721
Chromosome 13 correlation: 0.4445465856319643
Chromosome 14 correlation: 0.35533005480427243
Chromosome 15 correlation: 0.664532588686653
Chromosome 16 correlation: 0.6644114213442329
Chromosome 17 correlation: 0.597201417137115
Chromosome 18 correlation: 0.24144231917848386
Chromosome 19 correlation: 0.5346556958916295
Chromosome 20 correlation: 0.6870184790969254
Chromosome 21 correlation: 0.7286380655413807
Chromosome 22 correlation: 0.5212558005156317
Chromosome X correlation: 0.560185751334359</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">all_genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat(merged_dict.values())</span>
<span id="cb15-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation across all genes:"</span>)</span>
<span id="cb15-3">all_genes.corr()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Correlation across all genes:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">enformer</th>
<th data-quarto-table-cell-role="th">gtex</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">enformer</td>
<td>1.000000</td>
<td>0.539788</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">gtex</td>
<td>0.539788</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-22-correlation-between-Enformer-and-GTEx-expression-across-genes-by-chromosome/index.html</guid>
  <pubDate>Tue, 22 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Correlation between human reference CAGE predictions to mean expression across GTEx genes</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-21-comparing-enformer-CAGE-prediction-to-GTEx-brain-cortex-expression-across-genes/index.html</link>
  <description><![CDATA[ 




<p>We learned that pieces of the hg38 reference epigenome are missing, including all gene regions on chromosomes 5, 6, and 7, and a handful (27 out of 1018) on chromosome 12. Based off the genes we could query, the correlation between predicted expression from human reference genome and mean expression in GTEx brain cortex tissues is 0.536, which is too low, even when we consider the missing genes.</p>
<p>We will definitely need to rerun Enformer on chromosomes 5-7, but I’m still stuck on how we’ll debug the low correlation. I double checked that the fasta file and gene annotation were both in hg38.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-4"></span>
<span id="cb1-5">enfref_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/grand/TFXcan/imlab/users/lvairus/reftile_project/enformer-reference-epigenome"</span></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query_epigenome(chr_num, center_bp, num_bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, tracks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb1-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Parameters:</span></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        path_to_enfref (str): path to the directory containing the concatenated reference enformer files</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        chr_num (int/string): chromosome number</span></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        center_bp (int): center base pair position (1-indexed)</span></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        num_bins (int): number of bins to extract centered around center_bp (default: 896) </span></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            note: if the number of bins is even, the center bin will be in the second half of the array</span></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        tracks (int list): list of tracks to extract (default: all 5313 tracks)</span></span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns:</span></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        epigen (np.array): enformer predictions centered at center_bp of shape (num_bins, len(tracks))</span></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb1-20"></span>
<span id="cb1-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># from position choose center bin</span></span>
<span id="cb1-22">    center_ind <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-23">    center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_ind <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb1-24">    </span>
<span id="cb1-25">    half_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> num_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-26">    start_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> half_bins</span>
<span id="cb1-27">    end_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> half_bins</span>
<span id="cb1-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> num_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if num_bins is odd</span></span>
<span id="cb1-29">        end_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-30"></span>
<span id="cb1-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>enfref_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_cat.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb1-32">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get tracks if list provided</span></span>
<span id="cb1-33">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> tracks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb1-34">            epigen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>][start_bin:end_bin, :] </span>
<span id="cb1-35">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb1-36">            epigen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>][start_bin:end_bin, tracks] </span>
<span id="cb1-37"></span>
<span id="cb1-38">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> epigen</span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">hg38_annot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/annotation/hg38.protein_coding_TSS.txt"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ensembl_gene_id'</span>)</span>
<span id="cb2-2">hg38_annot.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">external_gene_name</th>
<th data-quarto-table-cell-role="th">chromosome_name</th>
<th data-quarto-table-cell-role="th">transcription_start_site</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ensembl_gene_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSG00000142611</td>
<td>PRDM16</td>
<td>1</td>
<td>3069203</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSG00000157911</td>
<td>PEX10</td>
<td>1</td>
<td>2412564</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSG00000142655</td>
<td>PEX14</td>
<td>1</td>
<td>10474950</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSG00000149527</td>
<td>PLCH2</td>
<td>1</td>
<td>2476289</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSG00000171621</td>
<td>SPSB1</td>
<td>1</td>
<td>9292894</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">gene_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hg38_annot[hg38_annot[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chromosome_name"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>].index</span>
<span id="cb3-2">CAGE_predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb3-3">invalid_queries <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb3-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> gene_list:</span>
<span id="cb3-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hg38_annot.loc[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chromosome_name'</span>]</span>
<span id="cb3-6">    tss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hg38_annot.loc[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'transcription_start_site'</span>]</span>
<span id="cb3-7">    bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query_epigenome(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>,tss, num_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, tracks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>])</span>
<span id="cb3-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">any</span>(np.isnan(bins)):</span>
<span id="cb3-9">        invalid_queries.append(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-10">    CAGE_predictions.append(np.average(bins))</span></code></pre></div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(invalid_queries), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"out of"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(CAGE_predictions), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TSS regions missing from reference epigenome"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2849 out of 19625 TSS regions missing from reference epigenome</code></pre>
</div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> collections <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Counter</span>
<span id="cb6-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of missing regions by chromosme:"</span>)</span>
<span id="cb6-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(Counter(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> x: x.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], invalid_queries)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of missing regions by chromosme:
Counter({'6': 1031, '7': 919, '5': 872, '12': 27})</code></pre>
</div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total number of genes on those chromosome:"</span>)</span>
<span id="cb8-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>({key: Counter(hg38_annot[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chromosome_name'</span>])[key] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> key <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"12"</span>]})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total number of genes on those chromosome:
{'6': 1031, '7': 919, '5': 872, '12': 1018}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">gex_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"enformer"</span>: CAGE_predictions}, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gene_list)</span>
<span id="cb10-2">gex_df.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">enformer</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ensembl_gene_id</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSG00000142611</td>
<td>4.474399</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSG00000157911</td>
<td>6.886287</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSG00000142655</td>
<td>21.222824</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSG00000149527</td>
<td>0.027461</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSG00000171621</td>
<td>10.673162</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">gtex_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/expression_data/gene_tpm_2017-06-05_v8_brain_cortex.gct.gz"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb11-2">gtex_tpm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gtex_tpm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> gene: gene.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb11-3">gtex_tpm.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Name'</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">gene_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gex_df.index.intersection(gtex_tpm.index)</span>
<span id="cb12-2">gtex_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gtex_tpm.loc[gene_list]</span>
<span id="cb12-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(gtex_tpm.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes in both GTEx and BioMart datasets"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>19107 genes in both GTEx and BioMart datasets</code></pre>
</div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate average gene expression</span></span>
<span id="cb14-2">gtex_mean_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gtex_tpm.drop(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Description'</span>]).mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb14-3">gtex_mean_tpm.name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gtex'</span></span>
<span id="cb14-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join observed gene expression with Enformer CAGE predicted</span></span>
<span id="cb14-5">merged_gex_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gex_df.merge(gtex_mean_tpm, left_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, right_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, how<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'inner'</span>).dropna()</span>
<span id="cb14-6">merged_gex_df.head()</span>
<span id="cb14-7">merged_gex_df.to_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"observed_vs_predicted_expression_hg38_genes.csv"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">enformer</th>
<th data-quarto-table-cell-role="th">gtex</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSG00000000003</td>
<td>0.318157</td>
<td>4.587454</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSG00000000005</td>
<td>2.456774</td>
<td>0.208880</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSG00000000419</td>
<td>36.233582</td>
<td>26.515365</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSG00000000457</td>
<td>6.147785</td>
<td>2.538695</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSG00000000460</td>
<td>3.142622</td>
<td>0.840966</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">merged_gex_df.corr()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">enformer</th>
<th data-quarto-table-cell-role="th">gtex</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">enformer</td>
<td>1.000000</td>
<td>0.535759</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">gtex</td>
<td>0.535759</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>



 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-21-comparing-enformer-CAGE-prediction-to-GTEx-brain-cortex-expression-across-genes/index.html</guid>
  <pubDate>Tue, 22 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>biomaRt tutorial for querying gene annotation</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-18-gene-annotation-query-example-hg38/index.html</link>
  <description><![CDATA[ 




<p>BioMart is a database with gene annotations for various species, builds, etc. We can use the package biomaRt package to query information.</p>
<section id="install-biomart" class="level3">
<h3 class="anchored" data-anchor-id="install-biomart">Install biomaRt</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">requireNamespace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BiocManager"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quietly =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb1-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BiocManager"</span>)</span>
<span id="cb1-3">BiocManager<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"biomaRt"</span>)</span></code></pre></div>
</div>
</section>
<section id="example-1-getting-a-list-of-human-genes-and-their-tss-in-hg38" class="level3">
<h3 class="anchored" data-anchor-id="example-1-getting-a-list-of-human-genes-and-their-tss-in-hg38">Example 1: Getting a list of human genes and their TSS in hg38</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(biomaRt)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</div>
<p>We first want to verify gene annotation is in build hg38.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">ensembl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">useEnsembl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">biomart =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes"</span>)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">searchDatasets</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mart =</span> ensembl, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pattern =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hsapiens"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 dataset              description    version
80 hsapiens_gene_ensembl Human genes (GRCh38.p14) GRCh38.p14</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># connect to BioMart database for human genes</span></span>
<span id="cb5-2">ensembl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">useEnsembl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">biomart =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dataset =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hsapiens_gene_ensembl"</span>)</span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># query canonical TSS for protein-coding genes on chr 1-22, X, and Y</span></span>
<span id="cb5-4">protein_coding_TSS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> biomaRt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getBM</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">attributes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ensembl_gene_id"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"external_gene_name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chromosome_name"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transcript_start"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transcript_end"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transcript_biotype"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transcription_start_site"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transcript_is_canonical"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"strand"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">filters =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transcript_biotype"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chromosome_name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transcript_is_canonical"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"protein_coding"</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y'</span>), <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mart =</span> ensembl)</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># extract columns of interest</span></span>
<span id="cb5-7">protein_coding_TSS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> protein_coding_TSS[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ensembl_gene_id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"external_gene_name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chromosome_name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transcription_start_site"</span>)]</span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to file</span></span>
<span id="cb5-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(protein_coding_TSS, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"protein_coding_TSS.tsv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
</section>
<section id="example-2-getting-a-list-of-rat-genes-with-orthologs-in-humans" class="level3">
<h3 class="anchored" data-anchor-id="example-2-getting-a-list-of-rat-genes-with-orthologs-in-humans">Example 2: Getting a list of rat genes with orthologs in humans</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">listMarts</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               biomart                version
1 ENSEMBL_MART_ENSEMBL      Ensembl Genes 110
2   ENSEMBL_MART_MOUSE      Mouse strains 110
3     ENSEMBL_MART_SNP  Ensembl Variation 110
4 ENSEMBL_MART_FUNCGEN Ensembl Regulation 110</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># connect to BioMart database for rat genes</span></span>
<span id="cb8-2">ensembl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">useEnsembl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">biomart =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dataset =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rnorvegicus_gene_ensembl"</span>)</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># query all relevant data and store in a dataframe</span></span>
<span id="cb8-5">ortho_rat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getBM</span>( <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">attributes=</span></span>
<span id="cb8-6">                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ensembl_gene_id"</span>, </span>
<span id="cb8-7">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hsapiens_homolog_ensembl_gene"</span>,</span>
<span id="cb8-8">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"external_gene_name"</span>),</span>
<span id="cb8-9">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">filters =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"with_hsapiens_homolog"</span>,</span>
<span id="cb8-10">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb8-11">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mart =</span> ensembl)</span>
<span id="cb8-12"></span>
<span id="cb8-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to file</span></span>
<span id="cb8-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(ortho_rat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ortholog_genes_rats_humans.tsv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-18-gene-annotation-query-example-hg38/index.html</guid>
  <pubDate>Fri, 18 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Querying Human Reference Epigenome</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-17-querying-human-reference-epigenome/all_hg38_genes.html</link>
  <description><![CDATA[ 




<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> kipoiseq <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Interval</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb1-7"></span>
<span id="cb1-8"></span>
<span id="cb1-9">enfref_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/grand/TFXcan/imlab/users/lvairus/reftile_project/enformer-reference-epigenome"</span></span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query_epigenome(chr_num, center_bp, num_bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, tracks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb1-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Parameters:</span></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        path_to_enfref (str): path to the directory containing the concatenated reference enformer files</span></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        chr_num (int/string): chromosome number</span></span>
<span id="cb1-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        center_bp (int): center base pair position (1-indexed)</span></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        num_bins (int): number of bins to extract centered around center_bp (default: 896) </span></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            note: if the number of bins is even, the center bin will be in the second half of the array</span></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        tracks (int list): list of tracks to extract (default: all 5313 tracks)</span></span>
<span id="cb1-20"></span>
<span id="cb1-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns:</span></span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        epigen (np.array): enformer predictions centered at center_bp of shape (num_bins, len(tracks))</span></span>
<span id="cb1-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb1-24"></span>
<span id="cb1-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># from position choose center bin</span></span>
<span id="cb1-26">    center_ind <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-27">    center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_ind <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb1-28">    </span>
<span id="cb1-29">    half_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> num_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-30">    start_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> half_bins</span>
<span id="cb1-31">    end_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> center_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> half_bins</span>
<span id="cb1-32">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> num_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if num_bins is odd</span></span>
<span id="cb1-33">        end_bin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-34"></span>
<span id="cb1-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>enfref_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_cat.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb1-36">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get tracks if list provided</span></span>
<span id="cb1-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> tracks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb1-38">            epigen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>][start_bin:end_bin, :] </span>
<span id="cb1-39">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb1-40">            epigen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chr_num<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>][start_bin:end_bin, tracks] </span>
<span id="cb1-41"></span>
<span id="cb1-42">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> epigen</span></code></pre></div>
</div>
</section>
<section id="collect-tss-for-all-human-genes" class="level2">
<h2 class="anchored" data-anchor-id="collect-tss-for-all-human-genes">Collect TSS for all human genes</h2>
<p>We collected all protein-coding genes and their cannonical TSS using the biomaRt package.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"></span>
<span id="cb2-2">hg38_annot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/annotation/hg38.protein_coding_TSS.txt"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ensembl_gene_id'</span>)</span>
<span id="cb2-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(hg38_annot.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes with TSS annotation"</span>)</span>
<span id="cb2-4">hg38_annot.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>19688 genes with TSS annotation</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">external_gene_name</th>
<th data-quarto-table-cell-role="th">chromosome_name</th>
<th data-quarto-table-cell-role="th">transcription_start_site</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ensembl_gene_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSG00000142611</td>
<td>PRDM16</td>
<td>1</td>
<td>3069203</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSG00000157911</td>
<td>PEX10</td>
<td>1</td>
<td>2412564</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSG00000142655</td>
<td>PEX14</td>
<td>1</td>
<td>10474950</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSG00000149527</td>
<td>PLCH2</td>
<td>1</td>
<td>2476289</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSG00000171621</td>
<td>SPSB1</td>
<td>1</td>
<td>9292894</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We computed the predicted human reference epigenome by running Enformer on all intervals spanning the genome and concatenting the results. Now we extract the CAGE:Brain track at the bins where each gene’s TSS fall in order to quantify relative expression across genes.</p>
</section>
<section id="query-reference-epigenome-at-tss" class="level2">
<h2 class="anchored" data-anchor-id="query-reference-epigenome-at-tss">Query reference epigenome at TSS</h2>
<p>I found that querying the epigenome at certain positions returned NA, so I investigated those positions further by querying a larger window and plotting the CAGE track 4980.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">CAGE_predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb4-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> gene <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> hg38_annot.index:</span>
<span id="cb4-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hg38_annot.loc[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chromosome_name'</span>]</span>
<span id="cb4-4">    tss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hg38_annot.loc[gene][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'transcription_start_site'</span>]</span>
<span id="cb4-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bin</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query_epigenome(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>,tss, num_bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, tracks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>])</span>
<span id="cb4-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> np.isnan(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bin</span>):</span>
<span id="cb4-7">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Invalid query:"</span>, gene, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"at"</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb4-9">    CAGE_predictions.append(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bin</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Invalid query: ENSG00000173451 at 12:71664301</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>enfref_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/chr12_cat.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb6-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matrix shape:"</span>, f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chr12'</span>].shape)</span>
<span id="cb6-3">    center <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">71664301</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb6-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENSG00000173451 TTS at bin"</span>, center)</span>
<span id="cb6-5">    epigen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chr12'</span>][center<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">448</span>:center<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">448</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4980</span>]</span>
<span id="cb6-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of NA along track:"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(np.isnan(epigen)))</span>
<span id="cb6-7">    </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>matrix shape: (1041214, 5313)
ENSG00000173451 TTS at bin 559877
Number of NA along track: 448</code></pre>
</div>
</div>
<p>We adapted a function from the Enformer usage notebook to plot a single track.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> plot_track(title, y, interval, height<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>):</span>
<span id="cb8-2">  fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, height))</span>
<span id="cb8-3">  ax.fill_between(np.linspace(interval.start, interval.end, num<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(y)), y)</span>
<span id="cb8-4">  ax.set_title(title)</span>
<span id="cb8-5">  sns.despine(top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, right<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, bottom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb8-6">  ax.set_xlabel(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(interval))</span>
<span id="cb8-7">  plt.tight_layout()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">tss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Interval(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chr12'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">71664301</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">71664301</span>)</span>
<span id="cb9-2">plot_track(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'CAGE:Brain, ENSG00000173451'</span>, epigen, tss.resize(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">114688</span>))</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-17-querying-human-reference-epigenome/all_hg38_genes_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-17-querying-human-reference-epigenome/all_hg38_genes.html</guid>
  <pubDate>Thu, 17 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Testing the Enformer pipeline’s handling of unphased VCFs</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-15-test-run-of-personalized-enformer-pipeline-for-rats/average_haplotype_test.html</link>
  <description><![CDATA[ 




<section id="read-in-h5-prediction-file" class="level3">
<h3 class="anchored" data-anchor-id="read-in-h5-prediction-file">Read in h5 prediction file</h3>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span></code></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> h5py.File(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/predictions_folder/personalized_enformer_rat_single_gene/predictions_2023-08-16/enformer_predictions/000789972A/haplotype0/chr20_12118762_12118762_predictions.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>)</span>
<span id="cb2-2">predictions1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chr20_12118762_12118762'</span>][()]</span>
<span id="cb2-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(predictions1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0.23258275 0.2962714  0.52013165 ... 0.19615567 1.1101408  0.25560504]
 [0.15570731 0.20205402 0.3755348  ... 0.04365927 0.24989623 0.08517855]
 [0.1536611  0.21689793 0.4510562  ... 0.05227472 0.2147567  0.08478698]
 ...
 [0.1794057  0.22463816 0.29514343 ... 0.01105995 0.02652512 0.03385386]
 [0.1694869  0.20448665 0.26207498 ... 0.01688805 0.04071837 0.06028533]
 [0.15269741 0.20196484 0.22278813 ... 0.02438667 0.03900523 0.05988767]]</code></pre>
</div>
</div>
</section>
<section id="run-non-pipeline-enformer" class="level3">
<h3 class="anchored" data-anchor-id="run-non-pipeline-enformer">Run non-pipeline Enformer</h3>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> EnformerVCF</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> kipoiseq</span>
<span id="cb4-3">fasta_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/rn7_data/reference_genome/rn7_genome.fasta'</span></span>
<span id="cb4-4">fasta_extractor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.FastaStringExtractor(fasta_file)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># read VCFs and encode haplotypes</span></span>
<span id="cb5-2">target_interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kipoiseq.Interval(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chr20"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12118762</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12118762</span>)</span>
<span id="cb5-3">chr20_vcf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.read_vcf(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/sabrinami/enformer_rat_data/genotypes/BrainVCFs/chr20.vcf.gz"</span>)</span>
<span id="cb5-4">haplo1, haplo2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.vcf_to_seq(target_interval, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'000789972A'</span>, chr20_vcf, fasta_extractor)</span>
<span id="cb5-5">haplo1_enc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.one_hot_encode(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>.join(haplo1))[np.newaxis]</span>
<span id="cb5-6">haplo2_enc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.one_hot_encode(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>.join(haplo2))[np.newaxis]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">mean_haplo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (haplo1_enc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> haplo2_enc) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb6-2">predictions2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.model.predict_on_batch(mean_haplo)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'human'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"There are"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(predictions1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> predictions2)), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"differences between the two matrices."</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 0 differences between the two matrices.</code></pre>
</div>
</div>
<p>It looks like our edits worked!</p>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-15-test-run-of-personalized-enformer-pipeline-for-rats/average_haplotype_test.html</guid>
  <pubDate>Wed, 16 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Correlation of Enformer CAGE predictions and observed expression across all rn7 genes</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-10-correlation-across-genes/index.html</link>
  <description><![CDATA[ 




<p>Our goal is to test whether Enformer can determine relative gene expression levels in rat Brain tissues. We used mean gene expression in Br rats as the ground truth, and predicted the CAGE Brain track at each gene’s TSS. We found a correlation of 0.45, which we still need to compare to the same experiment with human data to determine whether this is high or low.</p>
<section id="reference-genome" class="level2">
<h2 class="anchored" data-anchor-id="reference-genome">Reference Genome</h2>
<section id="read-in-expression-files" class="level3">
<h3 class="anchored" data-anchor-id="read-in-expression-files">Read in expression files</h3>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/enformer_rat_data/expression_data/Brain.rn7.expr.tpm.bed"</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gene_id'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_129963/1140758785.py:1: DtypeWarning: Columns (0) have mixed types. Specify dtype option on import or set low_memory=False.
  tpm = pd.read_csv("/home/s1mi/enformer_rat_data/expression_data/Brain.rn7.expr.tpm.bed", sep="\t", header=0, index_col='gene_id')</code></pre>
</div>
</div>
</section>
<section id="calculate-average-gene-expression" class="level3">
<h3 class="anchored" data-anchor-id="calculate-average-gene-expression">Calculate average gene expression</h3>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">mean_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tpm.iloc[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>:].mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(mean_tpm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>gene_id
ENSRNOG00000065394    0.000000
ENSRNOG00000065356    0.000000
ENSRNOG00000070568    0.000912
ENSRNOG00000065706    0.005029
ENSRNOG00000069644    0.000265
                        ...   
ENSRNOG00000067420    0.000000
ENSRNOG00000069298    0.000559
ENSRNOG00000066131    0.000529
ENSRNOG00000068239    0.000500
ENSRNOG00000069552    0.001088
Length: 30231, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Put both means into dataframe</span></span>
<span id="cb6-2">corr_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tpm'</span>: mean_tpm, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'predicted'</span>: np.full(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30231</span>, np.nan), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chr'</span>: np.full(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30231</span>, np.nan)})</span>
<span id="cb6-3">corr_df.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tpm</th>
<th data-quarto-table-cell-role="th">iqn</th>
<th data-quarto-table-cell-role="th">predicted</th>
<th data-quarto-table-cell-role="th">chr</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">gene_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSRNOG00000065394</td>
<td>0.000000</td>
<td>0.000000</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSRNOG00000065356</td>
<td>0.000000</td>
<td>0.000000</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSRNOG00000070568</td>
<td>0.000912</td>
<td>0.052617</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSRNOG00000065706</td>
<td>0.005029</td>
<td>0.022574</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSRNOG00000069644</td>
<td>0.000265</td>
<td>0.011569</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="calculate-gene-expression-from-enformer-predictions-on-reference-genome" class="level3">
<h3 class="anchored" data-anchor-id="calculate-gene-expression-from-enformer-predictions-on-reference-genome">Calculate gene expression from Enformer predictions on reference genome</h3>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">reference_predictions<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/Br_predictions/predictions_folder/reference_Br_all_genes/predictions_2023-08-11/enformer_predictions/reference_Br/haplotype0"</span></span>
<span id="cb7-2"></span>
<span id="cb7-3">annot_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/home/s1mi/enformer_rat_data/annotation/rn7.gene.txt'</span>, sep <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>,  index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'geneId'</span>)</span>
<span id="cb7-4">annot_df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_36254/3273646084.py:3: DtypeWarning: Columns (2) have mixed types. Specify dtype option on import or set low_memory=False.
  annot_df = pd.read_csv('/home/s1mi/enformer_rat_data/annotation/rn7.gene.txt', sep ='\t',  index_col='geneId')</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geneSymbol</th>
<th data-quarto-table-cell-role="th">chromosome</th>
<th data-quarto-table-cell-role="th">start</th>
<th data-quarto-table-cell-role="th">end</th>
<th data-quarto-table-cell-role="th">strand</th>
<th data-quarto-table-cell-role="th">tss</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">hasEqtl</th>
<th data-quarto-table-cell-role="th">expr_BLA</th>
<th data-quarto-table-cell-role="th">expr_Brain</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">sqtl_BLA</th>
<th data-quarto-table-cell-role="th">sqtl_Brain</th>
<th data-quarto-table-cell-role="th">sqtl_Eye</th>
<th data-quarto-table-cell-role="th">sqtl_IL</th>
<th data-quarto-table-cell-role="th">sqtl_LHb</th>
<th data-quarto-table-cell-role="th">sqtl_NAcc</th>
<th data-quarto-table-cell-role="th">sqtl_NAcc2</th>
<th data-quarto-table-cell-role="th">sqtl_OFC</th>
<th data-quarto-table-cell-role="th">sqtl_PL</th>
<th data-quarto-table-cell-role="th">sqtl_PL2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">geneId</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSRNOG00000066169</td>
<td>ENSRNOG00000066169</td>
<td>1</td>
<td>36112690</td>
<td>36122387</td>
<td>-</td>
<td>36122387</td>
<td>NaN</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENSRNOG00000070168</td>
<td>Olr56</td>
<td>1</td>
<td>157231467</td>
<td>157232417</td>
<td>+</td>
<td>157231467</td>
<td>olfactory receptor family 51 subfamily F membe...</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENSRNOG00000070901</td>
<td>Irgq</td>
<td>1</td>
<td>80123925</td>
<td>80131881</td>
<td>+</td>
<td>80123925</td>
<td>immunity-related GTPase Q</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
</tbody>
</table>

<p>3 rows × 68 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for gene in corr_df.index:</span></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     gene_annot = annot_df.loc[gene]</span></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     corr_df['chr'].loc[gene] = gene_annot['chromosome']</span></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     interval = f"chr{gene_annot['chromosome']}_{gene_annot['tss']}_{gene_annot['tss']}"</span></span>
<span id="cb9-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     path = os.path.join(predictions_dir, f"{interval}_predictions.h5")</span></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     if os.path.isfile(path):</span></span>
<span id="cb9-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         predictions = h5py.File(path, "r")</span></span>
<span id="cb9-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         pred_expr = np.average(predictions[interval][446:450, 4980])</span></span>
<span id="cb9-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         corr_df['predicted'].loc[gene] = pred_expr</span></span>
<span id="cb9-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     else:</span></span>
<span id="cb9-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         continue</span></span>
<span id="cb9-12"></span>
<span id="cb9-13"></span>
<span id="cb9-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># corr_df.dropna().to_csv("reference_epigenome_predicted_vs_observed.csv", index=True)</span></span>
<span id="cb9-15"></span>
<span id="cb9-16">corr_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reference_epigenome_predicted_vs_observed.csv"</span>, header <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gene_id'</span>)</span>
<span id="cb9-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(corr_df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         tpm  predicted  chr
gene_id                                     
ENSRNOG00000065394  0.000000   0.002946  1.0
ENSRNOG00000065356  0.000000   0.004051  1.0
ENSRNOG00000070568  0.000912   0.003553  1.0
ENSRNOG00000065706  0.005029   0.005847  1.0
ENSRNOG00000069644  0.000265   0.001334  1.0
...                      ...        ...  ...
ENSRNOG00000067420  0.000000   0.001928    Y
ENSRNOG00000069298  0.000559   0.003280    Y
ENSRNOG00000066131  0.000529   0.003569    Y
ENSRNOG00000068239  0.000500   0.001887    Y
ENSRNOG00000069552  0.001088   0.001822    Y

[19493 rows x 3 columns]</code></pre>
</div>
</div>
<p>I ran Enformer on roughly ~30,000 intervals, but it looks like we only have predictions for 2/3 of them. I’ll investigate in another post.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Drop rows with NaN values</span></span>
<span id="cb11-2">corr_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> corr_df.dropna()</span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a scatter plot with colors based on column z</span></span>
<span id="cb11-5">plt.scatter(corr_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tpm'</span>], corr_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'predicted'</span>])</span>
<span id="cb11-6"></span>
<span id="cb11-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set labels and title</span></span>
<span id="cb11-8">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Br Mean TPM Gene Expression'</span>)</span>
<span id="cb11-9">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Predicted Rat Reference Gene Expression'</span>)</span>
<span id="cb11-10">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Predicted vs Observed Gene Expression'</span>)</span>
<span id="cb11-11"></span>
<span id="cb11-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show the plot</span></span>
<span id="cb11-13">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-10-correlation-across-genes/index_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">corr_df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tpm'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'predicted'</span>]].corr()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tpm</th>
<th data-quarto-table-cell-role="th">predicted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">tpm</td>
<td>1.000000</td>
<td>0.433632</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">predicted</td>
<td>0.433632</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The correlation between CAGE predictions and gene expression measured by relative abundance of transcripts is lower than we wanted. We’ll compare it with average gene expression in human brain tissue.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">gtex_tpm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_tpm_2017-06-05_v8_brain_cortex.gct.gz"</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb13-2">gtex_tpm.head()</span></code></pre></div>
</div>
<p>Lastly, we’ll concatenate all the prediction matrices into one h5 file.</p>
</section>
</section>
<section id="concatenate-predictions" class="level2">
<h2 class="anchored" data-anchor-id="concatenate-predictions">Concatenate Predictions</h2>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> concatenate_predictions(predictions_dir, output_path):</span>
<span id="cb14-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> output_file:</span>
<span id="cb14-3">        files <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.listdir(predictions_dir)</span>
<span id="cb14-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> files:</span>
<span id="cb14-5">            interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_predictions.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb14-6">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> h5py.File(os.path.join(predictions_dir, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> input_file:</span>
<span id="cb14-7">                output_file.create_dataset(interval, data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>input_file[interval][()], shape<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">896</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5313</span>))</span></code></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">concatenate_predictions(reference_predictions, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/s1mi/Br_predictions/2023-08-16_predictions_some_missing_genes.h5"</span>)</span></code></pre></div>
</div>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-10-correlation-across-genes/index.html</guid>
  <pubDate>Tue, 15 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Preparing rat VCFs for Enformer pipeline</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-14-updated-preparing-rat-vcf-inputs-for-enformer-pipeline/index.html</link>
  <description><![CDATA[ 




<section id="download-vcf" class="level3">
<h3 class="anchored" data-anchor-id="download-vcf">Download VCF</h3>
<pre class="{bash}"><code>cd enformer_rat_data
wget https://ratgtex.org/data/geno/genotypes/Brain.rn7.vcf.gz
</code></pre>
</section>
<section id="changing-vcf-chrom-notation" class="level3">
<h3 class="anchored" data-anchor-id="changing-vcf-chrom-notation">Changing VCF CHROM notation</h3>
<pre class="{bash}"><code>gunzip genotypes/Brain.rn7.vcf.gz
awk '{if($0 !~ /^#/) print "chr"$0; else print $0}' genotypes/Brain.rn7.vcf &gt; output.rn7.vcf
</code></pre>
</section>
<section id="replace-missing-genotypes-with-reference-alleles" class="level3">
<h3 class="anchored" data-anchor-id="replace-missing-genotypes-with-reference-alleles">Replace missing genotypes with reference alleles</h3>
<p>Note: There are a number of good reasons filling in missing genotypes with two reference alleles is discouraged. However, our goal is to predict the epigenome from a sequence of 393,216 base pairs, so we assume that changing a snp will have negligible effect on Enformer predictions. Additionally, we are not using allele frequency to draw any conclusions about our population.</p>
<pre class="{bash}"><code>sed 's/\.\/\./0\/0/g' output.rn7.vcf &gt; Brain.rn7.no_missing.vcf
bgzip Brain.rn7.no_missing.vcf
bcftools index -t Brain.rn7.no_missing.vcf.gz
</code></pre>
</section>
<section id="split-vcfs" class="level3">
<h3 class="anchored" data-anchor-id="split-vcfs">Split VCFs</h3>
<p>First by chromosome number:</p>
<pre class="{bash}"><code>
mkdir genotypes/BrainVCFs
# Split VCF by chromosome
vcf_in=Brain.rn7.no_missing.vcf.gz

vcf_out_prefix=genotypes/BrainVCFs/chr

for i in {1..20}
do
    echo "Working on chromosome ${i}..."
    bcftools view ${vcf_in} --regions chr${i} -o ${vcf_out_prefix}${i}.vcf.gz -Oz
done


# Index VCFs
for i in {1..20}
do
    echo "Indexing chromosome ${i}..."
    bcftools index -t genotypes/BrainVCFs/chr${i}.vcf.gz
done</code></pre>
<p>Then for the sex chromosomes:</p>
<pre class="{bash}"><code>vcf_in=Brain.rn7.no_missing.vcf.gz
vcf_out_prefix=genotypes/BrainVCFs/chr

bcftools view ${vcf_in} --regions X -o ${vcf_out_prefix}X.vcf.gz -Oz
bcftools view ${vcf_in} --regions Y -o ${vcf_out_prefix}Y.vcf.gz -Oz

bcftools index -t genotypes/BrainVCFs/chrX.vcf.gz
bcftools index -t genotypes/BrainVCFs/chrY.vcf.gz
</code></pre>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-14-updated-preparing-rat-vcf-inputs-for-enformer-pipeline/index.html</guid>
  <pubDate>Mon, 14 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>An introduction to cyvcf2</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-14-cyvcf2-tutorial/test_vcf_query.html</link>
  <description><![CDATA[ 




<section id="read-vcf" class="level2">
<h2 class="anchored" data-anchor-id="read-vcf">Read VCF</h2>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> cyvcf2</span>
<span id="cb1-2">vcf_rn7 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cyvcf2.cyvcf2.VCF(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/rn7_data/chr20.vcf.gz"</span>)</span>
<span id="cb1-3">vcf_hg38 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cyvcf2.cyvcf2.VCF(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/hg38_data/ALL.chr22.shapeit2_integrated_SNPs_v2a_27022019.GRCh38.phased.vcf.gz"</span>)</span>
<span id="cb1-4">    </span></code></pre></div>
</div>
<p>We query the VCF for all snp positions and put it into a list.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">snps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> variant <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> vcf_rn7:</span>
<span id="cb2-3">    snps.append(variant.POS)</span>
<span id="cb2-4">region <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [snp <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> snp <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> snps <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11922155</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> snp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12315371</span>]</span></code></pre></div>
</div>
<p>Our region of interest is centered at the TSS for gene ENSRNOG00000054549. We subset to all snps within 196608 bp of position 12118763 on chromosome 20.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print(region)</span></span>
<span id="cb3-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(region), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snps found in interval"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1957 snps found in interval</code></pre>
</div>
</div>
<p>We’ll print the first lines from both human and rat VCFs.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> variant <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> vcf_rn7:</span>
<span id="cb5-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(variant)</span>
<span id="cb5-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb5-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> variant <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> vcf_hg38:</span>
<span id="cb5-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(variant)</span>
<span id="cb5-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>20  7226    chr20:7226  A   G   .   PASS    AC=17763;AN=27342   GT  0/1 1/1 0/1 1/1 0/1 1/1 1/1 1/1 1/1 1/1 1/1 1/1 1/1 0/1 1/1 0/1 0/1 0/1 0/0 0/0 1/1 0/1 1/1 0/0 1/1 0/1 0/0 0/0 0/1 1/1 0/1 1/1 0/0 1/1 1/1 0/0 0/1 0/1 1/1 0/1 0/1 0/1 0/1 0/1 0/1 0/1 1/1 0/1 0/1 0/0 1/1 1/1 1/1 1/1 0/0 0/0 0/1 0/1 0/0 1/1 0/1 0/1 0/1 0/0 1/1 1/1 1/1 1/1 0/1 1/1 0/1 0/1 0/1 1/1 1/1 1/1 1/1 0/0 1/1 0/1 0/1 1/1 0/1 0/0 0/1 0/1 1/1 1/1 1/1 0/1 0/1 1/1 0/1 0/1 0/1 0/1 0/1 1/1 0/1 0/1 0/0 1/1 0/1 0/1 1/1 0/0 0/0 1/1 0/1 1/1 1/1 0/0 0/0 1/1 1/1 1/1 0/1 0/1 1/1 0/1 0/1 0/0 0/1 0/1 1/1 0/1 0/1 0/1 0/0 0/1 0/1 0/0 1/1 0/1 0/1 0/1 1/1 0/0 0/0 0/0 1/1 0/1 0/1 0/1 0/0 0/1 0/1 1/1 1/1 1/1 0/1 0/1 1/1 1/1 0/0 0/1 0/1 1/1 0/0 0/0 1/1 0/0 0/1 0/0 0/1 0/1 0/1 0/1 0/1 0/0 0/1 0/0 0/0 0/0 0/1 1/1 0/1 0/1 0/1 0/0 0/1 1/1 1/1 1/1 1/1 0/1 0/1 1/1 0/1 0/0 1/1 0/0 1/1 1/1 0/1 ./. 1/1 1/1 0/0 0/1 1/1 0/1 1/1 1/1 1/1 1/1 0/1 1/1 0/1 0/1 0/1 0/1 1/1 1/1 1/1 0/0 1/1 1/1 1/1 1/1 1/1 0/1 1/1 1/1 1/1 0/1 0/1 1/1 1/1 1/1 1/1 0/1 0/1 0/1 1/1 1/1 1/1 0/1 0/1 0/1 1/1 1/1 1/1 1/1 1/1 0/0 0/1 0/1 1/1 1/1 1/1 1/1 0/0 1/1 0/1 0/1 0/1 1/1 1/1 1/1 0/1 0/1 1/1 1/1 0/0 0/0 1/1 0/1 0/1 0/0 1/1 0/1 1/1 1/1 0/1 0/0 0/0 0/0 0/0 0/1 0/0 0/1 0/1 1/1 0/1 0/1 0/0 ./. 0/0 0/1 1/1 0/1 1/1 1/1 1/1 0/1 0/0 0/0 1/1 0/0 0/1 0/1 0/1 0/1 0/1 0/1 0/0 1/1 0/1 1/1 0/1 1/1 0/1 1/1 1/1 1/1 1/1 0/1 1/1 0/0 0/1 1/1 0/1 1/1 1/1 1/1 1/1 0/1 0/1 1/1 0/1 0/0 0/1 1/1 1/1 0/1 0/0 1/1 0/1 0/0

chr22   10522217    .   G   A   .   PASS    AC=89;AF=0.02;AFR_AF=0.07;AMR_AF=0;AN=5096;DP=9085;EAS_AF=0;EUR_AF=0;NS=2548;SAS_AF=0;VT=SNP    GT  0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 1|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 1|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|1 0|0 0|0 1|1 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 1|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|1 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 1|1 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|1 1|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 1|0 1|1 0|0 0|0 0|0 0|0 0|0 0|1 0|1 0|0 0|0 0|0 0|0 1|0 1|0 0|0 0|1 1|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|1 0|1 0|0 1|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 1|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 1|0 0|0 0|0 0|1 0|0 1|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0
</code></pre>
</div>
</div>
<p>The first three columns look different, which might explain our bugs with our rat VCFs when running the Enformer pipeline. We’ll try querying these regions from the VCFs.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> variant <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> vcf_hg38(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chr22:10516173-10909389"</span>):</span>
<span id="cb7-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(variant)</span>
<span id="cb7-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>chr22   10516173    .   A   G   .   PASS    AC=121;AF=0.02;AFR_AF=0.06;AMR_AF=0.02;AN=5096;DP=8203;EAS_AF=0;EUR_AF=0.02;NS=2548;SAS_AF=0;VT=SNP GT  0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 1|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|1 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|1 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 1|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|1 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|1 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|1 0|0 1|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 1|0 0|0 0|0 1|0 0|0 0|0 1|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|1 0|0 0|0 1|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|1 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 1|0 0|1 0|0 0|0 0|0 0|0 0|1 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 1|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|1 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0 0|0
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> variant <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> vcf_rn7(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20:11922155-12315371"</span>):</span>
<span id="cb9-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(variant)</span>
<span id="cb9-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>20  11922570    chr20:11922570  G   A   .   PASS    AC=10302;AN=28910   GT  0/0 0/1 0/0 1/1 0/1 0/0 ./. 0/1 0/0 0/1 0/0 0/0 0/0 0/0 0/0 0/0 0/0 0/1 0/1 1/1 0/1 0/1 0/0 0/1 0/1 0/0 0/1 0/0 0/1 0/0 0/1 0/0 1/1 0/1 0/1 0/1 0/0 0/1 1/1 0/1 0/0 0/0 0/0 1/1 0/0 0/1 0/0 0/1 1/1 0/1 0/0 1/1 0/0 0/0 0/0 0/1 0/0 0/1 0/1 0/1 0/0 0/0 1/1 0/1 0/1 0/0 0/0 0/0 0/0 1/1 0/0 0/0 0/1 0/0 0/1 0/1 0/0 0/1 0/1 0/0 0/0 0/0 0/1 0/0 1/1 0/1 0/1 0/1 0/1 0/1 0/1 0/0 0/0 1/1 0/0 0/1 0/0 0/0 0/0 0/1 0/1 0/0 0/0 0/1 0/0 0/0 0/0 0/0 0/1 0/1 0/0 0/0 0/0 0/0 0/1 0/0 0/0 0/1 0/1 0/0 0/0 1/1 0/1 0/0 0/0 1/1 0/1 0/0 0/1 1/1 0/0 0/1 0/0 0/0 0/1 0/0 0/1 1/1 0/0 0/0 0/1 0/1 0/1 0/0 0/0 0/1 0/0 1/1 0/0 0/0 0/1 0/0 0/1 1/1 0/0 0/0 0/0 0/1 0/1 0/0 0/1 0/0 0/1 1/1 0/1 0/1 0/1 0/1 1/1 0/1 0/0 0/0 0/0 0/0 0/0 1/1 0/1 1/1 0/0 0/1 0/1 0/0 0/0 0/0 0/0 0/0 1/1 0/1 1/1 0/1 0/1 0/1 0/1 0/1 0/1 1/1 0/0 0/0 0/1 0/0 0/0 0/0 0/0 0/0 0/0 0/0 0/0 0/0 0/0 0/0 0/0 0/1 0/0 0/0 0/0 0/0 1/1 0/1 0/0 0/0 0/0 0/0 0/1 1/1 0/0 0/0 0/1 0/1 0/0 0/0 0/0 0/1 0/0 0/1 0/1 0/1 0/0 0/0 0/0 0/0 0/0 0/0 0/1 0/0 0/0 0/0 0/0 0/0 0/1 0/1 0/1 0/1 0/1 0/1 0/0 0/0 0/1 0/0 0/1 0/0 0/1 0/0 0/0 1/1 0/1 0/0 0/0 0/0 0/1 0/0 0/0 0/0 1/1 1/1 0/1 0/1 0/1 0/1 0/1 0/0 0/0 0/1 1/1 0/0 1/1 0/0 0/1 0/1 1/1 0/0 1/1 0/1 0/1 0/1 0/0 0/0 0/1 1/1 0/1 0/1 0/0 0/1 0/0 0/1 0/1 0/0 0/0 0/1 0/0 0/1 0/1 0/0 0/1 0/1 0/0 0/0 0/0 0/0 0/1 0/1 1/1 0/0 0/0 0/0 0/1 0/1 0/0 0/0 0/0 0/0 0/0 0/1 0/1 0/0 0/1 0/0 1/1 0/1 0/1 0/0
</code></pre>
</div>
</div>
<p>Because of the difference in chromosome notations, we have to query the rat VCFs without the extra “chr” string at the start. Unfortunately, we need the “chr” string for other parts of the pipeline, so we cannot just remove the “chr” prefix from our <code>intervals.txt</code> file, but rather we need to add “chr” to the CHROM column of our rn7 VCFs.</p>
<pre><code>awk '{if($0 !~ /^#/) print "chr"$0; else print $0}' genotypes/Brain.rn7.vcf &gt; output.vcf

</code></pre>
<p>I will update the <a href="https://sabrina-dl.hakyimlab.org/posts/preparing-rat-vcfs-for-enformer/">Preparing Rat VCFs for Enformer</a> blog post.</p>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-14-cyvcf2-tutorial/test_vcf_query.html</guid>
  <pubDate>Mon, 14 Aug 2023 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Testing the Enformer pipeline with added parameters for personalized prediction on rats</title>
  <dc:creator>Sabrina Mi</dc:creator>
  <link>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-15-test-run-of-personalized-enformer-pipeline-for-rats/index.html</link>
  <description><![CDATA[ 




<section id="test-for-a-single-individual-and-gene" class="level2">
<h2 class="anchored" data-anchor-id="test-for-a-single-individual-and-gene">Test for a single individual and gene</h2>
<p>We chose <code>ENSRNOG00000054549</code>, centered at the TSS chr20:12118762.</p>
<pre><code>conda activate enformer-predict-tools

cd /Users/sabrinami/Github/shared_pipelines/enformer_pipeline

python scripts/enformer_predict.py --parameters /Users/sabrinami/Github/deep-learning-in-genomics/posts/2023-08-15-test-run-of-personalized-enformer-pipeline-for-rats/local_test_personalized.json
</code></pre>
</section>
<section id="compare-results-to-non-pipeline-method" class="level2">
<h2 class="anchored" data-anchor-id="compare-results-to-non-pipeline-method">Compare results to non-pipeline method</h2>
<section id="read-in-h5-prediction-files" class="level3">
<h3 class="anchored" data-anchor-id="read-in-h5-prediction-files">Read in h5 prediction files</h3>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> h5py</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> EnformerVCF</span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> kipoiseq</span>
<span id="cb2-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2023-08-26 14:55:53.212214: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> h5py.File(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/predictions_folder/personalized_enformer_rat_single_gene/predictions_2023-08-15/enformer_predictions/000789972A/haplotype1/chr20_12118762_12118762_predictions.h5'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>)</span>
<span id="cb4-2">haplotype1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chr20_12118762_12118762'</span>][()]</span>
<span id="cb4-3">f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> h5py.File(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/predictions_folder/personalized_enformer_rat_single_gene/predictions_2023-08-15/enformer_predictions/000789972A/haplotype2/chr20_12118762_12118762_predictions.h5'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>)</span>
<span id="cb4-4">haplotype2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chr20_12118762_12118762'</span>][()]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"haplotype1:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, haplotype1)</span>
<span id="cb5-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"haplotype2:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, haplotype2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>haplotype1:
 [[0.24076067 0.30101207 0.5132549  ... 0.20521325 1.1217918  0.25558835]
 [0.15946281 0.20442429 0.37761706 ... 0.04465578 0.24607326 0.08344302]
 [0.15568599 0.21775411 0.4520394  ... 0.05306218 0.20978831 0.08246609]
 ...
 [0.17938398 0.22463004 0.29506153 ... 0.01107231 0.02651541 0.0338815 ]
 [0.16948122 0.2044945  0.2620006  ... 0.01690046 0.04069382 0.06031117]
 [0.15266503 0.201914   0.22262897 ... 0.02438843 0.03895664 0.05986918]]
haplotype2:
 [[0.23317184 0.29741773 0.5182305  ... 0.20385785 1.1424272  0.26008573]
 [0.15613721 0.20323968 0.37887666 ... 0.04524086 0.257699   0.08468267]
 [0.15380262 0.21736239 0.45358157 ... 0.05439655 0.22475001 0.08432709]
 ...
 [0.17942066 0.2246648  0.29515463 ... 0.01105907 0.02650285 0.03387856]
 [0.16946748 0.20452495 0.2621123  ... 0.0168827  0.04067391 0.06034191]
 [0.15272975 0.20209791 0.22299151 ... 0.0243816  0.03896997 0.05996798]]</code></pre>
</div>
</div>
</section>
<section id="run-non-pipeline-enformer" class="level3">
<h3 class="anchored" data-anchor-id="run-non-pipeline-enformer">Run non-pipeline Enformer</h3>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">fasta_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/rn7_data/rn7_genome.fasta'</span></span>
<span id="cb7-2">fasta_extractor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.FastaStringExtractor(fasta_file)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## read vcf and encode haplotypes</span></span>
<span id="cb8-2">target_interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kipoiseq.Interval(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chr20"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12118762</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12118762</span>)</span>
<span id="cb8-3">chr20_vcf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.read_vcf(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/sabrinami/enformer_pipeline_test/rn7_data/chr20.vcf.gz"</span>)</span>
<span id="cb8-4">haplo1, haplo2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.vcf_to_seq(target_interval, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'000789972A'</span>, chr20_vcf, fasta_extractor)</span>
<span id="cb8-5">haplo1_enc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.one_hot_encode(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>.join(haplo1))[np.newaxis]</span>
<span id="cb8-6">haplo2_enc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.one_hot_encode(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>.join(haplo2))[np.newaxis]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## run predictions</span></span>
<span id="cb9-2">prediction1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.model.predict_on_batch(haplo1_enc)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'human'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb9-3">prediction2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.model.predict_on_batch(haplo2_enc)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'human'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"There are"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(haplotype1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> prediction1)), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"differences between haplotype1 matrices and"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(haplotype2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> prediction2)), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"differences between haplotype2 matrices."</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 0 differences between haplotype1 matrices and 0 differences between haplotype2 matrices.</code></pre>
</div>
</div>
<p>The pipeline outputs are the same!</p>
</section>
</section>
<section id="test-mouse-head-on-reference-genome" class="level2">
<h2 class="anchored" data-anchor-id="test-mouse-head-on-reference-genome">Test mouse head on reference genome</h2>
<pre><code>conda activate enformer-predict-tools

cd /Users/sabrinami/Github/shared_pipelines/enformer_pipeline

python scripts/enformer_predict.py --parameters /Users/sabrinami/Github/deep-learning-in-genomics/posts/2023-08-15-test-run-of-personalized-enformer-pipeline-for-rats/local_test_reference.json
</code></pre>
</section>
<section id="compare-results-to-non-pipeline-method-1" class="level2">
<h2 class="anchored" data-anchor-id="compare-results-to-non-pipeline-method-1">Compare results to non-pipeline method</h2>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb13-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Read prediction file</span></span>
<span id="cb13-3">f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> h5py.File(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/sabrinami/Desktop/2022-23/tutorials/enformer_pipeline_test/predictions_folder/reference_enformer_rat_single_gene/predictions_2023-08-26/enformer_predictions/reference_enformer_rat/haplotype0/chr20_12118762_12118762_predictions.h5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>)</span>
<span id="cb13-4">haplotype0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chr20_12118762_12118762"</span>][()]</span>
<span id="cb13-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shape:"</span>, haplotype0.shape)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (896, 1643)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">SEQUENCE_LENGTH <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">393216</span></span>
<span id="cb15-2">target_interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kipoiseq.Interval(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chr20"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12118762</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12118762</span>)</span>
<span id="cb15-3">sequence_one_hot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.one_hot_encode(fasta_extractor.extract(target_interval.resize(SEQUENCE_LENGTH)))</span>
<span id="cb15-4">predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EnformerVCF.model.predict_on_batch(sequence_one_hot[np.newaxis])[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mouse'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"There are"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(haplotype0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> predictions)), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"differences between pipeline and non-pipeline outputs."</span>)</span></code></pre></div>
</div>


</section>

 ]]></description>
  <guid>https://sabrinami.quarto.pub/deep-learning-in-genomics/posts/2023-08-15-test-run-of-personalized-enformer-pipeline-for-rats/index.html</guid>
  <pubDate>Sat, 12 Aug 2023 07:00:00 GMT</pubDate>
</item>
</channel>
</rss>
